# Discrete Choice Models {#sec-econ-dcm .unnumbered}

## Misc {#sec-econ-dcm-misc .unnumbered}

-   AKA Random Utility or Choice Models
-   tl;dr:
    -   The Utility equation is the model equation.
        -   *Utility* ($U$) is made up of *Observed Utility* ($V$) and *Unobserved Utility* ($\epsilon$).
        -   (Total) Utility is the LHS of the model equation, but logit models are typically used to model a proxy called *Choice Probabilities* which are the predicted responses.
            -   If the data is aggregated to the *Market Level* instead of the individual level, then the choice probabilities are now called *Market Shares*.
        -   Observed Utility are modeled by our data, and Unobserved Utility are the residuals of that model.
        -   The coefficients ($\beta$s) of the model are called *Marginal Utilities*.
    -   The observed response is typically polytomous and the categories are called *Alternatives* which are the potential choices of the *Decision Maker*.
-   Notes from [ResEcon 703 Video Course](https://www.youtube.com/@ResEcon703UMassAmherst/playlists)
    -   Weeks 3, 4, 9, 10, 12, and 13
    -   Video lectures talk through mathematics (interpretations, motivations, benefits, limitations, etc.) of the approaches. Almost all sections end with an R code script illustrating the approach.
    -   [github](https://github.com/woerman/ResEcon703) with lecture code scripts and problem sets/solutions with R code. Lecture scripts have calculations of many useful econometric values. Problem set solutions have written out interpretations. {mlogit} used throughout.
-   Also see:
    -   [Decision Intelligence](decision-intelligence.qmd#sec-decint){style="color: green"}
    -   [Regression, Multinomial](regression-multinomial.qmd#sec-reg-multin){style="color: green"}
    -   [Diagnostics, Classification \>\> Multinomial](diagnostics-classification.qmd#sec-diag-class-multinom){style="color: green"}
    -   [Classification \>\> Discriminant Analysis](classification.qmd#sec-class-discrim){style="color: green"} \>\> Linear Discriminant Analysis (LDA)
    -   [Model Building, brms \>\> Logistic Regression](model-building-brms.qmd#sec-modbld-brms-logreg){style="color: green"}
-   Use Cases:
    -   Respondents to a social survey are classified by their highest completed level of education, taking on the values (1) less than highschool, (2) highschool graduate, (3) some post-secondary, or (4) post-secondary degree.
    -   Women's labor-force participation is classified as (1) not working outside the home, (2) working part-time, or (3) working full-time.
    -   Voters in Quebec in a Canadian national election choose one of the (1) Liberal Party, (2) Conservative Party, (3) New Democratic Party, or (4) Bloc Quebecois.

## Terms {#sec-econ-dcm-terms .unnumbered}

-   [**Alternative**]{style="color: #009499"} - The levels of a polytomous response in Random Utility Models.
-   [**Choice Probability**]{style="color: #009499"} - The probability that a decision-maker will chose a particular alternative. The predicted response for a Random Utility Model.
-   [**Choice Settings**]{style="color: #009499"} - Often to describe in general the choice set itself, but can also be used to describe the context in which the choice by the decision-maker is taking place.
    -   e.g. binary, ordered multinomial, unordered multinomial and count data frameworks
    -   e.g. educational setting, marketing setting
-   [**Discounted Utility**]{style="color: #009499"} - The utility of some future event, such as consuming a certain amount of a good, as perceived at the present time as opposed to at the time of its occurrence. It is calculated as the present discounted value of future utility, and [for people with time preference for sooner rather than later gratification, it is less than the future utility.]{.underline}
-   [**Marginal Utility**]{style="color: #009499"} - Coefficients in the random choice model. The added satisfaction that a consumer gets from having one more unit of a good or service. The concept of marginal utility is used by economists to determine how much of an item consumers are willing to purchase.
-   [**Market Level**]{style="color: #009499"} - Environment or category where a class or brand of products share the same attributes
    -   e.g. All Cokes should cost the same in Indianapolis but that price may be different from the price of Cokes in Nashville. Therefore, Indianapolis and Nashville are separate markets.
-   [**Market Share**]{style="color: #009499"} - The percentage of total sales in an industry or product category that belong to a particular company during a discrete period of time. For a Random Utility Model, when the data is at the market level instead of the individual level, the predicted response is the Market Share.
-   [**Outside Product**]{style="color: #009499"} (aka [**Outside Option**]{style="color: #009499"}) - Typically a "purchase nothing" indicator variable/variable category
    -   Can just be a vector of 0s
-   [**Random Utility Models**]{style="color: #009499"} - These models rely on the hypothesis that the decision maker is able to rank the different alternatives by an order of preference represented by a utility function, the chosen alternative being the one which is associated with the highest level of utility. They are called random utility models because part of the utility is unobserved and is modeled as the realization of a random deviate.

## Random Utility Models {#sec-econ-dcm-randutmod}

-   Misc

-   [**Random Utility**]{style="color: #009499"} - utility theory can readily be understood as the idea that people behave in line with self-interset where self-interest reflects peoples' needs to save time and economize on effort.

    -   These models rely on the hypothesis that the decision maker is able to rank the different alternatives by an order of preference represented by a utility function, the chosen alternative being the one which is associated with the highest level of utility. They are called random utility models because part of the utility is unobserved and is modeled as the realization of a random deviate.

-   Data sets used to estimate random utility models have therefore a specific structure that can be characterized by three indexes: the alternative, the choice situation, and the individual. The distinction between choice situation and individual indexes is only relevant if we have repeated observations for the same individual.

    -   Examples of variable types
        -   Data Descriptions
            -   Each individual has responded to several (up to 16) scenarios.
            -   For every scenario, two train tickets A and B are proposed to the user, with different combinations of four attributes: price (the price in cents of guilders), time (travel time in minutes), change (the number of changes) and comfort (the class of comfort, 0, 1 or 2, 0 being the most comfortable class).
        -   Choice Situation Specific
            -   data1: Length of the vacation and the Season
            -   data2: values of dist, income and urban are repeated four times.
                -   dist (the distance of the trip)
                -   income (household income)
                -   urban (a dummy for trips which have a large city at the origin or the destination)
                -   noalt the number of available alternatives
        -   Individual Specific
            -   data1: Income and Family Size
            -   data2: None
        -   Alternative Specific
            -   data1: Distance to Destination and Cost
            -   data2:
                -   transport modes (air, train, bus and car)
                -   cost for monetary cost
                -   ivt for in vehicle time
                -   ovt for out of vehicle time
                -   freq for frequency
    -   The unit of observation is typically the choice situation, and it is also the individual if there is only one choice situation per individual observed, which is often the case

-   Agent/Decison-Maker gets some amount of utility from each of the alternatives (set of actions the user can choose from)

-   The amount of utility for each alternative and each decision maker can depend on:

    -   observed characteristics of the alternative themselves
    -   observed characteristics of the decision maker
    -   unobserved characteristics

-   Utility is *not* observed but can be inferred by factors that are observed (and how each factor affects Utility):

    -   Chosen alternative, i, by each decision maker, n
    -   Some attributes about each alternative
    -   Some attributes about each decision maker.

-   Total Utility: $U_{nj} = V_{nj} + \epsilon_{nj}$

    -   Where Representative (observed) Utility, $V_{nj} = V(x_{nj}, s_n)$
        -   $x_{nj}$ is the vector of attributes for alternative j specific to decison maker n
        -   $s_n$ is the vector of attributes for decision maker n\\
    -   $\epsilon_{nj}$ is called the "Random Utility" which is unobserved (i.e. the stuff we didn't adjust for).

-   Utility Model: $U_{nj} = \hat{\beta}x_{nj} + \epsilon_{nj}$

    -   Since $U_{nj}$ is unobserved, decision maker choice from alternatives is used as the response variable to proxy Utility.
    -   $\beta$ is called a "structural parameter"

-   Choice Probabilities

    $$
    P_{ni} = \int_{\epsilon} \mathbb{1} (\epsilon_{nj} - \epsilon_{ni} < V_{ni} - V_{nj} \;\; \forall j \neq i) f(\boldsymbol{\epsilon}_n) d \boldsymbol{\epsilon}_n
    $$

    -   Assuming the decision maker makes choices that maximize utility allows us to use choice probabilities to model which alternative maximizes utility.
    -   See video for the derivation from $\text{PR}(U_{ni} > U_{nj} \;\; \forall j \neq i)$
    -   This is the cumulative distribution for $\epsilon_{nj} - \epsilon_{ni}$ which is a multidimensional integral over the density of unobserved utility, $f(\epsilon_n)$.
    -   Assumptions about $f(\epsilon_n)$ are what yields different discrete choice models

## Multinomial Logit (MNL) {#sec-econ-dcm-mnl .unnumbered}

-   AKA Generalized Logit

-   When the polytomous response has m levels (aka Alternatives), the multinomial logit model comprises m−1 log-odds comparisons with a reference level, typically the first or last.

    -   The likelihood under the model and the fitted response probabilities that it produces are unaffected by choice of reference level, much as choice of reference level for dummy regressors created from a factor predictor doesn't affect the fit of a regression model.

-   [Choice Probability for alternative, i, and decision-maker, n]{.underline}:

    $$
    P_{ni} = \frac {e^{V_{ni}}}{\sum_j e^{V_{nj}}} = \frac {e^{\hat{\beta}x_{ni}}}{\sum_j e^{{\hat{\beta}x_{nj}}}}
    $$

    -   The probability that decision-maker, $n$, chooses alternative, $i$
    -   Predicted probability output from the model

-   [Market Shares]{.underline}

    -   Market Share for alternative, i

        $$
        S_i = \frac {e^{V_i}}{\sum_j e^{V_j}}
        $$

        -   What distinguishes this from a choice probability is that unit is at the market level and not the individual level (see $\vec{x}$ in the next section), hence no "n" in the equation

    -   The difference in market share of products i and j

        $$
        \ln (S_i) - \ln (S_j) = \hat{\beta} (x_i - x_j)
        $$

        -   $x_i$ is a set of variables that describe product i.
            -   Therefore these will be the same for every decision-maker.
        -   $j$ is typicially a reference level (aka *outside option*)
            -   If the products were a product such as cereal, then the outside option would typically be "not buying cereal" where the utility is 0.

-   [Assumptions]{.underline}

    -   Exogenity of the alternative attribute variables of the alternatives: $\mathbb{E}[\epsilon \; | \; \vec {x}] = 0$ (i.e mean of the residuals is 0)
        -   Example of Endogenity
            -   Taking a car to work or taking the bus to work are the alternatives.
            -   If a commuter likes to drive, they won't care about living close to a bus stop
            -   If a commuter likes to take the bus, they are more likely to live close to a bus stop
            -   Therefore your logit model will be biased because any attribute variable that is related to the distance a decision-maker is from a bus stop will be endogenous.
                -   e.g. Time each mode of transportation takes to get to work will be endogenous because distance from the bus stop affects time and distance to bus stop is correlated with a decision maker already biased towards buses and not with a decision maker who would choose bus or car.
                    -   i.e. distance isn't randomly distributed among all decision makers.
        -   Solution: TBD in a later lecture
    -   iid residuals following a Gumbel distribution
        -   Residuals are the unobserved utility (i.e. random utility).
        -   For panel data, it's unlikely that each unobserved alternative attribute for a decision maker is independent across a time component which makes this a bad model for such data.
            -   e.g. If a person chooses Count Chocula one day and Fruit Loops the next, it's unlikely that the unobserved components of utility that led to the Count Chocula choice aren't correlated with the unobserved components of utility that led to the Fruit Loops choice.

-   [Substitution Patterns]{.underline}

    -   [Independence of Irrelavent Alternatives (IIA)]{.underline} Property of Logit models
        -   Example: car, blue bus , red bus
            -   In the beginning, the decision maker only has 2 choices: drive car or ride blue bus.
            -   The probability of choosing the alternative car is the same for a decision maker as choosing the alternative blue bus: $P_c = P_{bb} = 1/2$
            -   Then a red bus is added to the choices, but the decision maker doesn't care whether the bus is red or blue. Therefore the blue bus and the red bus have the same choice probability: $P_{bb} = P_{rb}$
            -   But from the IIA property, the ratio of choice probability between car and blue bus is not changed after introduction of the red bus. Therefore, $P_c = P_{bb} = P_{rb} = 1/3$
            -   In reality, the choice probability for car has NOT decreased, since for decision maker, the choice is actually between car and bus --- color isn't a relative factor
        -   Example: Hummer, Escalade, Prius
            -   Hummer lowers price.
            -   Will Hummer attract more Escalade drivers than Prius?
            -   The logit model says that "proportional substitution to the Hummer will be equal for the Escalade and the Prius.
                -   i.e. The lowering of the Hummer price will have an equal effect on Escalade sales and Prius sales which is unrealistic
    -   [Proportional Substitution]{.underline}
        -   Note the logit cross-elasticity equation for alternative, i, given a change in alternative, j (See below, Elasticity \>\> Cross Elasticity). The change in choice probability for alternative i only depends on the change to the attribute for alternative, j.
        -   This means that we can *substitute* any alternative for i (other than j) and the cross-elasticity will be the same and therefore the change in choice probability will be the same.
            -   i.e. We change the value of an attribute for alternative j. Then, all choice proabilities for the other alternatives (other than j) change by the **same** proportion. Doesn't matter if alternative j is correlated more strongly with another alternative or not.
        -   Shows a lack of flexibility in the logit model --- there is no structure to model the correlation between alternatives. (See Mixed Logit)

-   [Marginal Effects]{.underline}

    $$
    \text{ME} = \frac {\partial P_{ni}} {\partial z_{ni}} = \beta_z P_{ni}(1-P_{ni})
    $$

    -   The change in the probability of choosing alternative, i, after a change in the attribute of alternative, i.
    -   $P_{ni}$ is the probability of decision maker, n, choosing alternative i.
    -   [Cross Marginal Effect]{.underline} $$
        \text{CME} = \frac {\partial P_{ni}} {\partial z_{nj}} = -\beta_z P_{ni}P_{nj}
        $$
        -   The change in the probability of choosing alternative, $i$, after a change in the attribute of alternative, $j$.

-   [Elasticity]{.underline}

    $$
    E_{iz_{ni}} = \beta_z z_{ni} (1-P_{ni})
    $$

    -   Marginal Effects and Elasticities are similar except elasticities are percent change.
        -   e.g. a percentage change in a regressor results in this much of a percentage change in the response level probability
    -   $E_{iz_{ni}}$ is the elasticity of the probability of alternative, i, with respect to $z_{ni}$, an observed attribute of alternative, i
    -   $P_{ni}$ is the predicted probability of alternative, i, for decision maker, n.
    -   [Cross Elasticity]{.underline} $$
        E_{iz_{ni}} = -\beta_z z_{nj} P_{nj}
        $$

## Nested Logit {#sec-econ-dcm-nestlog .unnumbered}

-   Fits separate models for each of a hierarchically nested set of binary comparisons among the response categories. The set of m−1 models comprises a complete model for the polytomous response, just as the multinomial logit model does.

-   [Misc]{.underline}

    -   IIA still holds for two alternatives in the same dichotomy, but doesn't hold for alternatives of different different dichotomies
    -   Both MNL and Nested Logit methods have have p×(m−1) parameters. The models are not equivalent, however, in that they generally produce different sets of fitted category probabilities and hence different likelihoods.
        -   Multinomial logit model treats the response categories symmetrically
    -   [Extensions]{.underline}
        -   [Paired Combinatorial Logit]{.underline}
            -   Allows alternatives to be in multiple dichotomies and multiple hierarchies and for them to have more complex correlation structures
                -   In nested logits, only alternatives within the same hierarchy are modeled as being correlated with each other.
            -   Creates pairwise dichotomies for each combination of alternatives (i.e. each alternative appears in J-1 nests)
            -   Best for data with fewer alternatives since the parameter space can explode fairly quickly
        -   [Generalized Nested Logit]{.underline}
            -   Allow alternatives to be in any dichotomy in any hierarchy, but assign a weight to each alternative in each dichotomy.
            -   Estimate Parameters: $\lambda_k$ (See Choice Probability below), $\alpha_{jk}$ : "weight" or proportion of alternative, $j$, in dichotomy, $k$
            -   Need to be careful about how many dichotomies that you place each alternative, since the parameter space can explode fairly quickly
        -   [Heteroskedastic Logit]{.underline}
            -   Heteroskedacity in this sense means that the variance of the unobserved utility (aka residuals) can be different for each alternative

                $$
                \mbox{Var}(\epsilon_{nj}) = \frac {(\theta_j \pi)^2}{6}
                $$

            -   Since there's no closed form solution, simulation methods must be usded to get the choice probabilities and model parameters.

-   [Construction of Dichotomies]{.underline}

    -   By the construction of nested dichotomies, the submodels are statistically independent (because the likelihood for the polytomous response is the product of the likelihoods for the dichotomies), so test statistics, such as likelihood ratio (G^2^) and Wald chi-square tests for regression coefficients can be summed to give overall tests for the full polytomy.
    -   Nested dichotomies are not unique and alternative sets of nested dichotomies are not equivalent: Different choices have different interpretations. Moreover, and more fundamentally, fitted probabilities and hence the likelihood for the nested-dichotomies model depend on how the nested dichotomies are defined.
    -   Example: 2 methods of splitting a 4-level response into dichotomies\
        ![](_resources/Regression-Multinomial.resources/nested-dichot1.jpg){width="473"}
        -   Left: Y = {1, 2, 3, 4} → {1,2} vs {3,4} → {1} vs {2} and {3} vs {4}
        -   Right: (Continuous Logit) Y = {1, 2, 3, 4} → {1} vs {2, 3, 4} → {2} vs {3, 4} → {3} vs {4}
            -   {1} vs. {2,3,4} could represent highschool graduation
            -   {2} vs. {3,4} could represesnt enrollment in post-secondary education
            -   {3} vs. {4} could represent completion of a post-secondary degree.

-   [Assumptions]{.underline}

    -   Assumes Gumbel distribution of errors but relax the i.i.d. hypothesis
        -   Allows for the unobserved (and random) components of utility, $\epsilon_{nj}$ , to be correlated for the same decision maker
        -   Example: {drive} vs {carpool} and {bus} vs {train}
            -   Model allows from unobserved components of utility (i.e. residuals of the model) of drive and carpool to correlated for the same decision maker but not the unobserved components of utility for carpool and train.
    -   Assumes Exogenity (See [Multinomial Logit](econometrics-discrete-choice-models.qmd##sec-econ-dcm-mnl){style="color: green"} \>\> Assumptions)
        -   This model is also bad for panel data

-   [Choice Probability for alternative, i, and decision-maker, n]{.underline}

    $$
    P_{ni} = \frac {e^{V_{ni}/\lambda_k}(\sum_{j\in B_k}e^{V_{nj}/\lambda_k})^{\lambda_k - 1}}{\sum_{\ell=1}^K (\sum_{j\in B_\ell}e^{V_{nj}/\lambda_\ell})^{\lambda_\ell}}
    $$

    -   The probability that decision-maker, $n$, chooses alternative, $i$
        -   Predicted probability output from the model

        -   When data is at the market level, the $n$ index (i.e. individual) is removed from the equation above and the LHS becomes *Market Share* (See [Terms](econometrics-discrete-choice-models.qmd#sec-econ-dcm-terms){style="color: green"}). The difference in market share between alternatives (e.g. brands) is:

            $$
            \ln(S_i) - \ln(S_m) = \hat{\beta}(x_i - x_m) + (1-\lambda_k)\ln S_{i|B_k} - (1-\lambda_\ell)S_{m|B_\ell}
            $$

            -   The index, $m$, is typically a reference level called the "outside option" (See [Terms](econometrics-discrete-choice-models.qmd#sec-econ-dcm-terms){style="color: green"}) which is alternative of NOT doing an action where the utility is 0.
                -   If the products were a product such as cereal, then the outside option would typically be "not buying cereal" which would have a utility is 0.
    -   $\lambda_k$ is a measuer of independence in dichotomy, $k$ that gets estimated
    -   $1-\lambda_k$ is a measure of the correlation within dichotomy, $k$
    -   The nested logit is consistent with the random utility model when $\lambda_k \in (0,1] \; \forall k$

-   [Elasticity]{.underline}

    $$
    E_{iz{ni}} = \beta_z z_{ni} \left(\frac{1}{\lambda_k} - \frac{1-\lambda_k}{\lambda_k}P_{ni|B_k} - P_{ni}\right)
    $$

    -   Marginal Effects and Elasticities are similar except elasticities are percent change.
        -   e.g. a percentage change in a regressor results in this much of a percentage change in the response level probability
    -   Elasticity of alternate, $i$, in dichotomy, $k$, for decision-maker, $n$, with respect to its attribute, $z_{ni}$

-   [Cross-Elasticity]{.underline}

    $$
    E_{iz_{nm}} = 
    \left\{ \begin{array}{lcl}
    -\beta_z z_{zm}P_{nm} \left(1+ \frac{1-\lambda_k}{\lambda_k} \frac {1}{P_{nB_k}} \right) & \mbox{if} \; m \in \beta_k \\
    -\beta_z z_{zm}P_{nm} & \mbox{if} \; m \notin \beta_k 
    \end{array}\right.
    $$

    -   Where

        $$
        P_{nB_k} = \sum \limits_{j \in B_k} P_{nj} \;\; \text{and} \;\; P_{ni|B_k} = \frac {P_{ni}}{P_{nB_k}} = \frac {P_{ni}}{\sum_{j \in B_k} P_{nj}}
        $$

    -   The percent change in the probability of choosing alternative, $i$, after a percent change in the attribute of alternative, $m$.

    -   Cross elasticity depends on whether both alternatives are in the same dichotomy.

## Mixed Logit {#sec-econ-dcm-mixlog .unnumbered}

-   Individual heterogeneity can be introduced in the parameters associated with the covariates entering the observable part of the utility or in the variance of the errors.

    -   Doesn't exhibit IIA (See [Multinomial Logit](econometrics-discrete-choice-models.qmd#sec-reg-multin-mnl){style="color: green"} \>\> Substitution Patterns) since correlations between alternatives are modeled.
    -   Model creates a distribution of $\beta$s, so $\beta$ is allowed to vary throughout a population.

-   [Misc]{.underline}

    -   Market Level Data
        -   Observe price, market share, and characteristics of a product

-   [Choice Probability]{.underline}

    $$
    \begin{align}
    &P_{ni} = \int L_{ni}(\beta) \; f(\beta\;|\;\boldsymbol{\theta}) \; d\beta\\
    &\mbox{where} \; L_{ni}(\beta) = \frac {e^{V_{ni}(\beta)}}{\sum_{j=1}^J e^{V_{ni}(\beta)}} 
    \end{align}
    $$

    -   $\boldsymbol{\theta}$ is a vector of distributional parameters (e.g. $\mu, \sigma^2$ for a Normal Distribution)
        -   **The** $\theta$ **parameters are what get estimated by the model in order to calculate a distribution of** $\beta$**s** (i.e. Bayesian posterior)
    -   Integrates over a density so there is not a closed form solution. Therefore, numerical simulation must be used.
        -   **Elasticities** don't have a closed form solution either (Assume **Marginal Effects** are the same way)(See lecture videos for the math)
    -   Think of it as a weighted average of logit choice probabilities
        -   The logit choice probabilities are evaluated a different values of $\beta$, and each logit choice probability is weighted by the density $f(\beta\;|\;\boldsymbol{\theta})$
            -   i.e. Based on the density, more likely $\beta$s will be more heavily weighted.
    -   In statistical language, it's a mixed function of logit choice probabilities, $L_{ni}(\beta)$, and the mixing distribution, $f(\beta\;|\;\boldsymbol{\theta})$

-   [Random Coefficients]{.underline}

    $$
    U_{nj} = \hat{\alpha}\boldsymbol{x}_{nj} + \hat{\mu}\boldsymbol{z}_{nj} + \epsilon_{nj}
    $$

    -   $x_{nj}$, $z_{nj}$ - Data for alternative j and decision maker n
    -   $\hat{\alpha}$ - Vector of fixed coefficients (i.e. same for all decision makers)
    -   $\hat{\mu}_n$ - Vector of random coefficients (i.e. a coefficient for each decision maker)
    -   $\epsilon_{nj}$ - Residual from an extreme value distribution (e.g. Gumbel)
    -   Correlated Random Utility
        -   Let $\nu_{nj} = \boldsymbol{\hat{\mu}}_n \boldsymbol{z}_{nj} + \epsilon_{nj}$ be the random (unobserved) component of utility and $\mbox{Cov}(\nu_{ni}, \nu_{nj}) = \boldsymbol{z}_{ni} \Sigma \boldsymbol{z}_{nj}$ the covariance between random utilities of different alternatives where $\Sigma$ is the variance/covariance matrix for $\boldsymbol{\hat{\mu}}$
        -   **This is a structure to model the correlation between alternatives**

-   [Panel Data]{.underline}

    -   Data where each decision maker makes multiple choices over time periods

    -   Model allows for unobserved preference variation through random coefficients, which yields correlations in utility over time for the same decision maker

    -   Decision maker, n, chooses from a vector of alternatives over T time periods

    -   Utility

        $$
        U_{njt} = \hat{\beta}_n x_{njt} + \epsilon_{njt}
        $$

        -   The utility, U, for decision maker, n, in choosing alternative, j, at time period, t.
        -   $\hat{\beta}$ varies for each decision maker but is constant across time.

    -   Lag or lead predictors can be included

    -   Lagged responses can be included

        -   Use cases:
            -   Habit Formation
            -   Variety-Seeking Behavior
            -   Switching Costs
            -   Brand Loyalty

    -   Only models a sequence of static choices

        -   Lagged responses account for past choices affecting current choices, but not how current choices affect future choices
        -   A fully dynamic discrete choice model models how every choice affects subsequent choices.

-   [Individual-level Coefficients]{.underline}

    -   [Conditional Distribution of Coefficients]{.underline}: $h(\beta \;|\; \boldsymbol{y}_n, \boldsymbol{x}, \boldsymbol{\theta})$
        -   Distribution of $\beta$ among the group, from a popuation with an unconditional distribution defined by $\boldsymbol{\theta}$, who choose a sequence of alternatives $y_n$ when faced with choice setting, $\boldsymbol{x}$

        -   $y_n$ is the sequence of choices made by decision maker, n (i.e. panel data)

        -   $\boldsymbol{\theta}$ is the vector of $\beta$ distribution parameters

        -   $\boldsymbol{x}$ is the vector of *choice attributes*

        -   Proportional to the product (i.e. joint distribution) of

            $$
            P(\boldsymbol{y}_n \;|\; \boldsymbol{x}_n, \beta) \;\times\; f(\beta \;|\; \boldsymbol{\theta})
            $$

            -   (Left) The probability that an individual with coefficients $\beta$ would choose $y_n$
            -   (Right) The likelihood of observing $\beta$ in the population
    -   [Mean of the Conditional Distribution]{.underline} (aka Conditional Mean Coefficients)
        -   More practical to calculate than the conditional distribution itself.

        -   It's the weighted average of vectors of $\beta$ drawn randomly from the $\beta$ distribution, $\text f(\beta|\boldsymbol{\theta})$, $R$ times.

            $$
            \begin {align}
            \breve{\beta}_n &= \sum_{r=1}^R w_r \beta_r \\
            \mbox{where} \;\; w_r &= \frac{P(\boldsymbol{y}_n|x_n, \boldsymbol{\beta}_r)}{\sum_{r=1}^R P(\boldsymbol{y}_n|x_n, \boldsymbol{\beta}_r)} 
            \end {align}
            $$

            -   $w$ is the weight which is the proportion choice probability for draw, $r$

        -   A decision maker must make many choices for the conditional mean coefficient to approach the true individual-level coefficient.

            -   **A Monte Carlo simulation in the textbook for these lectures said even after 50 choices there was substantial difference between the two values.** Although, in the era of big data, it is conceivable to see a person make hundreds of choices.
    -   [Future Choice Probabilities]{.underline}
        -   Use past choices to define a conditional distribution of coefficients for the decision-maker
        -   Then use this conditional distribution, instead of the unconditional distribution, to calculate the mixed logit choice probabilities.
            -   No closed form solution so must use simulation. See lecture video for the procedure, but it's similar to the procedure of the conditional mean coefficient above.

## Dynamic Discrete Choice Models {#sec-reg-multin-ddcm .unnumbered}

-   Unlike the previous static models , this model will explicitly represent how 1 choice affects future choice sets and therefore future utilities.
    -   Static models assume that you make a choice based on the utility of that choice alone at that current time and not on some future utility associated with that first choice.
-   Utility
    -   Two Examples for "Go to college or get a job"
        -   Total Utility for:

            -   Two Periods: The utility gained during 4 years of college or work + the utility gain by choosing a job from a job set that depends on the completion of college or working for 4yrs
            -   Three Periods: Same as two but add in utility gained after choosing a retirement plan from a set of plans that were determined by the job you chose in period 2.

        -   Decision maker attends college $\; iff \;\; TU_C > TU_W$

        -   [2 Period Setting]{.underline}: During College/Work and Available Jobs After College/Work

            $$
            \begin {align}
            TU_C &= U_{1C} + \lambda \max_j (U_{2j}^C) \\
            TU_W &= U_{1W} + \lambda \max_j (U_{2j}^W)
            \end {align}
            $$

            -   College ($C$) or Work ($W$) for four years

            -   $U_1C$ - Utility in period 1 from four years of college

                $$
                U_{1C} = V_{1C} + \epsilon_{1C}
                $$

            -   $U_1W$ - Utility in period 1 from four years of working (Similar equation to $U_{1C}$ )

            -   $U_{2j}^C$ - Utility in period 2 from job $j$ after attending college

                $$
                U_{2j}^C = V_{2j}^C + \epsilon_{2j}^C
                $$

            -   $U_{2j}^W$ - Utility in period 2 from job $j$ after working (Similar equation to $U_{2j}^C$ )

            -   $\max$ says the person will take whichever job that gives the most utility

                -   Job choice set is different for decision makers who went to college than those that chose to work in the 1st period (even though both indexed by js).

            -   $\lambda$ reflects relative weighting of the two periods. Factor that\
                "discounts" a future utility. Typically people assign more utility for current things than things in the future, so in that case, this factor will lessen utility.

        -   [3 Period Setting]{.underline}: Before College, After College, and Start of Retirement

            $$
            \begin {align}
            TU_C &= U_{1C} + \lambda \max_j [U_{2j}^C + \theta \max_s (U_{3s}^{Cj})] \\
            TU_W &= U_{1W} + \lambda \max_j [U_{2j}^W + \theta \max_s (U_{3s}^{Wj})]
            \end {align}
            $$

            -   $J$ possible jobs for a career over many future years
            -   $S$ possible retirement plans
                -   $U_{3s}^{Cj}$ - Utility in period 3 from retirement plan $s$ after *attending college* in period 1 and working *job* $j$ in period 2
                    -   Similar utility model equations as $U_{1C}$ and $U_{2j}^C$
                -   $U_{3s}^{Wj}$ - Utility in period 3 from retirement plan $s$ after *working* in period 1 and working *job* $j$ in period 2
            -   $\max$ is maximizing both job choice (period 2) and its associated retirement plan (period 3)
            -   $\theta$ - Reflects relative weighting of three periods. Discount factor that's the similar to $\lambda$.
-   [Notation]{.underline}
    -   $\{i_1, i_2, \ldots, i_t\}$ - Sequence of choices up to and including period $t$
    -   $U_{tj}(i_1, i_2, \ldots, i_{t-1})$ - Utility obtained in period $t$ from alternative $j$, which depends on all previous choices
    -   $TU_{tj}(i_1, i_2, \ldots, i_{t-1})$ - Total Utility (current and all future time periods) obtained from choosing alternative $j$ in period $t$, assuming the optimal choice is made in all future periods. (aka **Conditional Value Function**) (i.e. conditional on the alternative)
        -   [All possible values of $TU_{tj}(i_1, i_2, \ldots, i_{t-1})$ need to be calculated in order to express the optimal choice in each time period]{.underline}
    -   $TU_t(i_1, i_2, \ldots, i_{t-1})$ - Total Utility obtained from the optimal choice in period $t$, assuming the optimal choice is made in all future periods (aka **Value Function** or **Valuation Function** at time $t$ )
        -   $TU_t(i_1, i_2, \ldots, i_{t-1}) = \max_j TU_{tj}(i_1, i_2, \ldots, i_{t-1})$
-   [Bellman Equation]{.underline}
    -   Incorporates Discounted Utility (See [Terms](econometrics-discrete-choice-models.qmd#sec-econ-dcm-terms){style="color: green"}) into the Value Functions
        -   Generalization of the 2 "college or work" examples above and gives a procedure for how one would go about calculating the utilities for each period.
    -   Value Functions
        -   [Conditional Value Function]{.underline}

            $$
            TU_{tj}(i_1, \ldots, i_{t-1}) = U_{tj}(i_1, \ldots, i_{t-1}) + \delta\max_k[TU_{t+1,k}(i_1, \ldots, i_t = j)]
            $$

            -   Regarding $TU_{t+1}$, since $(i_1, \ldots, i_{t-1})$ says "given the sequence of choices prior to time, $t$," the appending of $i_t = j$ is saying "given all the sequence of choices prior to time $t$ and includeing the current period, $t$, where choice $j$ is made."

            -   Not sure what $k$ is and he didn't say in the video.

        -   [Value Function]{.underline}

            $$
            TU_{t}(i_1, \ldots, i_{t-1}) = \max_j[U_{tj}(i_1, \ldots, i_{t-1}) + \delta\;TU_{t+1}(i_1, \ldots, i_t = j)]
            $$

            -   Says that the total utility for time period $t$ i
            -   $\delta$ - discount rate on utility in future periods (See [Terms](econometrics-discrete-choice-models.qmd#sec-econ-dcm-terms){style="color: green"})
    -   Procedure: Work backwards from the last period to the first period to calculate the overall Total Utility. At each period (except the last period), you are using the utility calculated for the future period directly after it.
    -   Assumptions
        -   Perfect information about:
            -   Utility of each alternative in each future time period
            -   How every possible sequence of choices affects this future utility
    -   With J alternatives in each of T time periods, you have to calculate $J^T \times T$ utilities.
        -   Therefore, only model only broad time periods (e.g. \[college, graduation, retirement\]) in order to reduce the computational burden of calculating all these utilities.

## Endogeneity {#sec-econ-dcm-endo .unnumbered}

-   Need exogenous variation in our explanatory variables in order to give our parameter estimates a "causal" inerpretation
    -   If data are endogenous, our parameters can interpreted as a kind of correlation between the data and choices
    -   *True* exogenous variable are tough to come by
-   [Examples of Endogeneity]{.underline}
    -   Housing choice and commute choice are correlated
        -   People who like public transit live closer to transit stations which makes their travel time lower
        -   Therefore, the coefficient on travel time will be biased upwards
    -   Price and unobserved quality are correlated
        -   Products with higher unobserved quality cost more and are preferrred by customers
        -   Therefore, the coefficient on price with be biased downward and may even have the wrong sign
    -   Price and unobserved marketing are correlated
        -   Large marketing campaigns may be accompanied by sales or increased prices (increased demand $\rightarrow$ decreased supply $\rightarrow$ increased price)
        -   Therefore, the coefficient on price will be biased, but the direction is uncertain.
-   [Solutions]{.underline}
    -   [BLP estimation]{.underline}
    -   [Control Function estimation]{.underline}
        -   When to use Control Functions instead of BLP
            -   If any market shares are zero
                -   Constant terms in BLP are not identified for zero market shares
            -   If you need to control for individual-specific endogeneity rather than market-level endogeneity (not feasible in BLP)
            -   If you don't want to use the Contraction Mapping algorithm.
                -   More complex to code, computationally intensive
    -   Both methods use instruments
        -   Good Instruments:
            -   Correlated with explanatory variables
            -   Exogenous (i.e. uncorrelated with residuals aka random utility aka unobserved utility)
        -   Instruments are very context specific. So in order to find good instruments for your context, you need to know the details about the process you're trying to model.

### BLP (Berry-Levinsoln-Pakes) {#sec-econ-dcm-endo-blp .unnumbered}

-   Uses instruments to isolate exogenous variation in explanatory variables

-   Mixed logit model of demand for a differentiated product using market-level data.

    -   i.e. Estimate how the attributes of a product affect consumer demand

-   Price is one of the most important attributes, but is almost certainly correlated with other unobserved attributes

-   Model includes instruments in a nonlinear model

-   [Utility Model]{.underline}

    -   If consumers also get utility from unobserved attributes, then Price is correlated with the composite error term ($\xi_{jm} + \epsilon_{njm}$)

    -   Therefore observed utility, $V$, gets separated into 2 componets, Consumer and Market.

        $$
        \begin {align}
        U_{njm} &= \delta_{jm} + \tilde V (p_{jm}, \boldsymbol{x}_{jm}, \boldsymbol{s}_n, \boldsymbol{\tilde \beta}_n) + \epsilon_{njm} \\
        \mbox where \;\; \delta_{njm} &= \bar V (p_{jm}, \boldsymbol{x}_{jm}, \boldsymbol{\bar \beta}_n) + \xi_{jm} = \bar{\hat{\boldsymbol{\beta}}}(p_{jm}, \boldsymbol{x}_{jm}) + \xi_{jm}
        \end {align}
        $$

        -   $\tilde V (p_{jm}, \boldsymbol{x}_{jm}, \boldsymbol{s}_n, \boldsymbol{\tilde \beta}_n)$ - Component that varies by consumer

        -   $\bar V (p_{jm}, \boldsymbol{x}_{jm}, \boldsymbol{\bar \beta}_n)$ - Component that varies by products and markets

        -   $\delta_{jm}$ - Effectively becomes a product-market constant term (i.e. intercept that varies by product and market for a Mixed Logit model) that represents the average utility obtained by product $j$ in market $m$

            -   This term gets estimated in the top equation. Then, this $\hat{\delta}$ is used as the LHS to estimate $\bar{\hat{\boldsymbol{\beta}}}$

        -   $p_{jm}$ - Price of product $j$ in market $m$

            -   1 product can be the "outside product" or purchase nothing category (See [Terms](econometrics-discrete-choice-models.qmd#sec-econ-dcm-terms){style="color: green"}) which could be a vector of 0s

        -   $\boldsymbol{x}_{jm}$ - Vector of non-price attribtuies of product $j$ in market $m$

        -   $\boldsymbol{s}_n$ - Vector of demographice characteristics of consumer $n$

        -   $\boldsymbol{\beta}_n$ - Vector of coefficients for consumer $n$

        -   $\xi_{jm}$ - Utility (average) of unobserved attributes of product $j$ in market $m$

        -   $\epsilon_{njm}$ - idiosyncratic (i.e. different per consumer) unobserved utility

        -   The Choice Probability equation for this model looks similar to the Mixed Logit choice probability equation (See lecture video for the math)

-   [Procedure]{.underline}

    -   Estimate the average utility for product $j$ in market $m$, including observable and unobservable attributes (top equation)
    -   Regress this average utilitiy value, $\hat{\delta}$, on price, $p_{jm}$, and other observable attributes, $x_{jm}$, while instrumenting for price. (i.e. IV model)

-   [Issue]{.underline}

    -   $\hat{\delta}_{jm}$ must be estimated for each product in each market. This can result in 100s or even 1000s of terms to estimate.

-   [BLP insights]{.underline}

    -   A set of unique $\delta_{jm}$ terms equates predicted market shares with observed market shares for a given set of $\boldsymbol{\theta}$ parameters
        -   Higher $\delta_{jm}$ means there will be higher market shares for product $j$ in market $m$
    -   Their "Contraction Mapping" algorithm effectively finds these unique $\delta_{jm}$ terms

-   [Contraction Mapping Algorithm]{.underline}

    1.  Start with initial value, $\delta^0$

    2.  Predict the market share for the current constant value, $\hat{S}_{jm}(\boldsymbol{\delta}^s)$, for each product and each market

        -   $\hat{S}_{jm}(\boldsymbol{\delta})$ is the predicted market share (which is a function of delta)
            -   I think these should be the predicted values for the Utility model above except the choice probabilities are now market shares since we're predicting with market-level explanatory variables
        -   The $s$ in the $\delta^s$ term seems to be a counter for which iteration of this algorithm that you're on.

    3.  Adjust each product-market constant term by comparing predicted and observed market share

        $$
        \delta_{jm}^{s+1} = \delta_{jm}^s + \ln \left(\frac{S_{jm}}{\hat{S}_{jm}(\boldsymbol{\delta}^s)}\right)
        $$

        -   i.e. We're adjusting our $\delta$ by the difference of log predicted and log observed market shares

    4.  Repeat steps 2 and 3 until the algorithm converges to the *unique* set of $\hat\delta$ (product-market) constants

        -   Since this is a unique set, I think algorithm has converged with the observed market shares equal the predicted market shares exactly.

-   [Overall Procedure]{.underline}

    1.  Outer-Loop: Search over $\boldsymbol{\theta}$ to optimize the estimation objective function
        -   Inner-Loop: Use contraction mapping to find $\boldsymbol{\delta(\theta)}$, the vector of product-market constant terms conditional on $\theta$
        -   Use $\boldsymbol{\theta}$ and $\boldsymbol{\delta(\theta)}$ to simulate choice probabilities, $P_{njm}(\boldsymbol{\delta(\theta)}, \boldsymbol{\theta})$
        -   Use the choice probabilities to calculate the estimation objective function
    2.  Estimate $\boldsymbol{\bar\beta}$ by regressing $\boldsymbol{\delta_{jm}}$ on $(p_{jm}, \boldsymbol{x}_{jm})$ with price instruments, $\boldsymbol{z}_{jm}$

-   [Estimator Options]{.underline} (See Week 13, video 5 lecture for details)

    -   Maximized Simulated Likelihood (MSL) for step 1 and Two-Stage Least Squares (2SLS) for step 2
    -   MSM - Some kind of method of moments algorithm

### Control Function {#sec-econ-dcm-cfunc .unnumbered}

-   Use instruments to control for endogeneity in explanatory variables

-   [Utility Model]{.underline}

    $$
    \begin {align}
    U_{nj} &= V(y_{nj}, \boldsymbol{x}_{nj}, \boldsymbol{\beta}_n) + \epsilon_{nj} \\
    \\
    \mbox{where} \;\; y_{nj} &= W(\boldsymbol{z}_{nj}, \boldsymbol{\gamma}) + \mu_{nj} \\
    \epsilon_{nj} &= CF(\mu_{nj}, \boldsymbol{\lambda}) + \tilde \epsilon_{nj} \\
    CF(\mu_{nj}, \boldsymbol{\lambda}) &= \mathbb{E}[\epsilon_{nj} \;|\; \mu_{nj}]
    \end {align}
    $$

    -   $y_{nj}$ - Endogenous explanatory variable (e.g price) for consumer $n$ and product $j$
    -   $\boldsymbol{x}_{nj}$ - Vector of non-price attributes for consumer $n$ and product $j$
    -   $\boldsymbol{\beta}_n$ - Vector of coefficients for consumer $n$
        -   Has density, $f(\boldsymbol{\beta}_n,\boldsymbol{\theta})$
    -   $\epsilon_{nj}$ - Unobserved utility for consumer $n$ and product $j$ (i.e. residuals)
    -   $\tilde \epsilon_{nj}$ - The leftover unobserved utility that is not correlated with $\mu_{nj}$
        -   Has the conditional density $g(\tilde \epsilon_n, \boldsymbol{\mu_n})$
        -   This term controls for the source of endogeneity and therefore $y_{nj}$ is no longer endogenous.
    -   $\boldsymbol{z}_{nj}$ - Vector of exogenous instruments for $y_{nj}$
    -   $\boldsymbol{\gamma}$ - Parameters that relate $y_{nj}$ to $\boldsymbol{z}_{nj}$
    -   $\mu_{nj}$ - Unobserved factors that affect $y_{nj}$ (i.e. residuals)
    -   $CF(\mu_{nj}, \boldsymbol{\lambda})$ - Control Function that contains all the endogenous variation between $\epsilon_{nj}$ and $\mu_{nj}$
        -   Typically modeled as linear, $CF(\mu_{nj}, \boldsymbol{\lambda}) = \lambda \mu_{nj}$, but it's important the this term is specified correctly else $y_{nj}$ will remain endogenous.

-   [Assumptions]{.underline}

    -   $\epsilon_{nj}$ and $\mu_{n}$ are correlated. Therefore,
        -   $y_{nj}$ and $\epsilon_{nj}$, so $y_{nj}$ is endogenous
        -   $\mathbb{E}[\epsilon_{nj} \;|\; \mu_{nj}] \neq 0$ hence the use of the control function
    -   $\epsilon_{nj}$ and $\mu_{n}$ are independent of $\boldsymbol{z}_{nj}$. Therefore,
        -   $\boldsymbol{z}_{nj}$ are good instruments for $y_{nj}$

-   [Procedure]{.underline}

    1.  Estimate $\hat\mu_{nj}$ by regressing $y_{nj}$ on $\boldsymbol{z}_{nj}$
        -   Therefore,$\hat\mu_{nj}$ will be the residuals of this regression
    2.  Estimate $(\boldsymbol{\hat\theta}, \boldsymbol{\hat\lambda})$ by Maximized Simulated Likelihood (MSL) using the simulated choice probabilities to construct a simulated log-likelihood function

## Multinomial Probit {.unnumbered}

-   Assumes a Normal distribution of errors which can deal with heteroscedasticity and correlation of the errors.
