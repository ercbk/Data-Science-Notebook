# Typst {#sec-quarto-typst .unnumbered}

## Misc {#sec-quarto-typst-misc .unnumbered}

-   Alternative to LaTeX for formatting pdfs.

-   Also see [Job, Reports \>\> Layouts](job-reports.qmd#sec-job-reports-lay){style="color: green"}

-   Packages

    -   [{]{style="color: #990000"}[r2typ](https://y-sunflower.github.io/r2typ/){style="color: #990000"}[}]{style="color: #990000"} - An R package for generating Typst markup

-   Resources

    -   [Docs](https://typst.app/docs/guides/)
    -   Reference
        -   [Syntax](https://typst.app/docs/reference/syntax/)
        -   [Layout Functions](https://typst.app/docs/reference/layout/)
    -   [Quarto Options](https://quarto.org/docs/reference/formats/typst.html)
    -   [Typst CSS](https://quarto.org/docs/blog/posts/2024-07-02-beautiful-tables-in-typst/), [Other Typst CSS](https://quarto.org/docs/advanced/typst/typst-css.html) Docs

-   Notes from

    -   [Typst or LaTeX?](https://nrennie.rbind.io/talks/satrdays-london-2024/slides.html#/section)

-   Comparison with LaTeX

    -   LaTeX

        ``` latex
        \usepackage{geometry}
        \usepackage{eso-pic}
        \usepackage{xcolor}
        \geometry{a4paper, total={170mm,257mm}, left=20mm, top=20mm, bottom=20mm, right=50mm}
        \definecolor{light}{HTML}{E6E6FA}
        \AddToShipoutPicture{% 
          \AtPageLowerLeft{% 
              \put(\LenToUnit{\dimexpr\paperwidth-3cm},0){% 
                  \color{light}\rule{3cm}{\LenToUnit\paperheight}}%
           }%
        }%
        ```

        -   Advantages
            -   You want to include equations (currently easier in LaTeX)
            -   (Currently) more flexibility with images and tables

    -   Typst

        ``` typst
        set page(
          margin: (left: 2cm, right: 1.5cm, top: 2cm, bottom: 2cm),
          background: place(right + top, rect(
            fill: rgb("#E6E6FA"),
            height: 100%,
            width: 3cm,
          ))
        )
        ```

        -   Advantages

            -   Easier to learn
            -   More informative error messages
            -   No extra installations
            -   Speed

-   Font

    ``` yaml
    ---
    title: "My document"
    format: 
      typst:
        mainfont: "Cascadia Code"
    ---
    ```

## Components {#sec-quarto-typst-comp .unnumbered}

-   [Bindings]{.underline}
    -   `let` ([docs](https://typst.app/docs/reference/scripting/#bindings))
        -   Used to define variables ([valid variable names](https://typst.app/docs/reference/scripting/#identifiers))
        -   Used to create a [custom named function](https://typst.app/docs/reference/foundations/function/#defining-functions)
        -   Used to destructure [arrays](https://typst.app/docs/reference/foundations/array/) and [dictionaries](https://typst.app/docs/reference/foundations/dictionary/).
-   [Context]{.underline} ([docs](https://typst.app/docs/reference/context/)) -
    -   `context` - Keyword that precedes an expression and ensures that it is computed with knowledge of its environment.
    -   Gives us access to set rule values
        -   Accessing a field

            ``` typst
            set text(lang: "de")
            // output: de
            context text.lang
            ```

        -   Context expression stored as a variable

            ``` typst
            let value = context text.lang
            // output: en (default)
            value

            set text(lang: "de")
            // output: de
            value
            ```
    -   Locates where in the document you currently are, relative to other elements, and absolutely on the pages
        -   Retrieve the value of the heading counter ([source](https://typst.app/docs/reference/context/#location-context))

            ``` typst
            set heading(numbering: "1.")

            = Introduction <intro>
            lorem(5)

            // output: (1,)
            context counter(heading).get()

            = Background <back>
            lorem(5)

            // output: (2,)
            context counter(heading).get()

            context [
              // output: (2,)
              counter(heading).at(here()) \
              // output: (1,)
              counter(heading).at(<intro>)
            ]
            ```

            -   Results in headings, "1. Introduction" and "2. Background" — each with 5 ipsum lorem words underneath.
            -   `.at(here())` produces the same result as `.get` but is more flexible.
            -   A location in the document can also be accessed through labels (e.g. [intro]{.var-text})
-   [Functions]{.underline} ([docs](https://typst.app/docs/reference/foundations/function/))
    -   [Text]{.underline}
        -   `text` ([docs](https://typst.app/docs/reference/text/text/)) - Customizes the look and layout of text in a variety of ways.
            -   Use to set rules and directly. While the set rule is often the simpler choice, calling the text function directly can be useful when passing text as an argument to another function.
    -   [Layout]{.underline}
        -   `align` ([docs](https://typst.app/docs/reference/layout/align/)) - Aligns content horizontally and vertically
        -   `block` ([docs](https://typst.app/docs/reference/layout/block/)) - A block-level container
            -   Can give a background to content while still allowing it to break across multiple pages
            -   Can force elements that would otherwise be inline to become block-level
        -   `grid` ([docs](https://typst.app/docs/reference/layout/grid/)) - Allows you to arrange content in a grid. You can define the number of rows and columns, as well as the size of the gutters between them. There are multiple sizing modes for columns and rows that can be used to create complex layouts.
        -   `place` ([docs](https://typst.app/docs/reference/layout/place/)) - Places content relatively to its parent container
        -   `v` ([docs](https://typst.app/docs/reference/layout/v/)) - Vertical spacing
    -   [Definitions]{.underline} ([docs](https://typst.app/docs/reference/foundations/function/#definitions)) - These are used like methods in python. These are definitions that I think are available to most functions. Note that *fields* are also accessed in this manner (See Context).
        -   `.fields` - Fields to filter for
        -   `.where` - Returns a selector that filters for elements belonging to this function whose fields have the values of the given arguments.
        -   `.with` - Returns a new function that has the given arguments pre-applied.
    -   [Foundations]{.underline} ([docs](https://typst.app/docs/reference/foundations/)) - Basic data types like integers and strings as well as details about core computational functions
        -   `datetime` ([docs](https://typst.app/docs/reference/foundations/datetime/)) - A date, a time, or a combination of both.
            -   `.today` - Current date
            -   `.display` - Displays the datetime in a specified format
    -   [Introspection]{.underline} ([docs](https://typst.app/docs/reference/introspection/)) - For interactions between document parts. Often used with `context`
        -   `counter` ([docs](https://typst.app/docs/reference/introspection/counter/)) - Counts through pages, elements, figures, etc. Access and manipulate page, section, figure, and equation counters or create custom ones.
            -   Definitions: `.at`, `.display`, `.final`, `.get`, `.step`, `.update`
    -   [Visualize]{.underline} ([docs](https://typst.app/docs/reference/visualize/)) - Shapes, line, color gradients, etc.
        -   `line` ([docs](https://typst.app/docs/reference/visualize/line/))
-   [Rules]{.underline}
    -   `set` ([docs](https://typst.app/docs/reference/styling/#set-rules)) - Allows you to customize the appearance of elements. They are written as a function call to an element function preceded by the `set` keyword (or `#set` in markup).
    -   `show` ([docs](https://typst.app/docs/reference/styling/#show-rules)) - Used to customize the look of a particular element
        -   show-set: Written as the `show` keyword followed by a [selector](https://typst.app/docs/reference/foundations/selector/) (e.g. element function), a colon and then a set rule.
        -   Transformational: Allows you to provide an even more customized format for an element.
            -   Replace the set rule after the colon with an arbitrary [function](https://typst.app/docs/reference/foundations/function/). This function receives the element in question and can return arbitrary content.
            -   The function is often defined inline as `it => ..` using the unnamed function syntax. The function's parameter is typically named "it" by convention.

## Templates {#sec-quarto-typst-temp .unnumbered}

-   [Example 1]{.ribbon-highlight}: Basic

    -   YAML

        ``` yaml
        ---
        title: "My document"
        format:
          typst:
              template-partials:
                - typst-template.typ
                - typst-show.typ
        ---
        ```

        -   `typst-show.typ` takes the variables from the quarto document and passes them to typst

        -   `typst-template.typ` - Once typst has the quarto variables, it creates this template which is used to create the pdf

    -   Show

        ``` typst
        #show: article.with(
        $if(title)$
          title: "$title$",
        $endif$
        )

        # another example with a param town in quarto yaml
        #show: psc-report.with(
          $if(title)$
            title: "$title$",
          $endif$
          $if(params.town)$
            town: "$params.town$",
          $endif$
        )
        ```

        -   Says if there's a title in the qmd, then create a variable, [title]{.var-text}, with its value

    -   Template

        ``` typst
        #let article(
          // The document title.
          title: "Some title",
          // The document content.
          body
        ) = {

          // Set document metadata.
          set document(title: title)

          // Links should be purple.
          show link: set text(rgb("#800080"))

          // Title.
          text(weight: 800, upper(title))
        ```

-   [Example 2]{.ribbon-highlight} ([source](https://www.youtube.com/watch?v=bp1SMhLoz_M&ab_channel=PositPBC))\
    ![](_resources/Quarto-Documents.resources/typst-ex2-report.png){.lightbox width="256"}

    -   Show

        ``` typst
        #show: psc-report.with(
          $if(title)$
            title: "$title$",
          $endif$
          $if(params.town)$
            town: "$params.town$",
          $endif$
        )
        ```

        -   Sets variables for [title]{.var-text} metadata and [town]{.var-text} param from quarto YAML

    -   Template

        <details>

        <summary>Code</summary>

        ``` typst
        #let psc-report(
          title: "title",
          town: "town",
          body,
        ) = {

          // text style for whole report
          set text(
           font: "Open Sans",
           size: 12pt,
          )


          set page(

            // dimensions of document
            paper: "us-letter", // or "a4"
            margin: (left: 1in, 
                     right: 1in, 
                     top: 0.7in, 
                     bottom: 1in),

            // places blue rectangle in header
            background: 
              place(top, 
                    rect(fill: rgb("15397F"), // hex-code for color
                         width: 100%, 
                         height: 0.5in
                    )
              ),

            // creates layout for text in header rectangle
            header: align(
              horizon,
              grid(
                columns: (80%, 20%), // div sizes for title, town text
                // title text properties
                align(left, 
                      text(size: 20pt, 
                           fill: white, 
                           weight: "bold", 
                           title)),
                // town text properties
                align(right, 
                      text(size: 12pt, 
                           fill: white, 
                           weight: "bold", 
                           town)
                )
              )
            ),

            // page number, image
            footer: align(
              grid(
                columns: (40%, 60%), // page number, graphic
                align(horizon, 
                      text(fill: rgb("15397F"), 
                      size: 12pt, 
                      counter(page).display("1"))), // sets page number
                align(right, 
                      image("assets/psclogo.svg", 
                            height: 300%)
                )
              )
            )

         body
        }
        ```

        -   The function , `psc-report`, arguments set the variable values (from the show file) for [title]{.var-text} and [town]{.var-text}
            -   Variables seen in the [header]{.arg-text} section
        -   Sections: `set text`, `set page`, body
        -   Functions: text, page, place, grid, align

        </details>

-   [Example 3]{.ribbon-highlight}: Sales Report ([source](https://joekirincic.com/posts/burst-reporting-on-a-budget/), [github](https://github.com/joekirincic/burst-reporting), R \>\> Code \>\> Reports \>\> burst-reporting)

    ::: {layout-ncol="2"}
    ![1](_resources/Quarto-Typst.resources/temp-ex3-report-1.jpg){.lightbox group="temp-ex3" width="332"}

    ![2](_resources/Quarto-Typst.resources/temp-ex3-report-2.jpg){.lightbox group="temp-ex3" width="332"}

    ![3](_resources/Quarto-Typst.resources/temp-ex3-report-3.jpg){.lightbox group="temp-ex3" width="332"}

    ![4](_resources/Quarto-Typst.resources/temp-ex3-report-4.jpg){.lightbox group="temp-ex3" width="332"}
    :::

    -   The complete code is in the github and directory

    -   Template

        -   Header

            <Details>

            <Summary>Code</Summary>

            ``` typst
            #let sales-report(
              title: "Monthly Sales Report",
              store-name: "Store Name",
              store-id: "000",
              report-period: "Month YYYY",
              report-date: datetime.today().display(),
              country: "",
              state: "",
              body
            ) = {
              // Color palette as variables for consistency
              let primary-color = rgb("#1e3a8a")
              let secondary-color = rgb("#3b82f6")
              // ... additional colors ...

              set page(
                paper: "us-letter",
                margin: (top: 2.5cm, bottom: 2.5cm, left: 2cm, right: 2cm),
                header: context {
                  // First page gets branded header; subsequent pages get minimal header
                  if counter(page).get().first() == 1 {
                    // ... logo, company name, date ...
                  } else {
                    // ... store name, period, page number ...
                  }
                }
              )

              // Heading styles using show rules
              show heading.where(level: 1): it => block(
                width: 100%,
                above: 24pt,
                below: 16pt,
                {
                  text(size: 20pt, weight: "bold", fill: primary-color, it.body)
                  v(6pt)
                  line(length: 100%, stroke: 1.5pt + secondary-color)
                }
              )

              body
            }
            ```

            -   SCSS color variables are set with the `let` keyword
            -   `sales-report` sections
                -   `set page` section applies the custom header to the first page using `context` and `counter`
                -   `show heading` styles the H1 ([level: 1]{.arg-text}) headers
            -   Functions: `page`, `counter`, `block`, `text`, `v`, `line`

            </Details>

        -   KPI Boxes

            <Details>

            <Summary>Code</Summary>

            ``` typst
            #let kpi-box(title, value, change: none, color: rgb("#3b82f6")) = {
              box(
                width: 100%,
                fill: rgb("#f9fafb"),
                inset: 12pt,
                radius: 4pt,
                stroke: 1pt + rgb("#e5e7eb"),
                {
                  text(size: 9pt, weight: "semibold", fill: rgb("#6b7280"), upper(title))
                  v(4pt)
                  text(size: 18pt, weight: "bold", fill: color, value)
                  if change != none {
                    v(2pt)
                    text(
                      size: 8pt,
                      fill: if change > 0 { rgb("#059669") } else { rgb("#dc2626") },
                      weight: "medium",
                      if change > 0 { [↑ +#change%] } else { [↓ #change%] }
                    )
                  }
                }
              )
            }
            ```

            -   Shows the percent change since the last reporting period, and colors it differently based on whether the change is positive or negative.

            </Details>

## Extensions {#sec-quarto-typst-ext .unnumbered}

-   Installing the extension downloads a .typ file with some styling
-   Usage
    -   Example: dept-news extension

        ``` yaml
        ---
        title: "Chemistry Department"
        format:
          dept-news-typst: default
        ---
        ```
