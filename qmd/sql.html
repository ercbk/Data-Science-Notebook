<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.3.361">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>Data Science Notebook - SQL</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../site_libs/clipboard/clipboard.min.js"></script>
<script src="../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../site_libs/quarto-search/fuse.min.js"></script>
<script src="../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../">
<link href="../qmd/stochastic-processes.html" rel="next">
<link href="../qmd/spreadsheets.html" rel="prev">
<script src="../site_libs/quarto-html/quarto.js"></script>
<script src="../site_libs/quarto-html/popper.min.js"></script>
<script src="../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../site_libs/quarto-html/anchor.min.js"></script>
<link href="../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 20,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>


<link rel="stylesheet" href="../styles.css">
</head>

<body class="nav-sidebar floating">


<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
      <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="../qmd/sql.html">SQL</a></li></ol></nav>
      <a class="flex-grow-1" role="button" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
      </a>
      <button type="button" class="btn quarto-search-button" aria-label="" onclick="window.quartoOpenSearch();">
        <i class="bi bi-search"></i>
      </button>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal sidebar-navigation floating overflow-auto">
    <div class="pt-lg-2 mt-2 text-left sidebar-header">
    <div class="sidebar-title mb-0 py-0">
      <a href="../">Data Science Notebook</a> 
        <div class="sidebar-tools-main tools-wide">
    <a href="https://ericbook.netlify.app/" title="" class="quarto-navigation-tool px-1" aria-label=""><i class="bi bi-house-fill"></i></a>
    <a href="https://github.com/ercbk/Data-Science-Notebook" title="Source Code" class="quarto-navigation-tool px-1" aria-label="Source Code"><i class="bi bi-github"></i></a>
  <a href="" class="quarto-reader-toggle quarto-navigation-tool px-1" onclick="window.quartoToggleReader(); return false;" title="Toggle reader mode">
  <div class="quarto-reader-toggle-btn">
  <i class="bi"></i>
  </div>
</a>
</div>
    </div>
      </div>
        <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Search"></div>
        </div>
        </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Preface</span></a>
  </div>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" aria-expanded="false">
 <span class="menu-text">Algorithms</span></a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" aria-expanded="false" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-1" class="collapse list-unstyled sidebar-section depth1 ">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../qmd/algorithms-learn-to-rank.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Learn-to-Rank</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../qmd/algorithms-marketing.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Marketing</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../qmd/algorithms-ml.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">1</span>&nbsp; <span class="chapter-title">Algorithms, ML</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../qmd/algorithms-product.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">Algorithms, Product</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../qmd/algorithms-recommendation.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">Algorithms, Recommendation</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../qmd/anomaly-detection.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">Anomaly Detection</span></span></a>
  </div>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" aria-expanded="false">
 <span class="menu-text">Apache</span></a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" aria-expanded="false" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-2" class="collapse list-unstyled sidebar-section depth1 ">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../qmd/apache-arrow.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">5</span>&nbsp; <span class="chapter-title">Apache, Arrow</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../qmd/apache-spark.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">6</span>&nbsp; <span class="chapter-title">Spark</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../qmd/apis.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">APIs</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../qmd/aws.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">7</span>&nbsp; <span class="chapter-title">AWS</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../qmd/base-r.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Base R</span></a>
  </div>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" aria-expanded="false">
 <span class="menu-text">Bayes</span></a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" aria-expanded="false" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-3" class="collapse list-unstyled sidebar-section depth1 ">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../qmd/bayes-priors.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">8</span>&nbsp; <span class="chapter-title">Bayes, priors</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../qmd/bayes-reporting.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">9</span>&nbsp; <span class="chapter-title">Bayes, Reporting</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../qmd/bayes-troubleshooting-hmc.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">10</span>&nbsp; <span class="chapter-title">Bayes, Troubleshooting HMC</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../qmd/bayes-workflow.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">11</span>&nbsp; <span class="chapter-title">Bayes, Workflow</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../qmd/big-data.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Big Data</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../qmd/business-plots.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">12</span>&nbsp; <span class="chapter-title">Business Plots</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../qmd/causal-inference.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">13</span>&nbsp; <span class="chapter-title">Causal Inference</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../qmd/classification.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">14</span>&nbsp; <span class="chapter-title">Classification</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../qmd/cli.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">15</span>&nbsp; <span class="chapter-title">CLI</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../qmd/cloud-services.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">16</span>&nbsp; <span class="chapter-title">Cloud Services</span></span></a>
  </div>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-4" aria-expanded="false">
 <span class="menu-text">Clustering</span></a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-4" aria-expanded="false" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-4" class="collapse list-unstyled sidebar-section depth1 ">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../qmd/clustering-time-series.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">17</span>&nbsp; <span class="chapter-title">Clustering, Time Series</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../qmd/clustering-general.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">18</span>&nbsp; <span class="chapter-title">Clustering</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-5" aria-expanded="false">
 <span class="menu-text">Code</span></a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-5" aria-expanded="false" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-5" class="collapse list-unstyled sidebar-section depth1 ">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../qmd/code-debug.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Debugging</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../qmd/code-optimization.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">19</span>&nbsp; <span class="chapter-title">Code, Optimization</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../qmd/code-snippets.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Snippets</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../qmd/code-style-guide.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">20</span>&nbsp; <span class="chapter-title">Code, Style Guide</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../qmd/code-testing.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">21</span>&nbsp; <span class="chapter-title">Code, Testing</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../qmd/confidence-and-prediction-intervals.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">22</span>&nbsp; <span class="chapter-title">Confidence &amp; Prediction Intervals</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../qmd/correlation-association-and-distance.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">23</span>&nbsp; <span class="chapter-title">Correlation, Association, and Distance</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../qmd/cross-validation.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">24</span>&nbsp; <span class="chapter-title">Cross-Validation</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../qmd/data.table.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">25</span>&nbsp; <span class="chapter-title">data.table</span></span></a>
  </div>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-6" aria-expanded="false">
 <span class="menu-text">Databases</span></a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-6" aria-expanded="false" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-6" class="collapse list-unstyled sidebar-section depth1 ">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../qmd/db-dbt.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">26</span>&nbsp; <span class="chapter-title">DB, dbt</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../qmd/db-duckdb.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">DuckDB</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../qmd/db-engineering.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Engineering</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../qmd/db-feature-stores.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">27</span>&nbsp; <span class="chapter-title">DB, Feature Stores</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../qmd/db-postgres.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">28</span>&nbsp; <span class="chapter-title">DB, postgres</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../qmd/db-relational.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">29</span>&nbsp; <span class="chapter-title">DB, Relational</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../qmd/db-warehouses.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">30</span>&nbsp; <span class="chapter-title">DB, Warehouses</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../qmd/decison-intelligence.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">31</span>&nbsp; <span class="chapter-title">Decison Intelligence</span></span></a>
  </div>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-7" aria-expanded="false">
 <span class="menu-text">Diagnostics</span></a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-7" aria-expanded="false" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-7" class="collapse list-unstyled sidebar-section depth1 ">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../qmd/diagnostics-bayes.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">32</span>&nbsp; <span class="chapter-title">Diagnostics, Bayes</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../qmd/diagnostics-classification.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">33</span>&nbsp; <span class="chapter-title">Diagnostics, Classification</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../qmd/diagnostics-clustering.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">34</span>&nbsp; <span class="chapter-title">Diagnostics, Clustering</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../qmd/diagnostics-cv.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">35</span>&nbsp; <span class="chapter-title">Diagnostics, CV</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../qmd/diagnostics-dl.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">36</span>&nbsp; <span class="chapter-title">Diagnostics, DL</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../qmd/diagnostics-forecasting.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">37</span>&nbsp; <span class="chapter-title">Diagnostics, Forecasting</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../qmd/diagnostics-glm.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">38</span>&nbsp; <span class="chapter-title">Diagnostics, GLM</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../qmd/diagnostics-model-agnostic.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">39</span>&nbsp; <span class="chapter-title">Diagnostics, Model Agnostic</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../qmd/diagnostics-nlp.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">40</span>&nbsp; <span class="chapter-title">Diagnostics, NLP</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../qmd/diagnostics-probabilistic.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">41</span>&nbsp; <span class="chapter-title">Diagnostics, Probabilistic</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../qmd/diagnostics-regression.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">42</span>&nbsp; <span class="chapter-title">Diagnostics, Regression</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../qmd/distributions.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">43</span>&nbsp; <span class="chapter-title">Distributions</span></span></a>
  </div>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-8" aria-expanded="false">
 <span class="menu-text">Deep Learning</span></a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-8" aria-expanded="false" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-8" class="collapse list-unstyled sidebar-section depth1 ">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../qmd/dl-audio.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">44</span>&nbsp; <span class="chapter-title">DL, Audio</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../qmd/dl-general.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">45</span>&nbsp; <span class="chapter-title">DL, General</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../qmd/dl-graph.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">46</span>&nbsp; <span class="chapter-title">DL, Graph</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../qmd/dl-image.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">47</span>&nbsp; <span class="chapter-title">DL, Image</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../qmd/dl-tabular.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">48</span>&nbsp; <span class="chapter-title">DL, Tabular</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../qmd/dl-training.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">49</span>&nbsp; <span class="chapter-title">DL, Training</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-9" aria-expanded="false">
 <span class="menu-text">Docker</span></a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-9" aria-expanded="false" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-9" class="collapse list-unstyled sidebar-section depth1 ">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../qmd/docker-aws.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">50</span>&nbsp; <span class="chapter-title">Docker, AWS</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../qmd/docker-fundamentals.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">51</span>&nbsp; <span class="chapter-title">Docker, Fundamentals</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../qmd/docker-misc.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">52</span>&nbsp; <span class="chapter-title">Docker, Misc</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-10" aria-expanded="false">
 <span class="menu-text">Econometrics</span></a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-10" aria-expanded="false" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-10" class="collapse list-unstyled sidebar-section depth1 ">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../qmd/econometrics-fixed-effects.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">53</span>&nbsp; <span class="chapter-title">Econometrics, Fixed Effects</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../qmd/econometrics-general.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">54</span>&nbsp; <span class="chapter-title">Econometrics, General</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../qmd/econometrics-mixed-effects-bayes.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">55</span>&nbsp; <span class="chapter-title">Econometrics, Mixed Effects, Bayes</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../qmd/econometrics-mixed-effects-frequentist.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">56</span>&nbsp; <span class="chapter-title">Econometrics, Mixed Effects, Frequentist</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-11" aria-expanded="false">
 <span class="menu-text">EDA</span></a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-11" aria-expanded="false" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-11" class="collapse list-unstyled sidebar-section depth1 ">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../qmd/eda-geospatial.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">57</span>&nbsp; <span class="chapter-title">EDA, Geospatial</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../qmd/eda-general.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">58</span>&nbsp; <span class="chapter-title">EDA</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../qmd/eda-multilevel-longitudinal.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">59</span>&nbsp; <span class="chapter-title">EDA, Multilevel, Longitudinal</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../qmd/eda-text.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">60</span>&nbsp; <span class="chapter-title">EDA, Text</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../qmd/eda-time-series.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">61</span>&nbsp; <span class="chapter-title">EDA, Time Series</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-12" aria-expanded="false">
 <span class="menu-text">Experiments</span></a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-12" aria-expanded="false" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-12" class="collapse list-unstyled sidebar-section depth1 ">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../qmd/experiments-a_b-testing.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">62</span>&nbsp; <span class="chapter-title">Experiments, A/B Testing</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../qmd/experiments-analysis.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">63</span>&nbsp; <span class="chapter-title">Experiments, Analysis</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../qmd/experiments-design.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">64</span>&nbsp; <span class="chapter-title">Experiments, Design</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../qmd/experiments-general.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">65</span>&nbsp; <span class="chapter-title">Experiments, General</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../qmd/experiments-rct.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">66</span>&nbsp; <span class="chapter-title">Experiments, RCT</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../qmd/experiments-stepped-wedge-cluster-design.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">67</span>&nbsp; <span class="chapter-title">Experiments, Stepped Wedge Cluster Design</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../qmd/extreme-value-theory-(evt).html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">68</span>&nbsp; <span class="chapter-title">Extreme Value Theory (EVT)</span></span></a>
  </div>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-13" aria-expanded="false">
 <span class="menu-text">Feature Engineering</span></a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-13" aria-expanded="false" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-13" class="collapse list-unstyled sidebar-section depth1 ">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../qmd/feature-engineering-embeddings.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">69</span>&nbsp; <span class="chapter-title">Feature Engineering, Embeddings</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../qmd/feature-engineering-general.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">70</span>&nbsp; <span class="chapter-title">Feature Engineering, General</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../qmd/feature-engineering-geospatial.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">71</span>&nbsp; <span class="chapter-title">Feature Engineering, Geospatial</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../qmd/feature-engineering-time-series.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">72</span>&nbsp; <span class="chapter-title">Feature Engineering, Time Series</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../qmd/feature-engineering-tokenization.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">73</span>&nbsp; <span class="chapter-title">Feature Engineering, Tokenization</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../qmd/feature-reduction.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">74</span>&nbsp; <span class="chapter-title">Feature Reduction</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../qmd/feature-selection.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">75</span>&nbsp; <span class="chapter-title">Feature Selection</span></span></a>
  </div>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-14" aria-expanded="false">
 <span class="menu-text">Forecasting</span></a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-14" aria-expanded="false" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-14" class="collapse list-unstyled sidebar-section depth1 ">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../qmd/forecasting-decomposition.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">76</span>&nbsp; <span class="chapter-title">Forecasting, Decomposition</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../qmd/forecasting-dl.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Deep Learning</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../qmd/forecasting-ensembling.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">77</span>&nbsp; <span class="chapter-title">Forecasting, Ensembling</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../qmd/forecasting-functional.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">78</span>&nbsp; <span class="chapter-title">Forecasting, Functional</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../qmd/forecasting-hierarchical_grouped.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Hierarchical/Grouped</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../qmd/forecasting-ml.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">79</span>&nbsp; <span class="chapter-title">Forecasting, ML</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../qmd/forecasting-multivariate.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Multivariate</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../qmd/forecasting-nonlinear.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">80</span>&nbsp; <span class="chapter-title">Forecasting, Nonlinear</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../qmd/forecasting-statistical.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">81</span>&nbsp; <span class="chapter-title">Forecasting, Statistical</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../qmd/generalized-additive-models-(gam).html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">82</span>&nbsp; <span class="chapter-title">Generalized Additive Models (GAM)</span></span></a>
  </div>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-15" aria-expanded="false">
 <span class="menu-text">Geospatial</span></a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-15" aria-expanded="false" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-15" class="collapse list-unstyled sidebar-section depth1 ">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../qmd/geospatial-analysis.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">83</span>&nbsp; <span class="chapter-title">Geospatial, Analysis</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../qmd/geospatial-general.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">84</span>&nbsp; <span class="chapter-title">Geospatial, General</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../qmd/geospatial-image-classification.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">85</span>&nbsp; <span class="chapter-title">Geospatial, Image Classification</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../qmd/geospatial-processing.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">86</span>&nbsp; <span class="chapter-title">Geospatial, Processing</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-16" aria-expanded="false">
 <span class="menu-text">Git</span></a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-16" aria-expanded="false" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-16" class="collapse list-unstyled sidebar-section depth1 ">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../qmd/git-general.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">87</span>&nbsp; <span class="chapter-title">Git, general</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../qmd/git-github-actions.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">88</span>&nbsp; <span class="chapter-title">Git, Github Actions</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../qmd/glossary-ds-terms.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">89</span>&nbsp; <span class="chapter-title">Glossary: DS terms</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../qmd/gnu-make.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">90</span>&nbsp; <span class="chapter-title">GNU Make</span></span></a>
  </div>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-17" aria-expanded="false">
 <span class="menu-text">Google</span></a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-17" aria-expanded="false" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-17" class="collapse list-unstyled sidebar-section depth1 ">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../qmd/google-analytics-analysis.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">91</span>&nbsp; <span class="chapter-title">Google, Analytics, Analysis</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../qmd/google-analytics-reports.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">92</span>&nbsp; <span class="chapter-title">Google, Analytics, Reports</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../qmd/google-bigquery.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">BigQuery</span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../qmd/gtable-package.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">93</span>&nbsp; <span class="chapter-title">gtable package</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../qmd/h2o-automl.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">94</span>&nbsp; <span class="chapter-title">h2o automl</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../qmd/html-css.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">95</span>&nbsp; <span class="chapter-title">html, css</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../qmd/information-theory.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">96</span>&nbsp; <span class="chapter-title">Information Theory</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../qmd/inkscape.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">97</span>&nbsp; <span class="chapter-title">Inkscape</span></span></a>
  </div>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-18" aria-expanded="false">
 <span class="menu-text">Job</span></a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-18" aria-expanded="false" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-18" class="collapse list-unstyled sidebar-section depth1 ">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../qmd/job-management-leadership.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">98</span>&nbsp; <span class="chapter-title">Job, Management / Leadership</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../qmd/job-on-the-job.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">99</span>&nbsp; <span class="chapter-title">Job, On the job</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../qmd/job-organizational-and-team-development.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">100</span>&nbsp; <span class="chapter-title">Job, Organizational and Team Development</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../qmd/job-reports.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">101</span>&nbsp; <span class="chapter-title">Reports</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../qmd/job-search.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">102</span>&nbsp; <span class="chapter-title">Job, Search</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../qmd/js.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">103</span>&nbsp; <span class="chapter-title">JS</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../qmd/json.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">104</span>&nbsp; <span class="chapter-title">JSON</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../qmd/kubernetes.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">105</span>&nbsp; <span class="chapter-title">Kubernetes</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../qmd/latex.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">106</span>&nbsp; <span class="chapter-title">LaTeX</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../qmd/loss-functions.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">107</span>&nbsp; <span class="chapter-title">Loss Functions</span></span></a>
  </div>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-19" aria-expanded="false">
 <span class="menu-text">Mathematics</span></a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-19" aria-expanded="false" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-19" class="collapse list-unstyled sidebar-section depth1 ">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../qmd/mathematics-linear-algebra.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">108</span>&nbsp; <span class="chapter-title">Linear Algebra</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../qmd/mathematics-glossary.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">109</span>&nbsp; <span class="chapter-title">Mathematics, Glossary</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../qmd/mathematics-notation.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">110</span>&nbsp; <span class="chapter-title">Mathematics, Notation</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../qmd/mathematics-probability.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">111</span>&nbsp; <span class="chapter-title">Probability</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../qmd/mathematics-statistics.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">112</span>&nbsp; <span class="chapter-title">Statistical Concepts</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../qmd/misc.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Misc</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../qmd/missingness.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">113</span>&nbsp; <span class="chapter-title">Missingness</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../qmd/mlops.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">114</span>&nbsp; <span class="chapter-title">MLOps</span></span></a>
  </div>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-20" aria-expanded="false">
 <span class="menu-text">Model Building</span></a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-20" aria-expanded="false" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-20" class="collapse list-unstyled sidebar-section depth1 ">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../qmd/model-building-brms.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">brms</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../qmd/model-building-concepts.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Concepts</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../qmd/model-building-ensembling.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Ensembling</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../qmd/model-building-modeltime.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">modeltime</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../qmd/model-building-rstanarm.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">rstanarm</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../qmd/model-building-sklearn.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">sklearn</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../qmd/model-building-tidymodels.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">tidymodels</span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../qmd/network-analysis.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">115</span>&nbsp; <span class="chapter-title">Network Analysis</span></span></a>
  </div>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-21" aria-expanded="false">
 <span class="menu-text">NLP</span></a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-21" aria-expanded="false" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-21" class="collapse list-unstyled sidebar-section depth1 ">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../qmd/nlp-fine-tuning.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">116</span>&nbsp; <span class="chapter-title">NLP, Fine Tuning</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../qmd/nlp-general.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">117</span>&nbsp; <span class="chapter-title">NLP, General</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../qmd/nlp-llms.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">118</span>&nbsp; <span class="chapter-title">NLP, LLMs</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../qmd/nlp-prompt-engineering.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">119</span>&nbsp; <span class="chapter-title">NLP, Prompt Engineering</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../qmd/nlp-sentiment.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">120</span>&nbsp; <span class="chapter-title">NLP, Sentiment</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../qmd/nlp-topic.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">121</span>&nbsp; <span class="chapter-title">NLP, Topic</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../qmd/nlp-transformers.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">122</span>&nbsp; <span class="chapter-title">NLP, Transformers</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../qmd/optimization-equation-systems.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">123</span>&nbsp; <span class="chapter-title">Optimization, Equation Systems</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../qmd/outliers.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">124</span>&nbsp; <span class="chapter-title">Outliers</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../qmd/package-development.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">125</span>&nbsp; <span class="chapter-title">Package Development</span></span></a>
  </div>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-22" aria-expanded="false">
 <span class="menu-text">Post-Hoc Analysis</span></a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-22" aria-expanded="false" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-22" class="collapse list-unstyled sidebar-section depth1 ">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../qmd/post-hoc-analysis-anova.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">126</span>&nbsp; <span class="chapter-title">Post-Hoc Analysis, ANOVA</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../qmd/post-hoc-analysis-emmeans.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">127</span>&nbsp; <span class="chapter-title">Post-Hoc Analysis, emmeans</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../qmd/post-hoc-analysis-general.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">128</span>&nbsp; <span class="chapter-title">Post-Hoc Analysis, General</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../qmd/post-hoc-analysis-mixed-effects.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">129</span>&nbsp; <span class="chapter-title">Post-Hoc Analysis, Mixed Effects</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../qmd/privacy.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">130</span>&nbsp; <span class="chapter-title">Privacy</span></span></a>
  </div>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-23" aria-expanded="false">
 <span class="menu-text">Production</span></a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-23" aria-expanded="false" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-23" class="collapse list-unstyled sidebar-section depth1 ">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../qmd/production-data-validation.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">131</span>&nbsp; <span class="chapter-title">Production, Data Validation</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../qmd/production-deployment.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Deployment</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../qmd/production-development.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">132</span>&nbsp; <span class="chapter-title">Production, Development</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../qmd/production-ml-monitoring.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">133</span>&nbsp; <span class="chapter-title">Production, ML Monitoring</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../qmd/production-testing.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">134</span>&nbsp; <span class="chapter-title">Production, Testing</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../qmd/production-tools.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">135</span>&nbsp; <span class="chapter-title">Production, Tools</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-24" aria-expanded="false">
 <span class="menu-text">Projects</span></a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-24" aria-expanded="false" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-24" class="collapse list-unstyled sidebar-section depth1 ">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../qmd/project-development.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">136</span>&nbsp; <span class="chapter-title">Project, Development</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../qmd/project-management.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">137</span>&nbsp; <span class="chapter-title">Project, Management</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../qmd/project-planning.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">138</span>&nbsp; <span class="chapter-title">Project, Planning</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-25" aria-expanded="false">
 <span class="menu-text">Python</span></a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-25" aria-expanded="false" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-25" class="collapse list-unstyled sidebar-section depth1 ">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../qmd/python-classes.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">139</span>&nbsp; <span class="chapter-title">Python, Classes</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../qmd/python-general.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">140</span>&nbsp; <span class="chapter-title">Python, General</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../qmd/python-jupyter.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">141</span>&nbsp; <span class="chapter-title">Python, Jupyter</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../qmd/python-misc.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">142</span>&nbsp; <span class="chapter-title">Python, Misc</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../qmd/python-numpy.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">143</span>&nbsp; <span class="chapter-title">Python, Numpy</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../qmd/python-pandas-recipes.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">144</span>&nbsp; <span class="chapter-title">Python, Pandas, Recipes</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../qmd/python-pandas.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Pandas</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../qmd/python-reticulate.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">145</span>&nbsp; <span class="chapter-title">Python, reticulate</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../qmd/quarto-rmarkdown.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Quarto</span></a>
  </div>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-26" aria-expanded="false">
 <span class="menu-text">Regression</span></a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-26" aria-expanded="false" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-26" class="collapse list-unstyled sidebar-section depth1 ">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../qmd/regression-discrete.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">146</span>&nbsp; <span class="chapter-title">Regression, Discrete</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../qmd/regression-gaussian.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">147</span>&nbsp; <span class="chapter-title">Regression, Gaussian</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../qmd/regression-interactions.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">148</span>&nbsp; <span class="chapter-title">Regression, Interactions</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../qmd/regression-logistic.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">149</span>&nbsp; <span class="chapter-title">Regression, Logistic</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../qmd/regression-multivariate.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">150</span>&nbsp; <span class="chapter-title">Regression, Multivariate</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../qmd/regression-nonlinear.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">151</span>&nbsp; <span class="chapter-title">Regression, Nonlinear</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../qmd/regression-ordinal.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">152</span>&nbsp; <span class="chapter-title">Regression, Ordinal</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../qmd/regression-other.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">153</span>&nbsp; <span class="chapter-title">Regression, Other</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../qmd/regression-quantile.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">154</span>&nbsp; <span class="chapter-title">Regression, Quantile</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../qmd/regression-regularized.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">155</span>&nbsp; <span class="chapter-title">Regression, Regularized</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../qmd/regression-survival.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">156</span>&nbsp; <span class="chapter-title">Regression, Survival</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../qmd/renv.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">157</span>&nbsp; <span class="chapter-title">Renv</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../qmd/scraping.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Scraping</span></a>
  </div>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-27" aria-expanded="false">
 <span class="menu-text">Shiny</span></a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-27" aria-expanded="false" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-27" class="collapse list-unstyled sidebar-section depth1 ">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../qmd/shiny-general.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">158</span>&nbsp; <span class="chapter-title">Shiny, General</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../qmd/shiny-hosting.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">159</span>&nbsp; <span class="chapter-title">Shiny, Hosting</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../qmd/shiny-modules.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">160</span>&nbsp; <span class="chapter-title">Shiny, Modules</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../qmd/shiny-production.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">161</span>&nbsp; <span class="chapter-title">Shiny, Production</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../qmd/shiny-python.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">162</span>&nbsp; <span class="chapter-title">Shiny, Python</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../qmd/shiny-ui.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">163</span>&nbsp; <span class="chapter-title">Shiny, UI</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../qmd/shiny-ui-examples.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">164</span>&nbsp; <span class="chapter-title">Shiny, UI Examples</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../qmd/simulation-data.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">165</span>&nbsp; <span class="chapter-title">Simulation, Data</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../qmd/slack.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">166</span>&nbsp; <span class="chapter-title">Slack</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../qmd/spreadsheets.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">167</span>&nbsp; <span class="chapter-title">Spreadsheets</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../qmd/sql.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text">SQL</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../qmd/stochastic-processes.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">168</span>&nbsp; <span class="chapter-title">Stochastic Processes</span></span></a>
  </div>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-28" aria-expanded="false">
 <span class="menu-text">Surveys</span></a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-28" aria-expanded="false" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-28" class="collapse list-unstyled sidebar-section depth1 ">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../qmd/surveys-analysis.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">169</span>&nbsp; <span class="chapter-title">Surveys, Analysis</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../qmd/surveys-census-data.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">170</span>&nbsp; <span class="chapter-title">Surveys, Census Data</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../qmd/surveys-design.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">171</span>&nbsp; <span class="chapter-title">Surveys, Design</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../qmd/surveys-sampling-methods.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">172</span>&nbsp; <span class="chapter-title">Surveys, Sampling Methods</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../qmd/teaching.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">173</span>&nbsp; <span class="chapter-title">Teaching</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../qmd/tidyeval.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">174</span>&nbsp; <span class="chapter-title">Tidyeval</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../qmd/tuning.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">175</span>&nbsp; <span class="chapter-title">Tuning</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../qmd/visualization.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">176</span>&nbsp; <span class="chapter-title">Visualization</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../qmd/vs-code.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">177</span>&nbsp; <span class="chapter-title">VS Code</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../qmd/web-design.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">178</span>&nbsp; <span class="chapter-title">Web Design</span></span></a>
  </div>
</li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Table of contents</h2>
   
  <ul>
  <li><a href="#sec-sql-misc" id="toc-sec-sql-misc" class="nav-link active" data-scroll-target="#sec-sql-misc">Misc</a></li>
  <li><a href="#sec-sql-setup" id="toc-sec-sql-setup" class="nav-link" data-scroll-target="#sec-sql-setup">Set-up</a></li>
  <li><a href="#sec-sql-terms" id="toc-sec-sql-terms" class="nav-link" data-scroll-target="#sec-sql-terms">Terms</a></li>
  <li><a href="#sec-sql-basics" id="toc-sec-sql-basics" class="nav-link" data-scroll-target="#sec-sql-basics">Basics</a>
  <ul class="collapse">
  <li><a href="#sec-sql-basics-ctabs" id="toc-sec-sql-basics-ctabs" class="nav-link" data-scroll-target="#sec-sql-basics-ctabs">Create Tables</a></li>
  <li><a href="#sec-sql-basics-add" id="toc-sec-sql-basics-add" class="nav-link" data-scroll-target="#sec-sql-basics-add">Add Data</a></li>
  <li><a href="#sec-sql-basics-subq" id="toc-sec-sql-basics-subq" class="nav-link" data-scroll-target="#sec-sql-basics-subq">Subqueries</a></li>
  <li><a href="#sec-sql-basics-joins" id="toc-sec-sql-basics-joins" class="nav-link" data-scroll-target="#sec-sql-basics-joins">Joins</a></li>
  </ul></li>
  <li><a href="#sec-sql-r" id="toc-sec-sql-r" class="nav-link" data-scroll-target="#sec-sql-r">R</a></li>
  <li><a href="#sec-sql-bestp" id="toc-sec-sql-bestp" class="nav-link" data-scroll-target="#sec-sql-bestp">Best Practices</a></li>
  <li><a href="#sec-sql-index" id="toc-sec-sql-index" class="nav-link" data-scroll-target="#sec-sql-index">Indexes</a></li>
  <li><a href="#sec-sql-part" id="toc-sec-sql-part" class="nav-link" data-scroll-target="#sec-sql-part">Partitioning</a></li>
  <li><a href="#sec-sql-views" id="toc-sec-sql-views" class="nav-link" data-scroll-target="#sec-sql-views">Views</a></li>
  <li><a href="#sec-sql-vars" id="toc-sec-sql-vars" class="nav-link" data-scroll-target="#sec-sql-vars">Variables</a></li>
  <li><a href="#sec-sql-funs" id="toc-sec-sql-funs" class="nav-link" data-scroll-target="#sec-sql-funs">Functions</a></li>
  <li><a href="#sec-sql-udfs" id="toc-sec-sql-udfs" class="nav-link" data-scroll-target="#sec-sql-udfs">User Defined Functions (UDF)</a></li>
  <li><a href="#sec-sql-loops" id="toc-sec-sql-loops" class="nav-link" data-scroll-target="#sec-sql-loops">Loops</a></li>
  <li><a href="#sec-sql-winfun" id="toc-sec-sql-winfun" class="nav-link" data-scroll-target="#sec-sql-winfun">Window Functions</a></li>
  <li><a href="#sec-sql-ctes" id="toc-sec-sql-ctes" class="nav-link" data-scroll-target="#sec-sql-ctes">Common Table Expressions (CTE)</a></li>
  <li><a href="#sec-sql-str" id="toc-sec-sql-str" class="nav-link" data-scroll-target="#sec-sql-str">Strings</a></li>
  <li><a href="#sec-sql-arr" id="toc-sec-sql-arr" class="nav-link" data-scroll-target="#sec-sql-arr">Arrays</a></li>
  <li><a href="#sec-sql-bizq" id="toc-sec-sql-bizq" class="nav-link" data-scroll-target="#sec-sql-bizq">Business Queries</a></li>
  <li><a href="#sec-sql-trans" id="toc-sec-sql-trans" class="nav-link" data-scroll-target="#sec-sql-trans">Transactions</a></li>
  <li><a href="#sec-sql-procexp" id="toc-sec-sql-procexp" class="nav-link" data-scroll-target="#sec-sql-procexp">Processing Expressions</a></li>
  <li><a href="#sec-sql-tools" id="toc-sec-sql-tools" class="nav-link" data-scroll-target="#sec-sql-tools">Tools</a></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title"><span id="sec-sql" class="quarto-section-identifier">SQL</span></h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  

</header>

<p>TOC</p>
<ul>
<li>Misc</li>
<li>Set-up</li>
<li>Terms</li>
<li>Basics
<ul>
<li>Create Tables</li>
<li>Add data</li>
<li>Subqueries</li>
<li>Joins</li>
</ul></li>
<li>R</li>
<li>Best Practices</li>
<li>Indexes</li>
<li>Partitioning</li>
<li>Views</li>
<li>Variables</li>
<li>Functions</li>
<li>User Defined Functions (UDF)</li>
<li>Window Functions</li>
<li>Common Table Expressions (CTE)</li>
<li>Strings</li>
<li>Arrays</li>
<li>Transactions</li>
<li>Business Queries</li>
<li>Processing Expressions</li>
<li>Tools</li>
</ul>
<section id="sec-sql-misc" class="level2 unnumbered">
<h2 class="unnumbered anchored" data-anchor-id="sec-sql-misc">Misc</h2>
<ul>
<li><p><code>dplyr::show_query</code> can convert a dplyr expression to SQL for db object (e.g.&nbsp;dbplyr,&nbsp; duckdb, arrow)</p></li>
<li><p>Queries in examples</p>
<ul>
<li>Window Functions
<ul>
<li>Average Salary by Job Title</li>
<li>Average Unit Price for each CustomerId</li>
<li>Rank customers by amount spent</li>
<li>Create a new column that ranks Unit Price in descending order for each CustomerId</li>
<li>Create a new column that provides the previous order date’s Quantity for each ProductId</li>
<li>Create a new column that provides the very first Quantity ever ordered for each ProductId</li>
<li>Calculate a cumulative moving average UnitPrice for each CustomerId</li>
<li>Rank customers for each department by amount spent</li>
<li>Find the model and year of the car that been on the lot the longest</li>
<li>Create a subset (CTE)
<ul>
<li>Calculate a running monthly total (aka cumsum)
<ul>
<li>Also running average</li>
</ul></li>
<li>Calculate a running monthly total for each account id</li>
<li>Calculate a 3 months rolling running total using a window that includes the current month.</li>
<li>Calculate a 7 months rolling running total using a window where the current month is always the middle month</li>
</ul></li>
</ul></li>
<li>CTE
<ul>
<li>Average monthly cost per campaign for the company’s marketing efforts</li>
<li>Count the number of interactions of new users</li>
<li>The average top Math test score for students in California</li>
</ul></li>
<li>Business Queries
<ul>
<li>7-day Simple Moving Average (SMA)</li>
<li>Rank product categories by shipping cost for each shipping address</li>
<li>Daily counts of open jobs (where “open” is an untracked daily status)</li>
<li>Get the latest order from each customer</li>
</ul></li>
</ul></li>
<li><p>Order of Operations<br>
<img src="./_resources/SQL.resources/1-MCyFDF35OZ3n0dyZqX6_Tw.png" class="img-fluid"></p>
<ul>
<li>Higher ranked functions can be inserted inside lower ranked functions
<ul>
<li>e.g a window function can be inside a SELECT function but not inside a WHERE clause</li>
<li>There are exceptions and hacks around this in some cases</li>
</ul></li>
</ul></li>
<li><p>Types of Commands</p>
<ul>
<li>Data Query Language (DQL) - used to find and view data without making any permanent changes to the database.</li>
<li>Data Manipulation Language (DML) - used to make permanent changes to the data, such as updating values or deleting them.</li>
<li>Data Definition Language (DDL) - used to make permanent changes to the table, such as creating or deleting a table.</li>
<li>Data Control Language (DCL) - used for administrative commands, such as adding or removing users of different tables and databases.</li>
<li>Transact Control Language (TCL) - advanced SQL that deals with transaction level statements.</li>
</ul></li>
<li><p>Microsoft SQL Server format for referencing a table:</p>
<ul>
<li><p>[database].[schema].[tablename]</p></li>
<li><p>Alternative</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode sql code-with-copy"><code class="sourceCode sql"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="kw">USE</span> my_data_base</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a>GO</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div></li>
</ul></li>
<li><p>Check if a table is updatable</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode sql code-with-copy"><code class="sourceCode sql"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="kw">SELECT</span> table_name, is_updatable</span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a><span class="kw">FROM</span> information_schema.views</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<ul>
<li><p>Useful if some of the tables you are working with are missing values that you need to add</p></li>
<li><p>If not updatable, then you’ll need to contact the database administrator to request permission to update that specific table</p></li>
<li><p>Show all tables</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode sql code-with-copy"><code class="sourceCode sql"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a>SHOW <span class="kw">FULL</span> <span class="kw">TABLES</span> <span class="co">-- mysql</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div></li>
</ul></li>
</ul>
</section>
<section id="sec-sql-setup" class="level2 unnumbered">
<h2 class="unnumbered anchored" data-anchor-id="sec-sql-setup">Set-up</h2>
<ul>
<li>postgres
<ul>
<li><a href="https://www.postgresql.org/download/">Download</a> postgres</li>
<li><a href="https://www.pgadmin.org/download/">pgAdmin</a> is an IDE commonly used with postgres
<ul>
<li>Open pgAdmin and click on “Add new server.”
<ul>
<li>Sets up connection to existing server so make sure postgres is installed beforehand</li>
</ul></li>
<li>Create Tables
<ul>
<li>home &gt;&gt; Databases (1) &gt;&gt; postgres &gt;&gt; Query Tool</li>
</ul></li>
<li>If needed, give <a href="https://stackoverflow.com/questions/14083311/permission-denied-when-trying-to-import-a-csv-file-from-pgadmin">permission</a> to pgAdmin to access data from a folder
<ul>
<li>Might be necessary to upload csv files</li>
</ul></li>
<li>Import csv file
<ul>
<li>right-click the table name &gt;&gt; Import/Export</li>
<li>Options tab
<ul>
<li>Select import, add file path to File Name, choose csv for format, select Yes for Header, add , for Delimiter</li>
</ul></li>
<li>Columns tab
<ul>
<li>uncheck columns not in the csv (probably the primary key)
<ul>
<li>Wonder if NULLs will be automatically inserted for columns in the table that aren’t in the file.</li>
</ul></li>
</ul></li>
</ul></li>
</ul></li>
</ul></li>
</ul>
</section>
<section id="sec-sql-terms" class="level2 unnumbered">
<h2 class="unnumbered anchored" data-anchor-id="sec-sql-terms">Terms</h2>
<ul>
<li><strong>Batch</strong> - a set of sql statements e.g.&nbsp;statements between BEGIN and END</li>
<li><strong>Compiled object</strong> - you can create a function written in C/C++ and load into the database (at least in postgres) to achieve high performance.</li>
<li>Correlated Columns - tells how good the match between logical and physical ordering is.</li>
<li><strong>Correlated/Uncorrelated</strong> <strong>Subqueries</strong>
<ul>
<li><p>correlated- a type of query, where inner query depends upon the outcome of the outer query in order to perform its execution</p>
<ul>
<li>A correlated subquery can be thought of as a filter on the table that it refers to, as if the subquery were evaluated on each row of the table in the outer query</li>
</ul></li>
<li><p>uncorrelated - a type of sub-query where inner query doesn’t depend upon the outer query for its execution.</p>
<ul>
<li>It is an independent query, the results of which are returned to and used by the outer query once (not per row).</li>
</ul>
<div class="sourceCode" id="cb4"><pre class="sourceCode sql code-with-copy"><code class="sourceCode sql"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="co">-- Uncorrelated subquery:</span></span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a><span class="co">-- inner query, c1, only depends on table2</span></span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a><span class="kw">select</span> c1, c2</span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a>&nbsp; <span class="kw">from</span> table1 <span class="kw">where</span> c1 <span class="op">=</span> (<span class="kw">select</span> <span class="fu">max</span>(x) <span class="kw">from</span> table2);</span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-6"><a href="#cb4-6" aria-hidden="true" tabindex="-1"></a><span class="co">-- Correlated subquery:</span></span>
<span id="cb4-7"><a href="#cb4-7" aria-hidden="true" tabindex="-1"></a><span class="co">-- inner query, c1, depends on table1 and table2</span></span>
<span id="cb4-8"><a href="#cb4-8" aria-hidden="true" tabindex="-1"></a><span class="kw">select</span> c1, c2</span>
<span id="cb4-9"><a href="#cb4-9" aria-hidden="true" tabindex="-1"></a>&nbsp; <span class="kw">from</span> table1 <span class="kw">where</span> c1 <span class="op">=</span> (<span class="kw">select</span> x <span class="kw">from</span> table2 <span class="kw">where</span> y <span class="op">=</span> table1.c2);</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div></li>
</ul></li>
<li><strong>Functions</strong> execute at a different level of priority and are handled differently than Views. You will likely see better performance.</li>
<li><strong>Index</strong> - a quick lookup table (e.g.&nbsp;field or set of fields) for finding records users need to search frequently. An index is small, fast, and optimized for quick lookups. It is very useful for connecting the relational tables and searching large tables. (also see <a href="../qmd/db-engineering.html#sec-db-eng-costopt">DB, Engineering</a> &gt;&gt; Cost Optimizations)</li>
<li><strong>Migrations (schema)</strong> - version control system for your database schema. Management of incremental, reversible changes and version control to relational database schemas. A schema migration is performed on a database whenever it is necessary to update or revert that database’s schema to some newer or older version.</li>
<li><strong>Physical Ordering</strong> - A PostgreSQL table consists of one or more files of 8KB blocks (or “pages”). The order in which the rows are stored in the file is the physical ordering.</li>
<li><strong>Predicate</strong> - defines a logical condition being applied to rows in a table. (e.g.&nbsp;IN, EXISTS, BETWEEEN, LIKE, ALL, ANY)</li>
<li><strong>Scalar/Non-Scalar Subqueries</strong>
<ul>
<li>A scalar subquery returns a single value (one column of one row). If no rows qualify to be returned, the subquery returns NULL.</li>
<li>A non-scalar subquery returns 0, 1, or multiple rows, each of which may contain 1 or multiple columns. For each column, if there is no value to return, the subquery returns NULL. If no rows qualify to be returned, the subquery returns 0 rows (not NULLs).</li>
</ul></li>
<li><strong>Selectivity</strong> - the fraction of rows in a table or partition that is chosen by the predicate
<ul>
<li>Refers to the quality of a filter in its ability to reduce the number of rows that will need to be examined and ultimately returned
<ul>
<li>With a high selectivity, using the primary key or indexes to get right to the rows of interest</li>
<li>With a low selectivity, a full table scan would likely be needed to get the rows of interest.</li>
</ul></li>
<li>Higher selectivity means: more unique data; fewer duplicates; fewer number of rows for each key value</li>
<li>Used to estimate the cost of a particular access method; it is also used to determine the optimal join order. A poor choice of join order by the optimizer could result in a very expensive execution plan.</li>
</ul></li>
<li><strong>Soft-deleted</strong> - An operation in which a flag is used to mark data as unusable, without erasing the data itself from the database</li>
<li><strong>Surrogate key</strong> - very similar to a primary key in that it is a unique value for an object in a table. However, rather than being derived from actual data present in the table, it is a field generated by the object itself. It has no business value like a primary key does, but is rather only used for data analysis purposes. Can be generated using different columns that already exist in your table or more often from two or more tables. <a href="https://github.com/dbt-labs/dbt-utils#surrogate_key-source">dbt function definition</a>
<ul>
<li>Examples: PostgreSQL serial column, Oracle sequence column, or MySQL auto_increment column, Snowflake _file + _line columns</li>
<li>Example: Each employee id is concatenated with a department id (e.g.&nbsp;marketing or finance)<br>
<img src="./_resources/SQL.resources/1-upKcdpMyn4wxcKk8wuHj4A.png" class="img-fluid"></li>
</ul></li>
<li><strong>Transaction</strong> - a set of queries tied together such that if one query fails, the entire set of queries are rolled back to a pre-query state if the situation dictates.
<ul>
<li>A database transaction, by definition, must be atomic, consistent, isolated and durable. These are popularly known as <strong>ACID</strong> properties.&nbsp; These properties can ensure the concurrent execution of multiple transactions without conflict.</li>
</ul></li>
<li><strong>Views</strong> - database objects that represent saved SELECT queries in “virtual” tables.
<ul>
<li>Contains a query plan. &nbsp;For each query executed, the planner has to evaluate what’s being asked and calculate an optimal path. Views already have this plan calculated so it allows subsequent queries to be returned with almost no friction in processing aside from data retrieval.</li>
<li>Some views are updateable but under certain conditions (1-1 mapping of rows in view to underlying table, no group_by, etc.)</li>
</ul></li>
</ul>
</section>
<section id="sec-sql-basics" class="level2 unnumbered">
<h2 class="unnumbered anchored" data-anchor-id="sec-sql-basics">Basics</h2>
<section id="sec-sql-basics-ctabs" class="level3 unnumbered">
<h3 class="unnumbered anchored" data-anchor-id="sec-sql-basics-ctabs">Create Tables</h3>
<ul>
<li><p>If you don’t include the schema as part of the table name (e.g.&nbsp;schema_name.table_name), pgadmin automatically places it into the “public” schema directory</p></li>
<li><p>Field Syntax: name, data type, constraints</p></li>
<li><p><span class="ribbon-highlight">Example</span>: Create table as select (CTAS)</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode sql code-with-copy"><code class="sourceCode sql"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="kw">CREATE</span> <span class="kw">TABLE</span> new_table AS&nbsp;</span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a><span class="kw">SELECT</span> <span class="op">*</span>&nbsp;</span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a><span class="kw">FROM</span> old_table&nbsp;</span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a><span class="kw">WHERE</span> condition;</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div></li>
<li><p><span class="ribbon-highlight">Example</span>: Table 1 (w/primary key)</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode sql code-with-copy"><code class="sourceCode sql"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="kw">DROP</span> <span class="kw">TABLE</span> <span class="cf">IF</span> <span class="kw">EXISTS</span> classrooms <span class="kw">CASCADE</span>;</span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a><span class="kw">CREATE</span> <span class="kw">TABLE</span> classrooms (</span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a>&nbsp; &nbsp; <span class="kw">id</span> <span class="dt">INT</span> <span class="kw">PRIMARY</span> <span class="kw">KEY</span> <span class="kw">GENERATED</span> ALWAYS <span class="kw">AS</span> IDENTITY,</span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a>&nbsp; &nbsp; teacher <span class="dt">VARCHAR</span>(<span class="dv">100</span>)</span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a>&nbsp; &nbsp; );</span>
<span id="cb6-6"><a href="#cb6-6" aria-hidden="true" tabindex="-1"></a> <span class="co">-- OR</span></span>
<span id="cb6-7"><a href="#cb6-7" aria-hidden="true" tabindex="-1"></a><span class="kw">CREATE</span> <span class="kw">TABLE</span> classrooms (&nbsp;</span>
<span id="cb6-8"><a href="#cb6-8" aria-hidden="true" tabindex="-1"></a>&nbsp; &nbsp; <span class="kw">id</span> <span class="dt">INT</span> <span class="kw">GENERATED</span> ALWAYS <span class="kw">AS</span> IDENTITY,&nbsp;</span>
<span id="cb6-9"><a href="#cb6-9" aria-hidden="true" tabindex="-1"></a>&nbsp; &nbsp; teacher <span class="dt">VARCHAR</span>(<span class="dv">100</span>)</span>
<span id="cb6-10"><a href="#cb6-10" aria-hidden="true" tabindex="-1"></a>&nbsp; &nbsp; <span class="kw">PRIMARY</span> <span class="kw">KEY</span>(<span class="kw">id</span>)&nbsp;</span>
<span id="cb6-11"><a href="#cb6-11" aria-hidden="true" tabindex="-1"></a>&nbsp; &nbsp; );&nbsp; &nbsp;</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<ul>
<li><p>“classrooms” is the name of the table; “id” and “teacher” are the fields</p></li>
<li><p><code>CASCADE</code> - postgres won’t delete the table if other tables point to it, so cascade will override measure.</p></li>
<li><p><code>GENERATED ALWAYS AS IDENTITY</code> - makes it so you don’t have to keep track of which “id” values have been used when adding rows. You can ommit the value for “id” and just add the values for the other fields</p></li>
<li><p>See <a href="https://www.postgresqltutorial.com/postgresql-identity-column/">tutorial</a> for options, usage, removing, adding, etc. this constraint</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode sql code-with-copy"><code class="sourceCode sql"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="kw">INSERT</span> <span class="kw">INTO</span> classrooms</span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a>&nbsp; &nbsp; (teacher)</span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a><span class="kw">VALUES</span></span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a>&nbsp; &nbsp; (<span class="st">'Mary'</span>),</span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a>&nbsp; &nbsp; (<span class="st">'Jonah'</span>);</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<ul>
<li>Also see Add Data &gt;&gt; Example: chatGPT</li>
</ul></li>
</ul></li>
<li><p><span class="ribbon-highlight">Example</span>: Table 2 (w/foreign key)</p>
<div class="sourceCode" id="cb8"><pre class="sourceCode sql code-with-copy"><code class="sourceCode sql"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="kw">DROP</span> <span class="kw">TABLE</span> <span class="cf">IF</span> <span class="kw">EXISTS</span> students <span class="kw">CASCADE</span>;</span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a><span class="kw">CREATE</span> <span class="kw">TABLE</span> students (</span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a>&nbsp; &nbsp; <span class="kw">id</span> <span class="dt">INT</span> <span class="kw">PRIMARY</span> <span class="kw">KEY</span> <span class="kw">GENERATED</span> ALWAYS <span class="kw">AS</span> IDENTITY,</span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a>&nbsp; &nbsp; name <span class="dt">VARCHAR</span>(<span class="dv">100</span>),</span>
<span id="cb8-5"><a href="#cb8-5" aria-hidden="true" tabindex="-1"></a>&nbsp; &nbsp; classroom_id <span class="dt">INT</span>,</span>
<span id="cb8-6"><a href="#cb8-6" aria-hidden="true" tabindex="-1"></a>&nbsp; &nbsp; <span class="kw">CONSTRAINT</span> fk_classrooms</span>
<span id="cb8-7"><a href="#cb8-7" aria-hidden="true" tabindex="-1"></a>    &nbsp; &nbsp; <span class="kw">FOREIGN</span> <span class="kw">KEY</span>(classroom_id)</span>
<span id="cb8-8"><a href="#cb8-8" aria-hidden="true" tabindex="-1"></a>&nbsp; &nbsp; &nbsp; &nbsp; <span class="kw">REFERENCES</span> classrooms(<span class="kw">id</span>)</span>
<span id="cb8-9"><a href="#cb8-9" aria-hidden="true" tabindex="-1"></a>);</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<ul>
<li>“students” is the name of the table; “id”, “name”, and “classroom_id” are the fields</li>
<li>Create a foreign key that points to the “classrooms” table
<ul>
<li><p>Expression</p>
<ul>
<li>fk_classrooms is the name of the <code>CONSTRAINT</code></li>
<li>“classroom_id” is the field that will be the <code>FOREIGN KEY</code></li>
<li><code>REFERENCES</code> points the foreign key to the classrooms table’s primary key, “id”
<ul>
<li>foreign keys can point to any table</li>
</ul></li>
</ul></li>
<li><p>Postgres won’t allow you to insert a row into students with a “classroom_id” that doesn’t exist in the “id” field of classrooms but will allow you to use a NULL placeholder</p>
<div class="sourceCode" id="cb9"><pre class="sourceCode sql code-with-copy"><code class="sourceCode sql"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="co">-- Explicitly specify NULL</span></span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a><span class="kw">INSERT</span> <span class="kw">INTO</span> students</span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a>&nbsp; &nbsp; (name, classroom_id)</span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a><span class="kw">VALUES</span></span>
<span id="cb9-5"><a href="#cb9-5" aria-hidden="true" tabindex="-1"></a>&nbsp; &nbsp; (<span class="st">'Dina'</span>, <span class="kw">NULL</span>);&nbsp;</span>
<span id="cb9-6"><a href="#cb9-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-7"><a href="#cb9-7" aria-hidden="true" tabindex="-1"></a><span class="co">-- Implicitly specify NULL</span></span>
<span id="cb9-8"><a href="#cb9-8" aria-hidden="true" tabindex="-1"></a><span class="kw">INSERT</span> <span class="kw">INTO</span> students</span>
<span id="cb9-9"><a href="#cb9-9" aria-hidden="true" tabindex="-1"></a>&nbsp; &nbsp; (name)</span>
<span id="cb9-10"><a href="#cb9-10" aria-hidden="true" tabindex="-1"></a><span class="kw">VALUES</span></span>
<span id="cb9-11"><a href="#cb9-11" aria-hidden="true" tabindex="-1"></a>&nbsp; &nbsp; (<span class="st">'Evan'</span>);</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<ul>
<li>Also see Add Data &gt;&gt; Example: chatGPT</li>
</ul></li>
</ul></li>
</ul></li>
<li><p><span class="ribbon-highlight">Example</span></p>
<div class="sourceCode" id="cb10"><pre class="sourceCode sql code-with-copy"><code class="sourceCode sql"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="kw">CREATE</span> <span class="kw">TABLE</span> members (</span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a>&nbsp; &nbsp; <span class="kw">id</span> serial <span class="kw">primary</span> <span class="kw">key</span>,</span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a>&nbsp; &nbsp; second_name <span class="dt">character</span> <span class="dt">varying</span>(<span class="dv">200</span>) <span class="kw">NOT</span> <span class="kw">NULL</span>,</span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a>&nbsp; &nbsp; date_joined <span class="dt">date</span> <span class="kw">NOT</span> <span class="kw">NULL</span> <span class="kw">DEFAULT</span> <span class="fu">current_date</span>,</span>
<span id="cb10-5"><a href="#cb10-5" aria-hidden="true" tabindex="-1"></a>&nbsp; &nbsp; member_id <span class="dt">integer</span> <span class="kw">references</span> members(<span class="kw">id</span>),</span>
<span id="cb10-6"><a href="#cb10-6" aria-hidden="true" tabindex="-1"></a>&nbsp; &nbsp; booking_start_time <span class="dt">timestamp</span> <span class="kw">without</span> timezone <span class="kw">NOT</span> <span class="kw">NULL</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<ul>
<li>The “serial” data type does the same thing as <code>GENERATED ALWAYS AS IDENTITY</code> (see first example), but is NOT compliant with the SQL standard. Use <code>GENERATED ALWAYS AS IDENTITY</code></li>
<li>“references” seems to be another old way to create foreign keys (see 2nd example for proper way)</li>
<li>“character varying” - variable-length with limit (e.g limit of 200 characters)
<ul>
<li>character(n), char(n) are for fixed character lengths; text is for unlimited character lengths</li>
</ul></li>
<li>“current_date” is a function that will insert the current date as a value</li>
<li>“timestamp without timezone” is literally that
<ul>
<li>also available: time with/without timezone, date, interval (see <a href="https://www.postgresql.org/docs/14/datatype-datetime.html">Docs</a> for details)</li>
</ul></li>
</ul></li>
</ul>
</section>
<section id="sec-sql-basics-add" class="level3 unnumbered">
<h3 class="unnumbered anchored" data-anchor-id="sec-sql-basics-add">Add Data</h3>
<ul>
<li><p><span class="ribbon-highlight">Example</span>: Copy/Paste table values into chatGPT to get the query<br>
<img src="./_resources/SQL.resources/image.11.png" class="img-fluid"></p></li>
<li><p><span class="ribbon-highlight">Example</span>: Add data via .csv</p>
<div class="sourceCode" id="cb11"><pre class="sourceCode sql code-with-copy"><code class="sourceCode sql"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="kw">COPY</span> assignments(<span class="kw">category</span>, name, due_date, weight)</span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a><span class="kw">FROM</span> <span class="st">'C:/Users/mgsosna/Desktop/db_data/assignments.csv'</span></span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a>DELIMITER <span class="st">','</span></span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a>CSV <span class="kw">HEADER</span>;</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<ul>
<li>“assignments” is the table; “category”, “name”, “due_date”, “weight” are fields that you want to import from the csv file</li>
<li>** The order of the columns must be the same as the ones in the CSV file **</li>
<li><code>HEADER</code> keyword to indicate that the CSV file contains a header</li>
<li>Might need to have superuser access in order to execute the COPY statement successfully</li>
</ul></li>
</ul>
</section>
<section id="sec-sql-basics-subq" class="level3 unnumbered">
<h3 class="unnumbered anchored" data-anchor-id="sec-sql-basics-subq">Subqueries</h3>
<ul>
<li><p>**Better to used CTEs instead of subqueries**</p>
<ul>
<li>Subqueries make it difficult to understand their context in the larger query</li>
<li>The only way to debug a subquery is by turning it into a CTE or pulling it out of the query entirely.</li>
<li>CTEs and subqueries have a similar runtime, but subqueries make your code more complex for no reason.</li>
</ul></li>
<li><p>Notes from <a href="https://towardsdatascience.com/how-to-use-subqueries-in-sql-da660694b8e3">How to Use SubQueries in SQL</a></p>
<ul>
<li>Also shows the alt method of creating a temporary table to compute the queries</li>
</ul></li>
<li><p>Use cases</p>
<ul>
<li>Filtering rows from a table with the context of another.</li>
<li>Performing double-layer aggregations such as average of averages or an average of sums.</li>
<li>Accessing aggregations with a subquery.</li>
</ul></li>
<li><p>Tables used in examples</p>
<ul>
<li>Store A (store_a)<img src="./_resources/SQL.resources/image.10.png" class="img-fluid">
<ul>
<li>Store B is similar</li>
</ul></li>
</ul></li>
<li><p><span class="ribbon-highlight">Example</span>: Filtering rows</p>
<div class="sourceCode" id="cb12"><pre class="sourceCode sql code-with-copy"><code class="sourceCode sql"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="kw">select</span> <span class="op">*</span> </span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a><span class="kw">from</span> sandbox.store_b</span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a><span class="kw">where</span> product_id <span class="kw">IN</span> (</span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a>&nbsp; &nbsp; <span class="kw">select</span> product_id</span>
<span id="cb12-5"><a href="#cb12-5" aria-hidden="true" tabindex="-1"></a>&nbsp; &nbsp; <span class="kw">from</span> sandbox.store_b</span>
<span id="cb12-6"><a href="#cb12-6" aria-hidden="true" tabindex="-1"></a>&nbsp; &nbsp; <span class="kw">group</span> <span class="kw">by</span> product_id&nbsp;</span>
<span id="cb12-7"><a href="#cb12-7" aria-hidden="true" tabindex="-1"></a>&nbsp; &nbsp; <span class="kw">having</span> <span class="fu">count</span>(product_id) <span class="op">&gt;=</span> <span class="dv">3</span></span>
<span id="cb12-8"><a href="#cb12-8" aria-hidden="true" tabindex="-1"></a>);</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<ul>
<li>filters the rows with products that have been bought at least three times in store_b</li>
</ul></li>
<li><p><span class="ribbon-highlight">Example</span>: Multi-Layer Aggregation</p>
<div class="sourceCode" id="cb13"><pre class="sourceCode sql code-with-copy"><code class="sourceCode sql"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="kw">select</span> <span class="fu">avg</span>(average_price.total_value) <span class="kw">as</span> average_transaction <span class="kw">from</span> (</span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a>&nbsp; <span class="kw">select</span> transaction_id, <span class="fu">sum</span>(price_paid) <span class="kw">as</span> total_value</span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a>&nbsp; <span class="kw">from</span> sandbox.store_a</span>
<span id="cb13-4"><a href="#cb13-4" aria-hidden="true" tabindex="-1"></a>&nbsp; <span class="kw">group</span> <span class="kw">by</span> transaction_id</span>
<span id="cb13-5"><a href="#cb13-5" aria-hidden="true" tabindex="-1"></a>&nbsp; ) <span class="kw">as</span> average_price</span>
<span id="cb13-6"><a href="#cb13-6" aria-hidden="true" tabindex="-1"></a>;</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<ul>
<li>computes the average of all transactions</li>
<li>can’t apply an average directly, as our table is oriented to product_ids and not to transaction_ids</li>
</ul></li>
<li><p><span class="ribbon-highlight">Example</span>: Filtering the table based on an Aggregation</p>
<div class="sourceCode" id="cb14"><pre class="sourceCode sql code-with-copy"><code class="sourceCode sql"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="kw">select</span> @avg_transaction<span class="op">:=</span> <span class="fu">avg</span>(agg_table.total_value)</span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a><span class="kw">from</span> (</span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a>  <span class="kw">select</span> transaction_id, <span class="fu">sum</span>(price_paid) <span class="kw">as</span> total_value</span>
<span id="cb14-4"><a href="#cb14-4" aria-hidden="true" tabindex="-1"></a>  <span class="kw">from</span> sandbox.store_a</span>
<span id="cb14-5"><a href="#cb14-5" aria-hidden="true" tabindex="-1"></a>  <span class="kw">group</span> <span class="kw">by</span> transaction_id</span>
<span id="cb14-6"><a href="#cb14-6" aria-hidden="true" tabindex="-1"></a>) <span class="kw">as</span> agg_table;</span>
<span id="cb14-7"><a href="#cb14-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-8"><a href="#cb14-8" aria-hidden="true" tabindex="-1"></a><span class="kw">select</span> <span class="op">*</span>&nbsp;</span>
<span id="cb14-9"><a href="#cb14-9" aria-hidden="true" tabindex="-1"></a><span class="kw">from</span> sandbox.store_a</span>
<span id="cb14-10"><a href="#cb14-10" aria-hidden="true" tabindex="-1"></a><span class="kw">where</span> transaction_id <span class="kw">in</span> (</span>
<span id="cb14-11"><a href="#cb14-11" aria-hidden="true" tabindex="-1"></a>  <span class="kw">select</span> transaction_id</span>
<span id="cb14-12"><a href="#cb14-12" aria-hidden="true" tabindex="-1"></a>  <span class="kw">from</span> sandbox.store_a</span>
<span id="cb14-13"><a href="#cb14-13" aria-hidden="true" tabindex="-1"></a>  <span class="kw">group</span> <span class="kw">by</span> transaction_id</span>
<span id="cb14-14"><a href="#cb14-14" aria-hidden="true" tabindex="-1"></a>&nbsp; <span class="kw">having</span> <span class="fu">sum</span>(price_paid) <span class="op">&gt;</span> @avg_transaction</span>
<span id="cb14-15"><a href="#cb14-15" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<ul>
<li>filters transactions that have a value higher than the average (where the output must retain the original product-oriented row)</li>
</ul></li>
</ul>
</section>
<section id="sec-sql-basics-joins" class="level3 unnumbered">
<h3 class="unnumbered anchored" data-anchor-id="sec-sql-basics-joins">Joins</h3>
<p><img src="./_resources/SQL.resources/FPggFYUUcAszeHX.jpeg" class="img-fluid" width="354"><br>
<img src="./_resources/SQL.resources/FPggFYRVkAMc93Z.jpeg" class="img-fluid" width="354"></p>
<ul>
<li><p>Cross Join -&nbsp; acts like an expand_grid; where each value in the join key column gets all combinations of rows in both tables (also see above pic)<br>
<img src="./_resources/SQL.resources/image.9.png" class="img-fluid" width="296"></p>
<ul>
<li><p>Efficient join</p></li>
<li><p>When you add the <code>where</code> clause, the cross join acts similarly to an <code>inner join</code>, except you aren’t joining it on any specified column</p></li>
<li><p><span class="ribbon-highlight">Example</span>:</p>
<div class="sourceCode" id="cb15"><pre class="sourceCode sql code-with-copy"><code class="sourceCode sql"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="kw">SELECT</span></span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a>&nbsp; schedule.event,</span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a>&nbsp; calendar.number_of_days</span>
<span id="cb15-4"><a href="#cb15-4" aria-hidden="true" tabindex="-1"></a><span class="kw">FROM</span> schedule</span>
<span id="cb15-5"><a href="#cb15-5" aria-hidden="true" tabindex="-1"></a><span class="kw">CROSS</span> <span class="kw">JOIN</span> calendar</span>
<span id="cb15-6"><a href="#cb15-6" aria-hidden="true" tabindex="-1"></a><span class="kw">WHERE</span> schedule.total_number <span class="op">&lt;</span> calendar.number_of_days</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<ul>
<li>Only join the row in the “schedule” table with the rows in the “calendar” table that meet the specified condition</li>
</ul></li>
</ul></li>
<li><p>Natural Join - don’t need to specify join columns; need to have two columns in each table with the same name</p>
<ul>
<li>Use cases
<ul>
<li>There are a lot of common columns with the same name across multiple tables
<ul>
<li>They will all be used as joining keys.</li>
</ul></li>
<li>You don’t want to type out all of the common columns in select just to avoid outputting the same columns multiple times.</li>
</ul></li>
</ul>
<div class="sourceCode" id="cb16"><pre class="sourceCode sql code-with-copy"><code class="sourceCode sql"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a><span class="kw">select</span> <span class="op">*</span></span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a><span class="kw">from</span> table_a</span>
<span id="cb16-3"><a href="#cb16-3" aria-hidden="true" tabindex="-1"></a><span class="kw">natural</span> <span class="kw">join</span> table_b</span>
<span id="cb16-4"><a href="#cb16-4" aria-hidden="true" tabindex="-1"></a>;</span>
<span id="cb16-5"><a href="#cb16-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-6"><a href="#cb16-6" aria-hidden="true" tabindex="-1"></a><span class="co">-- natural + outer</span></span>
<span id="cb16-7"><a href="#cb16-7" aria-hidden="true" tabindex="-1"></a><span class="kw">select</span> <span class="op">*</span></span>
<span id="cb16-8"><a href="#cb16-8" aria-hidden="true" tabindex="-1"></a><span class="kw">from</span> table_a</span>
<span id="cb16-9"><a href="#cb16-9" aria-hidden="true" tabindex="-1"></a><span class="kw">natural</span> <span class="kw">outer</span> <span class="kw">join</span> table_b</span>
<span id="cb16-10"><a href="#cb16-10" aria-hidden="true" tabindex="-1"></a>;</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div></li>
</ul>
</section>
</section>
<section id="sec-sql-r" class="level2 unnumbered">
<h2 class="unnumbered anchored" data-anchor-id="sec-sql-r">R</h2>
<ul>
<li><p>Get query from dplyr code</p>
<div class="sourceCode" id="cb17"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a>tbl_to_sql <span class="ot">&lt;-</span> <span class="cf">function</span>(tbl) {</span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a>&nbsp; dplyr<span class="sc">::</span><span class="fu">show_query</span>(tbl) <span class="sc">|&gt;</span>&nbsp;</span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a>&nbsp; &nbsp; <span class="fu">capture.output</span>() <span class="sc">|&gt;</span>&nbsp;</span>
<span id="cb17-4"><a href="#cb17-4" aria-hidden="true" tabindex="-1"></a>&nbsp; &nbsp; purrr<span class="sc">::</span><span class="fu">discard_at</span>(<span class="dv">1</span>) <span class="sc">|&gt;</span>&nbsp;</span>
<span id="cb17-5"><a href="#cb17-5" aria-hidden="true" tabindex="-1"></a>&nbsp; &nbsp; <span class="fu">paste</span>(<span class="at">collapse =</span> <span class="st">" "</span>)</span>
<span id="cb17-6"><a href="#cb17-6" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<ul>
<li><p>Transforms query into a string</p></li>
<li><p>Also see <a href="https://emilyriederer.netlify.app/post/sql-generation/">Generating SQL with <span style="color: #990000">{dbplyr}</span> and sqlfluff</a></p></li>
</ul></li>
<li><p>Connect to or Create a SQLite database</p>
<div class="sourceCode" id="cb18"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a>con <span class="ot">&lt;-</span> DBI<span class="sc">::</span><span class="fu">dbConnect</span>(<span class="at">drv =</span> RSQLite<span class="sc">::</span><span class="fu">SQLite</span>(),</span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; here<span class="sc">::</span><span class="fu">here</span>(<span class="st">"db_name.db"</span>),</span>
<span id="cb18-3"><a href="#cb18-3" aria-hidden="true" tabindex="-1"></a>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="at">timeout =</span> <span class="dv">10</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div></li>
<li><p>Connect to Microsoft SQL Server</p>
<div class="sourceCode" id="cb19"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a>con <span class="ot">&lt;-</span> DBI<span class="sc">::</span><span class="fu">dbConnect</span>(odbc<span class="sc">::</span><span class="fu">odbc</span>(),&nbsp;</span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="at">Driver =</span> <span class="st">"SQL Server"</span>,&nbsp;</span>
<span id="cb19-3"><a href="#cb19-3" aria-hidden="true" tabindex="-1"></a>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="at">Server =</span> <span class="st">"SERVER"</span>,&nbsp;</span>
<span id="cb19-4"><a href="#cb19-4" aria-hidden="true" tabindex="-1"></a>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="at">Database =</span> <span class="st">"DB_NAME"</span>,&nbsp;</span>
<span id="cb19-5"><a href="#cb19-5" aria-hidden="true" tabindex="-1"></a>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="at">Trusted_Connection =</span> <span class="st">"True"</span>,&nbsp;</span>
<span id="cb19-6"><a href="#cb19-6" aria-hidden="true" tabindex="-1"></a>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="at">Port =</span> <span class="dv">1433</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div></li>
<li><p>Close connection: <code>dbDisconnect(con)</code></p></li>
<li><p>Create a table from a data source: <code>df &lt;- dbplyr::tbl(con, "&lt;table name&gt;")</code></p>
<ul>
<li>Allows you to use dplyr verbs with a remote database table then <code>collect</code></li>
</ul></li>
<li><p>Cancel a running query (postgres)</p>
<div class="sourceCode" id="cb20"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Store PID</span></span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a>pid <span class="ot">&lt;-</span> DBI<span class="sc">::</span><span class="fu">dbGetInfo</span>(conn)<span class="sc">$</span>pid</span>
<span id="cb20-3"><a href="#cb20-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-4"><a href="#cb20-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Cancel query and get control of IDE back</span></span>
<span id="cb20-5"><a href="#cb20-5" aria-hidden="true" tabindex="-1"></a><span class="co"># SQL command</span></span>
<span id="cb20-6"><a href="#cb20-6" aria-hidden="true" tabindex="-1"></a>SELECT <span class="fu">pg_cancel_backend</span>(<span class="sc">&lt;</span>PID<span class="sc">&gt;</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<ul>
<li>Useful if query is running too long and you want control of your IDE back</li>
</ul></li>
<li><p>Create single tables from a list of tibbles to a database</p>
<div class="sourceCode" id="cb21"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a>purrr<span class="sc">::</span><span class="fu">map2</span>(table_names, list_of_tbls, <span class="sc">~</span> <span class="fu">dbWriteTable</span>(con, .x, .y))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div></li>
<li><p>Load all tables from a database into a list</p>
<div class="sourceCode" id="cb22"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a>tables <span class="ot">&lt;-</span> <span class="fu">dbListTables</span>(con)&nbsp;</span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a>all_data <span class="ot">&lt;-</span> <span class="fu">map</span>(tables, dbReadTable, <span class="at">conn =</span> con)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div></li>
<li><p>Can use map_dfr if all the tables have the same columns</p></li>
<li><p>Dynamic queries with <span style="color: #990000">{glue}</span></p>
<ul>
<li><p><span class="ribbon-highlight">Example</span>: MS SQL Server</p>
<div class="sourceCode" id="cb23"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a>vars <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"columns"</span>, <span class="st">"you"</span>, <span class="st">"want"</span>, <span class="st">"to"</span>, <span class="st">"select"</span>)</span>
<span id="cb23-2"><a href="#cb23-2" aria-hidden="true" tabindex="-1"></a>date_var <span class="ot">&lt;-</span> <span class="st">'date_col'</span></span>
<span id="cb23-3"><a href="#cb23-3" aria-hidden="true" tabindex="-1"></a>start_date <span class="ot">&lt;-</span> <span class="fu">as.Date</span>(<span class="st">'2022-01-01'</span>)</span>
<span id="cb23-4"><a href="#cb23-4" aria-hidden="true" tabindex="-1"></a>today <span class="ot">&lt;-</span> <span class="fu">Sys.Date</span>()</span>
<span id="cb23-5"><a href="#cb23-5" aria-hidden="true" tabindex="-1"></a>tablename <span class="ot">&lt;-</span> <span class="st">"yourtablename"</span></span>
<span id="cb23-6"><a href="#cb23-6" aria-hidden="true" tabindex="-1"></a>schema_name <span class="ot">&lt;-</span> <span class="st">"yourschema"</span></span>
<span id="cb23-7"><a href="#cb23-7" aria-hidden="true" tabindex="-1"></a>query <span class="ot">&lt;-</span> <span class="fu">glue_sql</span>(<span class="at">.con =</span> con, <span class="st">"SELECT TOP(10) {`vars`*} FROM {`schema_name`}.{`tablename`} "</span>)</span>
<span id="cb23-8"><a href="#cb23-8" aria-hidden="true" tabindex="-1"></a>DBI<span class="sc">::</span><span class="fu">dbGetQuery</span>(con, query)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<ul>
<li><code>vars</code> format collapses the vars vector, separated by commas, so that it resembles a SELECT statement</li>
</ul></li>
</ul></li>
</ul>
</section>
<section id="sec-sql-bestp" class="level2 unnumbered">
<h2 class="unnumbered anchored" data-anchor-id="sec-sql-bestp">Best Practices</h2>
<ul>
<li>Misc
<ul>
<li>Resources
<ul>
<li><a href="https://www.sqlstyle.guide/">SQL Style Guide</a></li>
</ul></li>
<li>Use aliases only when table names are long enough so that using them improves readability (but choose meaningful aliases)</li>
<li>Do not use&nbsp;SELECT *. Explicitly list columns instead</li>
<li>Use comments to document business logic</li>
<li>A comment at the top should provide a high-level description</li>
<li>Use an auto-formatter</li>
<li>General Optimizations
<ul>
<li>Removing duplicates or filtering out null values at the beginning of your model will speed up queries</li>
<li>Replace complex code with window functions
<ul>
<li><span class="ribbon-highlight">Example</span>: Replace <code>GROUP_BY</code> + <code>TOP</code> with a partition + <code>FIRST_VALUE()</code>
<ul>
<li>e.g.&nbsp;<code>FIRST_VALUE(test_score) OVER(PARTITION BY student_name ORDER BY test_score DESC)</code></li>
</ul></li>
<li><span class="ribbon-highlight">Example</span>: <code>AVG(test_score) OVER(PARTITION BY student_name)</code></li>
</ul></li>
</ul></li>
</ul></li>
<li>CTEs
<ul>
<li>Break down logic in CTEs using&nbsp;WITH … AS</li>
<li>The&nbsp;SELECT&nbsp;statement inside each CTE must do a single thing (join, filter or aggregate)</li>
<li>The CTE name should provide a high-level explanation</li>
<li>The last statement should be a&nbsp;SELECT&nbsp;statement querying the last CTE</li>
</ul></li>
<li>Joins
<ul>
<li>Use&nbsp;WHERE&nbsp;for filtering, not for joining</li>
<li>Favor&nbsp;LEFT JOIN&nbsp;over&nbsp;INNER JOIN; in most cases, it’s essential to know the distribution of&nbsp;NULLs</li>
<li>Avoid using”Self-Joins.” Use window functions instead (see <a href="../qmd/google-bigquery.html#sec-goog-bigq-opt" style="color: green">Google, BigQuery &gt;&gt; Optimization</a> for details on self-joins)</li>
<li>When doing equijoins (i.e., joins where all conditions have the&nbsp;something=another&nbsp;form), use the&nbsp;USING&nbsp;keyword</li>
<li>Break-up joins using OR into UNION because SQL uses nested operations for JOIN + OR queries which slow things.
<ul>
<li>Bad<br>
<img src="./_resources/SQL.resources/1-9K5I9iIKl5gUoYe9mw2CXw.png" class="img-fluid" width="335"></li>
<li>Good<br>
<img src="./_resources/SQL.resources/1-rXsv2pEUKL3qBkM7DK8bVQ.png" class="img-fluid" width="328"></li>
<li>UNION simply joins the outputs of two separate SELECT statements and retains only one occurrence of duplicated rows if there are any.</li>
</ul></li>
</ul></li>
<li>Style Guide<br>
<img src="./_resources/SQL.resources/1-HOcSBns8ec2jIO5A0gGHEw.png" class="img-fluid" width="912"></li>
</ul>
</section>
<section id="sec-sql-index" class="level2 unnumbered">
<h2 class="unnumbered anchored" data-anchor-id="sec-sql-index">Indexes</h2>
<ul>
<li><p>Misc</p>
<ul>
<li>An index may consist of up to 16 columns</li>
<li>The first column of the index must always be present in the query’s filter, order , join or group operations to be used</li>
</ul></li>
<li><p>Create Index on an existing table (postgres)</p>
<div class="sourceCode" id="cb24"><pre class="sourceCode sql code-with-copy"><code class="sourceCode sql"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a><span class="kw">CREATE</span> <span class="kw">INDEX</span></span>
<span id="cb24-2"><a href="#cb24-2" aria-hidden="true" tabindex="-1"></a>&nbsp; &nbsp; score_index <span class="kw">ON</span> grades(score, student);</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<ul>
<li>“score_index” is the name of the index</li>
<li>“grades” is the name of the table</li>
<li>“score” and “student” are fields to be used as the indexes</li>
</ul></li>
<li><p>Create Index that only uses a specific character length</p>
<div class="sourceCode" id="cb25"><pre class="sourceCode sql code-with-copy"><code class="sourceCode sql"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a><span class="co">/* mysql */</span></span>
<span id="cb25-2"><a href="#cb25-2" aria-hidden="true" tabindex="-1"></a><span class="kw">CREATE</span> <span class="kw">TABLE</span> test (blob_col <span class="dt">BLOB</span>, <span class="kw">INDEX</span>(blob_col(<span class="dv">10</span>)));</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<ul>
<li>index only uses the first 10 characters of the column value of a BLOB column type</li>
</ul></li>
<li><p>Create index with multiple columns</p>
<div class="sourceCode" id="cb26"><pre class="sourceCode sql code-with-copy"><code class="sourceCode sql"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a><span class="co">/* mysql */</span></span>
<span id="cb26-2"><a href="#cb26-2" aria-hidden="true" tabindex="-1"></a><span class="kw">CREATE</span> <span class="kw">TABLE</span> test (</span>
<span id="cb26-3"><a href="#cb26-3" aria-hidden="true" tabindex="-1"></a>&nbsp; &nbsp; id&nbsp; &nbsp; &nbsp; &nbsp; <span class="dt">INT</span> <span class="kw">NOT</span> <span class="kw">NULL</span>,</span>
<span id="cb26-4"><a href="#cb26-4" aria-hidden="true" tabindex="-1"></a>&nbsp; &nbsp; last_name&nbsp; <span class="dt">CHAR</span>(<span class="dv">30</span>) <span class="kw">NOT</span> <span class="kw">NULL</span>,</span>
<span id="cb26-5"><a href="#cb26-5" aria-hidden="true" tabindex="-1"></a>&nbsp; &nbsp; first_name <span class="dt">CHAR</span>(<span class="dv">30</span>) <span class="kw">NOT</span> <span class="kw">NULL</span>,</span>
<span id="cb26-6"><a href="#cb26-6" aria-hidden="true" tabindex="-1"></a>&nbsp; &nbsp; <span class="kw">PRIMARY</span> <span class="kw">KEY</span> (<span class="kw">id</span>),</span>
<span id="cb26-7"><a href="#cb26-7" aria-hidden="true" tabindex="-1"></a>&nbsp; &nbsp; <span class="kw">INDEX</span> name (last_name,first_name)</span>
<span id="cb26-8"><a href="#cb26-8" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div></li>
<li><p>Usage of multiple column index (** order of columns is important **)</p>
<div class="sourceCode" id="cb27"><pre class="sourceCode sql code-with-copy"><code class="sourceCode sql"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a><span class="kw">SELECT</span> <span class="op">*</span> <span class="kw">FROM</span> test <span class="kw">WHERE</span> last_name<span class="op">=</span><span class="st">'Jones'</span>;</span>
<span id="cb27-2"><a href="#cb27-2" aria-hidden="true" tabindex="-1"></a><span class="kw">SELECT</span> <span class="op">*</span> <span class="kw">FROM</span> test</span>
<span id="cb27-3"><a href="#cb27-3" aria-hidden="true" tabindex="-1"></a>&nbsp; <span class="kw">WHERE</span> last_name<span class="op">=</span><span class="st">'Jones'</span> <span class="kw">AND</span> first_name<span class="op">=</span><span class="st">'John'</span>;</span>
<span id="cb27-4"><a href="#cb27-4" aria-hidden="true" tabindex="-1"></a><span class="kw">SELECT</span> <span class="op">*</span> <span class="kw">FROM</span> test</span>
<span id="cb27-5"><a href="#cb27-5" aria-hidden="true" tabindex="-1"></a>&nbsp; <span class="kw">WHERE</span> last_name<span class="op">=</span><span class="st">'Jones'</span></span>
<span id="cb27-6"><a href="#cb27-6" aria-hidden="true" tabindex="-1"></a>&nbsp; <span class="kw">AND</span> (first_name<span class="op">=</span><span class="st">'John'</span> <span class="kw">OR</span> first_name<span class="op">=</span><span class="st">'Jon'</span>);</span>
<span id="cb27-7"><a href="#cb27-7" aria-hidden="true" tabindex="-1"></a><span class="kw">SELECT</span> <span class="op">*</span> <span class="kw">FROM</span> test</span>
<span id="cb27-8"><a href="#cb27-8" aria-hidden="true" tabindex="-1"></a>&nbsp; <span class="kw">WHERE</span> last_name<span class="op">=</span><span class="st">'Jones'</span></span>
<span id="cb27-9"><a href="#cb27-9" aria-hidden="true" tabindex="-1"></a>&nbsp; <span class="kw">AND</span> first_name <span class="op">&gt;=</span><span class="st">'M'</span> <span class="kw">AND</span> first_name <span class="op">&lt;</span> <span class="st">'N'</span>;</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<ul>
<li><p>Index is used when both columns are used as part of filtering criteria or when only the left-most column is used</p></li>
<li><p>if you have a three-column index on (col1, col2, col3), you have indexed search capabilities on (col1), (col1, col2), and (col1, col2, col3).</p></li>
</ul></li>
<li><p><em>Invalid</em> usage of multiple column index</p>
<div class="sourceCode" id="cb28"><pre class="sourceCode sql code-with-copy"><code class="sourceCode sql"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a><span class="kw">SELECT</span> <span class="op">*</span> <span class="kw">FROM</span> test <span class="kw">WHERE</span> first_name<span class="op">=</span><span class="st">'John'</span>;</span>
<span id="cb28-2"><a href="#cb28-2" aria-hidden="true" tabindex="-1"></a><span class="kw">SELECT</span> <span class="op">*</span> <span class="kw">FROM</span> test</span>
<span id="cb28-3"><a href="#cb28-3" aria-hidden="true" tabindex="-1"></a>&nbsp; <span class="kw">WHERE</span> last_name<span class="op">=</span><span class="st">'Jones'</span> <span class="kw">OR</span> first_name<span class="op">=</span><span class="st">'John'</span>;</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<ul>
<li>The “name” index won’t be used in these queries since
<ul>
<li>first_name is NOT the left-most column specified in the index</li>
<li>OR is used instead of AND</li>
</ul></li>
</ul></li>
<li><p>Create index with DESC, ASC</p>
<div class="sourceCode" id="cb29"><pre class="sourceCode sql code-with-copy"><code class="sourceCode sql"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a><span class="co">/* mysql */</span></span>
<span id="cb29-2"><a href="#cb29-2" aria-hidden="true" tabindex="-1"></a><span class="kw">CREATE</span> <span class="kw">TABLE</span> t (</span>
<span id="cb29-3"><a href="#cb29-3" aria-hidden="true" tabindex="-1"></a>&nbsp; c1 <span class="dt">INT</span>, c2 <span class="dt">INT</span>,</span>
<span id="cb29-4"><a href="#cb29-4" aria-hidden="true" tabindex="-1"></a>&nbsp; <span class="kw">INDEX</span> idx1 (c1 <span class="kw">ASC</span>, c2 <span class="kw">ASC</span>),</span>
<span id="cb29-5"><a href="#cb29-5" aria-hidden="true" tabindex="-1"></a>&nbsp; <span class="kw">INDEX</span> idx2 (c1 <span class="kw">ASC</span>, c2 <span class="kw">DESC</span>),</span>
<span id="cb29-6"><a href="#cb29-6" aria-hidden="true" tabindex="-1"></a>&nbsp; <span class="kw">INDEX</span> idx3 (c1 <span class="kw">DESC</span>, c2 <span class="kw">ASC</span>),</span>
<span id="cb29-7"><a href="#cb29-7" aria-hidden="true" tabindex="-1"></a>&nbsp; <span class="kw">INDEX</span> idx4 (c1 <span class="kw">DESC</span>, c2 <span class="kw">DESC</span>)</span>
<span id="cb29-8"><a href="#cb29-8" aria-hidden="true" tabindex="-1"></a>);</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<ul>
<li>Used by <code>ORDER BY</code>
<ul>
<li>See <a href="https://dev.mysql.com/doc/refman/8.0/en/descending-indexes.html">Docs</a> to see what operations and index types support Descending Indexes</li>
</ul></li>
<li>Note: idx_a on column_p, column_q desc is not the same as an * Index idx_a on column_q desc, column p or, * Index idx_b on column_p desc, column q</li>
</ul></li>
<li><p>Usage of Descending Indexes</p>
<div class="sourceCode" id="cb30"><pre class="sourceCode sql code-with-copy"><code class="sourceCode sql"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a><span class="kw">ORDER</span> <span class="kw">BY</span> c1 <span class="kw">ASC</span>, c2 ASC&nbsp; &nbsp; <span class="co">-- optimizer can use idx1</span></span>
<span id="cb30-2"><a href="#cb30-2" aria-hidden="true" tabindex="-1"></a><span class="kw">ORDER</span> <span class="kw">BY</span> c1 <span class="kw">DESC</span>, c2 DESC&nbsp; <span class="co">-- optimizer can use idx4</span></span>
<span id="cb30-3"><a href="#cb30-3" aria-hidden="true" tabindex="-1"></a><span class="kw">ORDER</span> <span class="kw">BY</span> c1 <span class="kw">ASC</span>, c2 DESC&nbsp; <span class="co">-- optimizer can use idx2</span></span>
<span id="cb30-4"><a href="#cb30-4" aria-hidden="true" tabindex="-1"></a><span class="kw">ORDER</span> <span class="kw">BY</span> c1 <span class="kw">DESC</span>, c2 ASC&nbsp; <span class="co">-- optimizer can use idx3</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<ul>
<li>See previous example for definition of idx* names</li>
<li>See <a href="https://dev.mysql.com/doc/refman/8.0/en/descending-indexes.html">Docs</a> to see what operations and index types support Descending Indexes</li>
</ul></li>
</ul>
</section>
<section id="sec-sql-part" class="level2 unnumbered">
<h2 class="unnumbered anchored" data-anchor-id="sec-sql-part">Partitioning</h2>
<ul>
<li>Misc
<ul>
<li>Also see
<ul>
<li>MySQL <a href="https://dev.mysql.com/doc/refman/8.0/en/partitioning-types.html">Docs</a></li>
<li><a href="../qmd/google-bigquery.html#sec-goog-bigq-opt" style="color: green">Google, BigQuery &gt;&gt; Optimization &gt;&gt; Partitioning and Clustering</a></li>
<li><a href="../qmd/db-engineering.html#sec-db-eng-costopt" style="color: green">DB, Engineering &gt;&gt; Cost Optimization &gt;&gt; Partitioning</a></li>
</ul></li>
<li>all of your queries to the partitioned table must contain the <code>partition_key</code> in the <code>WHERE</code> clause</li>
</ul></li>
</ul>
</section>
<section id="sec-sql-views" class="level2 unnumbered">
<h2 class="unnumbered anchored" data-anchor-id="sec-sql-views">Views</h2>
<ul>
<li><p>A smaller data object that contains the subset of data resulting from a specific query</p></li>
<li><p>Whereas a query happens after data is loaded, a materialized view is a precomputation</p></li>
<li><p>The computation is done once, and changes to the data are incorporated as they occur, making subsequent updates to the view much cheaper and more efficient than querying the entire database from scratch.</p></li>
<li><p>Create a View</p>
<ul>
<li><p><span class="ribbon-highlight">Example</span>: Create view as select (CVAS)</p>
<div class="sourceCode" id="cb31"><pre class="sourceCode sql code-with-copy"><code class="sourceCode sql"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a><span class="kw">CREATE</span> <span class="kw">VIEW</span> high_earner AS&nbsp;</span>
<span id="cb31-2"><a href="#cb31-2" aria-hidden="true" tabindex="-1"></a><span class="kw">SELECT</span> p.<span class="kw">id</span> <span class="kw">AS</span> person_id, j.salary</span>
<span id="cb31-3"><a href="#cb31-3" aria-hidden="true" tabindex="-1"></a><span class="kw">FROM</span> People p</span>
<span id="cb31-4"><a href="#cb31-4" aria-hidden="true" tabindex="-1"></a><span class="kw">JOIN</span> Job j&nbsp;</span>
<span id="cb31-5"><a href="#cb31-5" aria-hidden="true" tabindex="-1"></a><span class="kw">ON</span> p.job <span class="op">=</span> j.title</span>
<span id="cb31-6"><a href="#cb31-6" aria-hidden="true" tabindex="-1"></a><span class="kw">WHERE</span> j.salary <span class="op">&gt;=</span> <span class="dv">200000</span>;</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div></li>
</ul></li>
<li><p>Query a view (same as a table): <code>SELECT * FROM high_earner</code></p></li>
<li><p>Update view</p>
<div class="sourceCode" id="cb32"><pre class="sourceCode sql code-with-copy"><code class="sourceCode sql"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a><span class="kw">CREATE</span> <span class="kw">OR</span> <span class="kw">REPLACE</span> <span class="kw">VIEW</span> high_earner AS&nbsp;</span>
<span id="cb32-2"><a href="#cb32-2" aria-hidden="true" tabindex="-1"></a><span class="kw">SELECT</span> p.<span class="kw">id</span> <span class="kw">AS</span> person_id, j.salary</span>
<span id="cb32-3"><a href="#cb32-3" aria-hidden="true" tabindex="-1"></a><span class="kw">FROM</span> People p</span>
<span id="cb32-4"><a href="#cb32-4" aria-hidden="true" tabindex="-1"></a><span class="kw">JOIN</span> Job j&nbsp;</span>
<span id="cb32-5"><a href="#cb32-5" aria-hidden="true" tabindex="-1"></a><span class="kw">ON</span> p.job <span class="op">=</span> j.title</span>
<span id="cb32-6"><a href="#cb32-6" aria-hidden="true" tabindex="-1"></a><span class="kw">WHERE</span> j.salary <span class="op">&gt;=</span> <span class="dv">150000</span>;</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<ul>
<li>Expects the query output to retain the same number of columns, column names, and column data types. Thus, any modification that results in a change in the data structure will raise an error.</li>
</ul></li>
<li><p>List views<br>
<img src="./_resources/SQL.resources/image.4.png" class="img-fluid"></p>
<div class="sourceCode" id="cb33"><pre class="sourceCode sql code-with-copy"><code class="sourceCode sql"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a><span class="kw">SELECT</span> <span class="op">*</span>&nbsp;</span>
<span id="cb33-2"><a href="#cb33-2" aria-hidden="true" tabindex="-1"></a><span class="kw">FROM</span> information_schema.views</span>
<span id="cb33-3"><a href="#cb33-3" aria-hidden="true" tabindex="-1"></a><span class="kw">WHERE</span> table_schema <span class="kw">NOT</span> <span class="kw">IN</span> (<span class="st">'pg_catalog'</span>, <span class="st">'information_schema'</span>);</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<ul>
<li>“table_name” has the names of the views</li>
<li>“view_definition” shows the query stored in the view</li>
<li>WHERE command is included to omit built-in views from PostgreSQL.</li>
</ul></li>
<li><p>Delete view: <code>DROP VIEW high_earner;</code></p></li>
</ul>
</section>
<section id="sec-sql-vars" class="level2 unnumbered">
<h2 class="unnumbered anchored" data-anchor-id="sec-sql-vars">Variables</h2>
<ul>
<li>User-defined
<ul>
<li><p>DECLARE and SET</p>
<div class="sourceCode" id="cb34"><pre class="sourceCode sql code-with-copy"><code class="sourceCode sql"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a><span class="co">-- Declare your variables</span></span>
<span id="cb34-2"><a href="#cb34-2" aria-hidden="true" tabindex="-1"></a><span class="kw">DECLARE</span> @start <span class="dt">date</span></span>
<span id="cb34-3"><a href="#cb34-3" aria-hidden="true" tabindex="-1"></a><span class="kw">DECLARE</span> @stop <span class="dt">date</span></span>
<span id="cb34-4"><a href="#cb34-4" aria-hidden="true" tabindex="-1"></a><span class="co">-- SET the relevant values for each variable</span></span>
<span id="cb34-5"><a href="#cb34-5" aria-hidden="true" tabindex="-1"></a><span class="kw">SET</span> @start <span class="op">=</span> <span class="st">'2021-06-01'</span></span>
<span id="cb34-6"><a href="#cb34-6" aria-hidden="true" tabindex="-1"></a><span class="kw">SET</span> @stop <span class="op">=</span> GETDATE()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<ul>
<li>DECLARE sets the variable type (e.g.&nbsp;date)</li>
<li>SET assigns a value</li>
</ul></li>
<li><p>Or just use DECLARE</p>
<div class="sourceCode" id="cb35"><pre class="sourceCode sql code-with-copy"><code class="sourceCode sql"><span id="cb35-1"><a href="#cb35-1" aria-hidden="true" tabindex="-1"></a><span class="kw">DECLARE</span> @Iteration <span class="dt">Integer</span> <span class="op">=</span> <span class="dv">0</span>;</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div></li>
<li><p>Examples</p>
<ul>
<li><p><span class="ribbon-highlight">Example</span>: Exclude 3 months of data from the query</p>
<div class="sourceCode" id="cb36"><pre class="sourceCode sql code-with-copy"><code class="sourceCode sql"><span id="cb36-1"><a href="#cb36-1" aria-hidden="true" tabindex="-1"></a><span class="kw">SELECT</span> t1.[DATETIME], <span class="fu">COUNT</span>(<span class="op">*</span>) <span class="kw">AS</span> vol</span>
<span id="cb36-2"><a href="#cb36-2" aria-hidden="true" tabindex="-1"></a><span class="kw">FROM</span> Medium.dbo.Earthquakes t1</span>
<span id="cb36-3"><a href="#cb36-3" aria-hidden="true" tabindex="-1"></a><span class="kw">WHERE</span> t1.[DATETIME] <span class="kw">BETWEEN</span> @start <span class="kw">AND</span> DATEADD(<span class="dt">MONTH</span>, <span class="op">-</span><span class="dv">3</span>, @stop)</span>
<span id="cb36-4"><a href="#cb36-4" aria-hidden="true" tabindex="-1"></a><span class="kw">GROUP</span> <span class="kw">BY</span> t1.[DATETIME]</span>
<span id="cb36-5"><a href="#cb36-5" aria-hidden="true" tabindex="-1"></a><span class="kw">ORDER</span> <span class="kw">BY</span> t1.[DATETIME] <span class="kw">DESC</span>;</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<ul>
<li>See above for the definitions of <span class="citation" data-cites="start">@start</span> and <span class="citation" data-cites="stop">@stop</span></li>
</ul></li>
<li><p><span class="ribbon-highlight">Example</span>: Apply a counter</p>
<div class="sourceCode" id="cb37"><pre class="sourceCode sql code-with-copy"><code class="sourceCode sql"><span id="cb37-1"><a href="#cb37-1" aria-hidden="true" tabindex="-1"></a><span class="co">-- Declare the variable (a SQL Command, the var name, the datatype)</span></span>
<span id="cb37-2"><a href="#cb37-2" aria-hidden="true" tabindex="-1"></a><span class="kw">DECLARE</span> @counter <span class="dt">INT</span>;</span>
<span id="cb37-3"><a href="#cb37-3" aria-hidden="true" tabindex="-1"></a><span class="co">-- Set the counter to 20</span></span>
<span id="cb37-4"><a href="#cb37-4" aria-hidden="true" tabindex="-1"></a><span class="kw">SET</span> @counter <span class="op">=</span> <span class="dv">20</span>;</span>
<span id="cb37-5"><a href="#cb37-5" aria-hidden="true" tabindex="-1"></a><span class="co">-- Print the initial value</span></span>
<span id="cb37-6"><a href="#cb37-6" aria-hidden="true" tabindex="-1"></a><span class="kw">SELECT</span> @counter <span class="kw">AS</span> _COUNT;</span>
<span id="cb37-7"><a href="#cb37-7" aria-hidden="true" tabindex="-1"></a><span class="co">-- Select and increment the counter by one</span></span>
<span id="cb37-8"><a href="#cb37-8" aria-hidden="true" tabindex="-1"></a><span class="kw">SELECT</span> @counter <span class="op">=</span> @counter <span class="op">+</span> <span class="dv">1</span>;</span>
<span id="cb37-9"><a href="#cb37-9" aria-hidden="true" tabindex="-1"></a><span class="co">-- Print variable</span></span>
<span id="cb37-10"><a href="#cb37-10" aria-hidden="true" tabindex="-1"></a><span class="kw">SELECT</span> @counter <span class="kw">AS</span> _COUNT;</span>
<span id="cb37-11"><a href="#cb37-11" aria-hidden="true" tabindex="-1"></a><span class="co">-- Select and increment the counter by one</span></span>
<span id="cb37-12"><a href="#cb37-12" aria-hidden="true" tabindex="-1"></a><span class="kw">SELECT</span> @counter <span class="op">+=</span> <span class="dv">1</span>;</span>
<span id="cb37-13"><a href="#cb37-13" aria-hidden="true" tabindex="-1"></a><span class="co">-- Print the variable</span></span>
<span id="cb37-14"><a href="#cb37-14" aria-hidden="true" tabindex="-1"></a><span class="kw">SELECT</span> @counter <span class="kw">AS</span> _COUNT;</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div></li>
</ul></li>
</ul></li>
<li>System
<ul>
<li>ROWCOUNT - returns the number of rows affected by the last previous statement
<ul>
<li><p><span class="ribbon-highlight">Example</span></p>
<div class="sourceCode" id="cb38"><pre class="sourceCode sql code-with-copy"><code class="sourceCode sql"><span id="cb38-1"><a href="#cb38-1" aria-hidden="true" tabindex="-1"></a><span class="cf">BEGIN</span></span>
<span id="cb38-2"><a href="#cb38-2" aria-hidden="true" tabindex="-1"></a>&nbsp; &nbsp; <span class="kw">SELECT</span></span>
<span id="cb38-3"><a href="#cb38-3" aria-hidden="true" tabindex="-1"></a>&nbsp; &nbsp; &nbsp; &nbsp; product_id,</span>
<span id="cb38-4"><a href="#cb38-4" aria-hidden="true" tabindex="-1"></a>&nbsp; &nbsp; &nbsp; &nbsp; product_name</span>
<span id="cb38-5"><a href="#cb38-5" aria-hidden="true" tabindex="-1"></a>&nbsp; &nbsp; <span class="kw">FROM</span></span>
<span id="cb38-6"><a href="#cb38-6" aria-hidden="true" tabindex="-1"></a>&nbsp; &nbsp; &nbsp; &nbsp; production.products</span>
<span id="cb38-7"><a href="#cb38-7" aria-hidden="true" tabindex="-1"></a>&nbsp; &nbsp; <span class="kw">WHERE</span></span>
<span id="cb38-8"><a href="#cb38-8" aria-hidden="true" tabindex="-1"></a>&nbsp; &nbsp; &nbsp; &nbsp; list_price <span class="op">&gt;</span> <span class="dv">100000</span>;</span>
<span id="cb38-9"><a href="#cb38-9" aria-hidden="true" tabindex="-1"></a>&nbsp; &nbsp; <span class="cf">IF</span> @@ROWCOUNT <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb38-10"><a href="#cb38-10" aria-hidden="true" tabindex="-1"></a>&nbsp; &nbsp; &nbsp; &nbsp; PRINT <span class="st">'No product with price greater than 100000 found'</span>;</span>
<span id="cb38-11"><a href="#cb38-11" aria-hidden="true" tabindex="-1"></a><span class="cf">END</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div></li>
</ul></li>
</ul></li>
</ul>
</section>
<section id="sec-sql-funs" class="level2 unnumbered">
<h2 class="unnumbered anchored" data-anchor-id="sec-sql-funs">Functions</h2>
<ul>
<li><p>“||” Concantenate strings. e.g ‘Post’ || ‘greSQL’ –&gt; PostgreSQL</p></li>
<li><p><code>BEGIN</code>…<code>END</code> - defines a compound statement or statement block. A compound statement consists of a set of SQL statements that execute together. A statement block is also known as a batch</p>
<ul>
<li>A compound statement can have a local declaration for a variable, a cursor, a temporary table, or an exception
<ul>
<li>Local declarations can be referenced by any statement in that compound statement, or in any compound statement nested within it.</li>
<li>Local declarations are invisible to other procedures that are called from within a compound statement</li>
</ul></li>
</ul></li>
<li><p><code>COMMIT</code> - a transaction control language that is used to permanently save the changes done in the transaction in tables/databases. The database cannot regain its previous state after its execution of commit.</p></li>
<li><p><code>DATEADD</code> - adds units of time to a variable or value</p>
<ul>
<li>e.g.&nbsp;<code>DATEADD(month, -3, '2021-06-01')</code>
<ul>
<li>subtracts 3 months from 2021-06-01</li>
</ul></li>
</ul></li>
<li><p><code>DATE_TRUNC</code> - pulls a component of a date object.</p>
<ul>
<li>e.g.&nbsp;<code>date_trunc('month', date_var) as month</code></li>
</ul></li>
<li><p><code>DENSE_RANK</code>- similar to the <code>RANK</code> , but it does not skip any numbers even if there is a tie between the rows.</p>
<ul>
<li>Values are ranked by the column specified in ORDER BY expression of the window function</li>
</ul></li>
<li><p><code>EXPLAIN</code> - a means of running your query as a what-if to see what the planner thinks about it. It will show the process the system goes through to get to the data and return it.</p>
<div class="sourceCode" id="cb39"><pre class="sourceCode sql code-with-copy"><code class="sourceCode sql"><span id="cb39-1"><a href="#cb39-1" aria-hidden="true" tabindex="-1"></a><span class="kw">EXPLAIN</span></span>
<span id="cb39-2"><a href="#cb39-2" aria-hidden="true" tabindex="-1"></a><span class="kw">SELECT</span></span>
<span id="cb39-3"><a href="#cb39-3" aria-hidden="true" tabindex="-1"></a>&nbsp; &nbsp; s.<span class="kw">id</span> <span class="kw">AS</span> student_id,</span>
<span id="cb39-4"><a href="#cb39-4" aria-hidden="true" tabindex="-1"></a>&nbsp; &nbsp; g.score</span>
<span id="cb39-5"><a href="#cb39-5" aria-hidden="true" tabindex="-1"></a><span class="kw">FROM</span></span>
<span id="cb39-6"><a href="#cb39-6" aria-hidden="true" tabindex="-1"></a>&nbsp; &nbsp; students <span class="kw">AS</span> s</span>
<span id="cb39-7"><a href="#cb39-7" aria-hidden="true" tabindex="-1"></a><span class="kw">LEFT</span> <span class="kw">JOIN</span></span>
<span id="cb39-8"><a href="#cb39-8" aria-hidden="true" tabindex="-1"></a>&nbsp; &nbsp; grades <span class="kw">AS</span> g</span>
<span id="cb39-9"><a href="#cb39-9" aria-hidden="true" tabindex="-1"></a>&nbsp; &nbsp; <span class="kw">ON</span> s.<span class="kw">id</span> <span class="op">=</span> g.student_id</span>
<span id="cb39-10"><a href="#cb39-10" aria-hidden="true" tabindex="-1"></a><span class="kw">WHERE</span></span>
<span id="cb39-11"><a href="#cb39-11" aria-hidden="true" tabindex="-1"></a>&nbsp; &nbsp; g.score <span class="op">&gt;</span> <span class="dv">90</span></span>
<span id="cb39-12"><a href="#cb39-12" aria-hidden="true" tabindex="-1"></a><span class="kw">ORDER</span> <span class="kw">BY</span></span>
<span id="cb39-13"><a href="#cb39-13" aria-hidden="true" tabindex="-1"></a>&nbsp; &nbsp; g.score <span class="kw">DESC</span>;</span>
<span id="cb39-14"><a href="#cb39-14" aria-hidden="true" tabindex="-1"></a><span class="co">/*</span></span>
<span id="cb39-15"><a href="#cb39-15" aria-hidden="true" tabindex="-1"></a><span class="co">QUERY PLAN</span></span>
<span id="cb39-16"><a href="#cb39-16" aria-hidden="true" tabindex="-1"></a><span class="co">----------</span></span>
<span id="cb39-17"><a href="#cb39-17" aria-hidden="true" tabindex="-1"></a><span class="co">Sort (cost=80.34..81.88 rows=617 width=8)</span></span>
<span id="cb39-18"><a href="#cb39-18" aria-hidden="true" tabindex="-1"></a><span class="co">[...] Sort Key: g.score DESC</span></span>
<span id="cb39-19"><a href="#cb39-19" aria-hidden="true" tabindex="-1"></a><span class="co">[...] -&gt; Hash Join (cost=16.98..51.74 rows=617 width=8)</span></span>
<span id="cb39-20"><a href="#cb39-20" aria-hidden="true" tabindex="-1"></a><span class="co">[...] Hash Cond: (g.student_id = s.id)</span></span>
<span id="cb39-21"><a href="#cb39-21" aria-hidden="true" tabindex="-1"></a><span class="co">[...] -&gt; Seq Scan on grades g (cost=0.00..33.13 rows=617 width=8)</span></span>
<span id="cb39-22"><a href="#cb39-22" aria-hidden="true" tabindex="-1"></a><span class="co">[...] Filter: (score &gt; 90)</span></span>
<span id="cb39-23"><a href="#cb39-23" aria-hidden="true" tabindex="-1"></a><span class="co">[...] -&gt; Hash (cost=13.10..13.10 rows=310 width=4)</span></span>
<span id="cb39-24"><a href="#cb39-24" aria-hidden="true" tabindex="-1"></a><span class="co">[...] -&gt; Seq Scan on students s (cost=0.00..13.20 rows=320 width=4)</span></span>
<span id="cb39-25"><a href="#cb39-25" aria-hidden="true" tabindex="-1"></a><span class="co">*/</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<ul>
<li>Sequentially scanning (“Seq Scan”) the grades and students tables because the tables aren’t indexed
<ul>
<li>Any Seq Scan, parallel or not, is sub-optimal</li>
</ul></li>
<li><code>EXPLAIN (BUFFERS)</code> also shows how may data pages the database had to fetch using slow disk read operations (“read”), and how many of them were cached in memory (“shared hit”)</li>
</ul></li>
<li><p><code>EXPLAIN ANALYZE</code> - tells the planner to not only hypothesize on what it would do, but actually run the query and show the results.</p>
<ul>
<li>shows where indexes are being hit — or not hit as it may be. You can step through and re-optimize your basic and complex queries.</li>
</ul></li>
<li><p><code>GETDATE()</code> - Gets the current date</p></li>
<li><p><code>GO</code> - Not a sql function. Used by some interpreters as a reset.</p>
<ul>
<li>i.e.&nbsp;any variables set before the GO statement will now not be recognized by the interpreter.</li>
<li>Helps to separate code into different sections</li>
</ul></li>
<li><p><code>ISDATE</code> - boolean - checks that a variable is a date type</p></li>
<li><p><code>QUALIFY</code> - clause filters the results of window functions.</p>
<ul>
<li>useful when answering questions like fetching the most XXX value of each category</li>
<li>QUALIFY does with window functions as what HAVING does with GROUP BY. As a result, in the order of execution, QUALIFY is evaluated after window functions.</li>
<li>See Business Queries &gt;&gt; Get the latest order from each customer</li>
</ul></li>
<li><p><code>UNNEST</code> - BigQuery - takes an ARRAY and returns a table with a row for each element in the ARRAY (<a href="https://medium.com/firebase-developers/how-to-use-select-from-unnest-to-analyze-multiple-parameters-in-bigquery-for-analytics-5838f7a004c2">docs</a>)</p>
<ul>
<li><a href="../qmd/google-analytics-analysis.html#sec-goog-goog-anal" style="color: green">Google Analytics, Analysis &gt;&gt; Example 17</a></li>
</ul></li>
</ul>
</section>
<section id="sec-sql-udfs" class="level2 unnumbered">
<h2 class="unnumbered anchored" data-anchor-id="sec-sql-udfs">User Defined Functions (UDF)</h2>
<ul>
<li><p>Misc</p>
<ul>
<li>Available in SQL Server (<a href="https://learn.microsoft.com/en-us/sql/relational-databases/user-defined-functions/user-defined-functions?view=sql-server-ver16">Docs1</a>, <a href="https://learn.microsoft.com/en-us/sql/t-sql/statements/create-function-transact-sql?source=recommendations&amp;view=sql-server-ver16">Docs2</a>), Postgres (<a href="https://www.postgresql.org/docs/current/xfunc-sql.html">Docs</a>), BigQuery (<a href="https://cloud.google.com/bigquery/docs/reference/standard-sql/user-defined-functions">docs</a>), etc.</li>
<li>Keep a dictionary with the UDFs you’ve created and make sure to share it with any collaborators.</li>
<li>Can be persistent or temporary
<ul>
<li>Persistent UDFs can be used across multiple queries, while temporary UDFs only exist in the scope of a single query</li>
</ul></li>
</ul></li>
<li><p>Create</p>
<ul>
<li><p><span class="ribbon-highlight">Example</span>: temporary udf (BQ)</p>
<div class="sourceCode" id="cb40"><pre class="sourceCode sql code-with-copy"><code class="sourceCode sql"><span id="cb40-1"><a href="#cb40-1" aria-hidden="true" tabindex="-1"></a><span class="kw">CREATE</span> TEMP <span class="kw">FUNCTION</span> AddFourAndDivide(x INT64, y INT64)</span>
<span id="cb40-2"><a href="#cb40-2" aria-hidden="true" tabindex="-1"></a>RETURNS FLOAT64</span>
<span id="cb40-3"><a href="#cb40-3" aria-hidden="true" tabindex="-1"></a><span class="kw">AS</span> (</span>
<span id="cb40-4"><a href="#cb40-4" aria-hidden="true" tabindex="-1"></a>&nbsp; (x <span class="op">+</span> <span class="dv">4</span>) <span class="op">/</span> y</span>
<span id="cb40-5"><a href="#cb40-5" aria-hidden="true" tabindex="-1"></a>);</span>
<span id="cb40-6"><a href="#cb40-6" aria-hidden="true" tabindex="-1"></a><span class="kw">SELECT</span></span>
<span id="cb40-7"><a href="#cb40-7" aria-hidden="true" tabindex="-1"></a>&nbsp; val, AddFourAndDivide(val, <span class="dv">2</span>)</span>
<span id="cb40-8"><a href="#cb40-8" aria-hidden="true" tabindex="-1"></a><span class="kw">FROM</span></span>
<span id="cb40-9"><a href="#cb40-9" aria-hidden="true" tabindex="-1"></a>&nbsp; UNNEST([<span class="dv">2</span>,<span class="dv">3</span>,<span class="dv">5</span>,<span class="dv">8</span>]) <span class="kw">AS</span> val;</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div></li>
<li><p><span class="ribbon-highlight">Example</span>: persistent udf (BQ)</p>
<div class="sourceCode" id="cb41"><pre class="sourceCode sql code-with-copy"><code class="sourceCode sql"><span id="cb41-1"><a href="#cb41-1" aria-hidden="true" tabindex="-1"></a><span class="kw">CREATE</span> <span class="kw">FUNCTION</span> mydataset.AddFourAndDivide(x INT64, y INT64)</span>
<span id="cb41-2"><a href="#cb41-2" aria-hidden="true" tabindex="-1"></a>RETURNS FLOAT64</span>
<span id="cb41-3"><a href="#cb41-3" aria-hidden="true" tabindex="-1"></a><span class="kw">AS</span> (</span>
<span id="cb41-4"><a href="#cb41-4" aria-hidden="true" tabindex="-1"></a>&nbsp; (x <span class="op">+</span> <span class="dv">4</span>) <span class="op">/</span> y</span>
<span id="cb41-5"><a href="#cb41-5" aria-hidden="true" tabindex="-1"></a>);</span>
<span id="cb41-6"><a href="#cb41-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-7"><a href="#cb41-7" aria-hidden="true" tabindex="-1"></a><span class="kw">SELECT</span></span>
<span id="cb41-8"><a href="#cb41-8" aria-hidden="true" tabindex="-1"></a>&nbsp; val, mydataset.AddFourAndDivide(val, <span class="dv">2</span>)</span>
<span id="cb41-9"><a href="#cb41-9" aria-hidden="true" tabindex="-1"></a><span class="kw">FROM</span></span>
<span id="cb41-10"><a href="#cb41-10" aria-hidden="true" tabindex="-1"></a>&nbsp; UNNEST([<span class="dv">2</span>,<span class="dv">3</span>,<span class="dv">5</span>,<span class="dv">8</span>,<span class="dv">12</span>]) <span class="kw">AS</span> val;</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div></li>
</ul></li>
<li><p>Delete persistent udf: <code>DROP FUNCTION &lt;udf_name&gt;</code></p></li>
<li><p>With Scalar subquery (BQ)</p>
<div class="sourceCode" id="cb42"><pre class="sourceCode sql code-with-copy"><code class="sourceCode sql"><span id="cb42-1"><a href="#cb42-1" aria-hidden="true" tabindex="-1"></a><span class="kw">CREATE</span> TEMP <span class="kw">FUNCTION</span> countUserByAge(userAge INT64)</span>
<span id="cb42-2"><a href="#cb42-2" aria-hidden="true" tabindex="-1"></a><span class="kw">AS</span> (</span>
<span id="cb42-3"><a href="#cb42-3" aria-hidden="true" tabindex="-1"></a>&nbsp; (<span class="kw">SELECT</span> <span class="fu">COUNT</span>(<span class="dv">1</span>) <span class="kw">FROM</span> users <span class="kw">WHERE</span> age <span class="op">=</span> userAge)</span>
<span id="cb42-4"><a href="#cb42-4" aria-hidden="true" tabindex="-1"></a>);</span>
<span id="cb42-5"><a href="#cb42-5" aria-hidden="true" tabindex="-1"></a><span class="kw">SELECT</span></span>
<span id="cb42-6"><a href="#cb42-6" aria-hidden="true" tabindex="-1"></a>&nbsp; countUserByAge(<span class="dv">10</span>) <span class="kw">AS</span> count_user_age_10,</span>
<span id="cb42-7"><a href="#cb42-7" aria-hidden="true" tabindex="-1"></a>&nbsp; countUserByAge(<span class="dv">20</span>) <span class="kw">AS</span> count_user_age_20,</span>
<span id="cb42-8"><a href="#cb42-8" aria-hidden="true" tabindex="-1"></a>&nbsp; countUserByAge(<span class="dv">30</span>) <span class="kw">AS</span> count_user_age_30;</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div></li>
</ul>
</section>
<section id="sec-sql-loops" class="level2 unnumbered">
<h2 class="unnumbered anchored" data-anchor-id="sec-sql-loops">Loops</h2>
<ul>
<li>Misc
<ul>
<li>posgres <a href="https://www.postgresql.org/docs/15/plpgsql-control-structures.html#PLPGSQL-CONTROL-STRUCTURES-LOOPS">docs</a> for loops</li>
</ul></li>
<li>WHILE
<ul>
<li><p><span class="ribbon-highlight">Example</span>: Incrementally add to a counter variable</p>
<div class="sourceCode" id="cb43"><pre class="sourceCode sql code-with-copy"><code class="sourceCode sql"><span id="cb43-1"><a href="#cb43-1" aria-hidden="true" tabindex="-1"></a><span class="co">-- Declare the initial value</span></span>
<span id="cb43-2"><a href="#cb43-2" aria-hidden="true" tabindex="-1"></a><span class="kw">DECLARE</span> @counter <span class="dt">INT</span>;</span>
<span id="cb43-3"><a href="#cb43-3" aria-hidden="true" tabindex="-1"></a><span class="kw">SET</span> @counter <span class="op">=</span> <span class="dv">20</span>;</span>
<span id="cb43-4"><a href="#cb43-4" aria-hidden="true" tabindex="-1"></a><span class="co">-- Print initial value</span></span>
<span id="cb43-5"><a href="#cb43-5" aria-hidden="true" tabindex="-1"></a><span class="kw">SELECT</span> @counter <span class="kw">AS</span> _COUNT;</span>
<span id="cb43-6"><a href="#cb43-6" aria-hidden="true" tabindex="-1"></a><span class="co">-- Create a loop</span></span>
<span id="cb43-7"><a href="#cb43-7" aria-hidden="true" tabindex="-1"></a><span class="cf">BEGIN</span>;</span>
<span id="cb43-8"><a href="#cb43-8" aria-hidden="true" tabindex="-1"></a><span class="co">-- Loop code starting point</span></span>
<span id="cb43-9"><a href="#cb43-9" aria-hidden="true" tabindex="-1"></a><span class="cf">WHILE</span> @counter <span class="op">&lt;</span> <span class="dv">30</span></span>
<span id="cb43-10"><a href="#cb43-10" aria-hidden="true" tabindex="-1"></a><span class="kw">SELECT</span> @counter <span class="op">=</span> @counter <span class="op">+</span> <span class="dv">1</span>;</span>
<span id="cb43-11"><a href="#cb43-11" aria-hidden="true" tabindex="-1"></a><span class="co">-- Loop finish</span></span>
<span id="cb43-12"><a href="#cb43-12" aria-hidden="true" tabindex="-1"></a><span class="cf">END</span>;</span>
<span id="cb43-13"><a href="#cb43-13" aria-hidden="true" tabindex="-1"></a><span class="co">-- Check the value of the variable</span></span>
<span id="cb43-14"><a href="#cb43-14" aria-hidden="true" tabindex="-1"></a><span class="kw">SELECT</span> @counter <span class="kw">AS</span> _COUNT;</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div></li>
</ul></li>
<li>Cursors (<a href="https://www.postgresql.org/docs/current/plpgsql-cursors.html">Docs</a>)
<ul>
<li><p>Rather than executing a whole query at once, it is possible to set up a cursor that encapsulates the query, and then read the query result a few rows at a time.</p>
<ul>
<li>One reason for doing this is to avoid memory overrun when the result contains a large number of rows. (However, PL/pgSQL users do not normally need to worry about that, since FOR loops automatically use a cursor internally to avoid memory problems.)</li>
<li>A more interesting usage is to return a reference to a cursor that a function has created, allowing the caller to read the rows. This provides an efficient way to return large row sets from functions.</li>
</ul></li>
<li><p><span class="ribbon-highlight">Example</span> (<a href="https://towardsdatascience.com/5-advanced-sql-techniques-for-real-life-projects-f2db9b6680e2">article</a> (do not pay attention dynamic sql. it’s for embedding sql in C programs))</p>
<div class="sourceCode" id="cb44"><pre class="sourceCode sql code-with-copy"><code class="sourceCode sql"><span id="cb44-1"><a href="#cb44-1" aria-hidden="true" tabindex="-1"></a><span class="kw">DECLARE</span></span>
<span id="cb44-2"><a href="#cb44-2" aria-hidden="true" tabindex="-1"></a>&nbsp; &nbsp; cur_orders <span class="kw">CURSOR</span> FOR&nbsp;</span>
<span id="cb44-3"><a href="#cb44-3" aria-hidden="true" tabindex="-1"></a>&nbsp; &nbsp; &nbsp; &nbsp; <span class="kw">SELECT</span> order_id, product_id, quantity</span>
<span id="cb44-4"><a href="#cb44-4" aria-hidden="true" tabindex="-1"></a>&nbsp; &nbsp; &nbsp; &nbsp; <span class="kw">FROM</span> order_details</span>
<span id="cb44-5"><a href="#cb44-5" aria-hidden="true" tabindex="-1"></a>&nbsp; &nbsp; &nbsp; &nbsp; <span class="kw">WHERE</span> product_id <span class="op">=</span> <span class="dv">456</span>;</span>
<span id="cb44-6"><a href="#cb44-6" aria-hidden="true" tabindex="-1"></a>&nbsp; &nbsp; product_inventory <span class="dt">INTEGER</span>;</span>
<span id="cb44-7"><a href="#cb44-7" aria-hidden="true" tabindex="-1"></a><span class="cf">BEGIN</span></span>
<span id="cb44-8"><a href="#cb44-8" aria-hidden="true" tabindex="-1"></a>&nbsp; &nbsp; <span class="kw">OPEN</span> cur_orders;</span>
<span id="cb44-9"><a href="#cb44-9" aria-hidden="true" tabindex="-1"></a>&nbsp; &nbsp; <span class="cf">LOOP</span></span>
<span id="cb44-10"><a href="#cb44-10" aria-hidden="true" tabindex="-1"></a>&nbsp; &nbsp; &nbsp; &nbsp; FETCH cur_orders <span class="kw">INTO</span> order_id, product_id, quantity;</span>
<span id="cb44-11"><a href="#cb44-11" aria-hidden="true" tabindex="-1"></a>&nbsp; &nbsp; &nbsp; &nbsp; EXIT <span class="cf">WHEN</span> <span class="kw">NOT</span> FOUND;</span>
<span id="cb44-12"><a href="#cb44-12" aria-hidden="true" tabindex="-1"></a>&nbsp; &nbsp; &nbsp; &nbsp; <span class="kw">SELECT</span> inventory <span class="kw">INTO</span> product_inventory <span class="kw">FROM</span> products <span class="kw">WHERE</span> product_id <span class="op">=</span> <span class="dv">456</span>;</span>
<span id="cb44-13"><a href="#cb44-13" aria-hidden="true" tabindex="-1"></a>&nbsp; &nbsp; &nbsp; &nbsp; product_inventory <span class="op">:=</span> product_inventory <span class="op">-</span> quantity;</span>
<span id="cb44-14"><a href="#cb44-14" aria-hidden="true" tabindex="-1"></a>&nbsp; &nbsp; &nbsp; &nbsp; <span class="kw">UPDATE</span> products <span class="kw">SET</span> inventory <span class="op">=</span> product_inventory <span class="kw">WHERE</span> product_id <span class="op">=</span> <span class="dv">456</span>;</span>
<span id="cb44-15"><a href="#cb44-15" aria-hidden="true" tabindex="-1"></a>&nbsp; &nbsp; <span class="cf">END</span> <span class="cf">LOOP</span>;</span>
<span id="cb44-16"><a href="#cb44-16" aria-hidden="true" tabindex="-1"></a>&nbsp; &nbsp; <span class="kw">CLOSE</span> cur_orders;</span>
<span id="cb44-17"><a href="#cb44-17" aria-hidden="true" tabindex="-1"></a>&nbsp; &nbsp; <span class="co">-- do something after updating the inventory, such as logging the changes</span></span>
<span id="cb44-18"><a href="#cb44-18" aria-hidden="true" tabindex="-1"></a><span class="cf">END</span>;</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<ul>
<li>A table called “products” that contains information about all products, including the product ID, product name, and current inventory. You can use a cursor to iterate through all orders that contain a specific product and update its inventory.</li>
<li>A cursor called “cur_orders” that selects all order details that contain a specific product ID. We then define a variable called “product_inventory” to store the current inventory of the product.</li>
<li>Inside the loop, we fetch each order ID, product ID, and quantity from the cursor, subtract the quantity from the current inventory and update the products table with the new inventory value.</li>
<li>Finally, we close the cursor and do something after updating the inventory, such as logging the changes.</li>
</ul></li>
</ul></li>
</ul>
</section>
<section id="sec-sql-winfun" class="level2 unnumbered">
<h2 class="unnumbered anchored" data-anchor-id="sec-sql-winfun">Window Functions</h2>
<ul>
<li><p>Unlike GROUP BY, keeps original columns after an aggregation<br>
<img src="./_resources/SQL.resources/1-KHkgYYK0Up46b8BunVMYoQ.png" class="img-fluid"></p>
<ul>
<li>Allows you to work with both aggregate and non-aggregate values all at once
<ul>
<li>Better performance than using GROUP BY + JOIN to get the same result</li>
</ul></li>
</ul></li>
<li><p>Despite the order of operations, if you really need to have a window function inside a WHERE clause or GROUP BY clause, you may get around this limitation by using a subquery or a WITH query</p>
<ul>
<li><p><span class="ribbon-highlight">Example</span>: Remove duplicate rows</p>
<div class="sourceCode" id="cb45"><pre class="sourceCode sql code-with-copy"><code class="sourceCode sql"><span id="cb45-1"><a href="#cb45-1" aria-hidden="true" tabindex="-1"></a><span class="kw">WITH</span> temporary_employees <span class="kw">as</span></span>
<span id="cb45-2"><a href="#cb45-2" aria-hidden="true" tabindex="-1"></a>(SELECT&nbsp;</span>
<span id="cb45-3"><a href="#cb45-3" aria-hidden="true" tabindex="-1"></a>&nbsp; employee_id,</span>
<span id="cb45-4"><a href="#cb45-4" aria-hidden="true" tabindex="-1"></a>&nbsp; employee_name,</span>
<span id="cb45-5"><a href="#cb45-5" aria-hidden="true" tabindex="-1"></a>&nbsp; department,</span>
<span id="cb45-6"><a href="#cb45-6" aria-hidden="true" tabindex="-1"></a>&nbsp; <span class="fu">ROW_NUMBER</span>() <span class="kw">OVER</span>(<span class="kw">PARTITION</span> <span class="kw">BY</span> employee_name,</span>
<span id="cb45-7"><a href="#cb45-7" aria-hidden="true" tabindex="-1"></a>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; department,</span>
<span id="cb45-8"><a href="#cb45-8" aria-hidden="true" tabindex="-1"></a>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; employee_id) <span class="kw">as</span> row_count</span>
<span id="cb45-9"><a href="#cb45-9" aria-hidden="true" tabindex="-1"></a><span class="kw">FROM</span> Dummy_employees)</span>
<span id="cb45-10"><a href="#cb45-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-11"><a href="#cb45-11" aria-hidden="true" tabindex="-1"></a><span class="kw">SELECT</span> <span class="op">*</span></span>
<span id="cb45-12"><a href="#cb45-12" aria-hidden="true" tabindex="-1"></a><span class="kw">FROM</span> temporary_employees</span>
<span id="cb45-13"><a href="#cb45-13" aria-hidden="true" tabindex="-1"></a><span class="kw">WHERE</span> row_count <span class="op">=</span> <span class="dv">1</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div></li>
</ul></li>
<li><p>3 Types of Window Functions<br>
<img src="./_resources/SQL.resources/1-u8SPxze2b1OdCdPo1maVGw.png" class="img-fluid"></p>
<ul>
<li>LEAD() will give you the row AFTER the row you are finding a value for.</li>
<li>LAG() will give you the row BEFORE the row you are finding a value for.</li>
<li>FIRST_VALUE() returns the first value in an ordered, partitioned data output.</li>
</ul></li>
<li><p>General Syntax<br>
<img src="./_resources/SQL.resources/1-NKUDO4a5fu5kVW-OlkHUJw.png" class="img-fluid"></p>
<ul>
<li>window_function is the name of the window function we want to use (e.g.&nbsp;see above)
<ul>
<li>expression is the name of the column that we want the window function operated on.
<ul>
<li>May not be necessary depending on what window_function is used</li>
</ul></li>
<li>OVER is just to signify that this is a window function</li>
</ul></li>
<li>PARTITION BY divides the rows into partitions so we can specify which rows to use to compute the window function
<ul>
<li>partition_list is the name of the column(s) we want to partition by (i.e.&nbsp;group_by)</li>
</ul></li>
<li>ORDER BY is used so that we can order the rows within each partition. This is optional and does not have to be specified
<ul>
<li>order_list is the name of the column(s) we want to order by</li>
</ul></li>
<li>ROWS (optional; typically not used) used to subset the rows <em>within each partition</em>.
<ul>
<li>frame_clause defines how much to offset from our current row</li>
<li>Syntax: ROWS BETWEEN &lt;starting_row&gt; AND &lt;ending_row&gt;
<ul>
<li>Options for starting and ending row
<ul>
<li>UNBOUNDED PRECEDING — all rows before the current row in the partition, i.e.&nbsp;the first row of the partition</li>
<li>[some #] PRECEDING — # of rows before the current row</li>
<li>CURRENT ROW — the current row</li>
<li>[some #] FOLLOWING — # of rows after the current row</li>
<li>UNBOUNDED FOLLOWING — all rows after the current row in the partition, i.e.&nbsp;the last row of the partition</li>
</ul></li>
<li>Examples
<ul>
<li>ROWS BETWEEN 3 PRECEDING AND CURRENT ROW — this means look back the previous 3 rows up to the current row.</li>
<li>ROWS BETWEEN UNBOUNDED PRECEDING AND 1 FOLLOWING — this means look from the first row of the partition to 1 row after the current row</li>
<li>ROWS BETWEEN 5 PRECEDING AND 1 PRECEDING — this means look back the previous 5 rows up to 1 row before the current row</li>
<li>ROWS BETWEEN UNBOUNDED PRECEDING AND UNBOUNDED FOLLOWING — this means look from the first row of the partition to the last row of the partition</li>
</ul></li>
</ul></li>
</ul></li>
</ul></li>
<li><p><span class="ribbon-highlight">Example</span>: Average Salary by Job Title<br>
<img src="./_resources/SQL.resources/1-GVX7Ws5Dk_f9-a6o9Wy_kQ.png" class="img-fluid"><br>
<img src="./_resources/SQL.resources/1-KHkgYYK0Up46b8BunVMYoQ.1.png" class="img-fluid"></p></li>
<li><p><strong>Tables for Examples</strong><br>
<img src="./_resources/SQL.resources/1-vz3DggeLfupObUnYlCa11A.png" class="img-fluid"></p></li>
<li><p><span class="ribbon-highlight">Example</span>: Average Unit Price for each CustomerId<br>
<img src="./_resources/SQL.resources/1-c9eFD04nSDvxmzg2zza8oA.png" class="img-fluid"></p>
<div class="sourceCode" id="cb46"><pre class="sourceCode sql code-with-copy"><code class="sourceCode sql"><span id="cb46-1"><a href="#cb46-1" aria-hidden="true" tabindex="-1"></a><span class="kw">SELECT</span> CustomerId,&nbsp;</span>
<span id="cb46-2"><a href="#cb46-2" aria-hidden="true" tabindex="-1"></a>&nbsp; &nbsp; &nbsp; UnitPrice,&nbsp;</span>
<span id="cb46-3"><a href="#cb46-3" aria-hidden="true" tabindex="-1"></a>&nbsp; &nbsp; &nbsp; <span class="fu">AVG</span>(UnitPrice) <span class="kw">OVER</span> (<span class="kw">PARTITION</span> <span class="kw">BY</span> CustomerId) <span class="kw">AS</span> “AvgUnitPrice”</span>
<span id="cb46-4"><a href="#cb46-4" aria-hidden="true" tabindex="-1"></a><span class="kw">FROM</span> [<span class="kw">Order</span>]&nbsp;</span>
<span id="cb46-5"><a href="#cb46-5" aria-hidden="true" tabindex="-1"></a><span class="kw">INNER</span> <span class="kw">JOIN</span> OrderDetail <span class="kw">ON</span> [<span class="kw">Order</span>].<span class="kw">Id</span> <span class="op">=</span> OrderDetail.OrderId</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div></li>
<li><p><span class="ribbon-highlight">Example</span>: Average Unit Price for each group of CustomerId AND EmployeeId<br>
<img src="./_resources/SQL.resources/1-NEoVEmqBzFSlX3NHNK9dUg.png" class="img-fluid"></p>
<div class="sourceCode" id="cb47"><pre class="sourceCode sql code-with-copy"><code class="sourceCode sql"><span id="cb47-1"><a href="#cb47-1" aria-hidden="true" tabindex="-1"></a><span class="kw">SELECT</span> CustomerId,&nbsp;</span>
<span id="cb47-2"><a href="#cb47-2" aria-hidden="true" tabindex="-1"></a>&nbsp; &nbsp; &nbsp; EmployeeId,&nbsp;</span>
<span id="cb47-3"><a href="#cb47-3" aria-hidden="true" tabindex="-1"></a>&nbsp; &nbsp; &nbsp; <span class="fu">AVG</span>(UnitPrice) <span class="kw">OVER</span> (<span class="kw">PARTITION</span> <span class="kw">BY</span> CustomerId, EmployeeId) <span class="kw">AS</span> “AvgUnitPrice”</span>
<span id="cb47-4"><a href="#cb47-4" aria-hidden="true" tabindex="-1"></a><span class="kw">FROM</span> [<span class="kw">Order</span>]&nbsp;</span>
<span id="cb47-5"><a href="#cb47-5" aria-hidden="true" tabindex="-1"></a><span class="kw">INNER</span> <span class="kw">JOIN</span> OrderDetail <span class="kw">ON</span> [<span class="kw">Order</span>].<span class="kw">Id</span> <span class="op">=</span> OrderDetail.OrderId</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div></li>
<li><p><span class="ribbon-highlight">Example</span>: Create a new column that ranks Unit Price in descending order for each CustomerId<br>
<img src="./_resources/SQL.resources/1-s7wtLz5LVZleovQtIFgQJg.png" class="img-fluid"></p>
<div class="sourceCode" id="cb48"><pre class="sourceCode sql code-with-copy"><code class="sourceCode sql"><span id="cb48-1"><a href="#cb48-1" aria-hidden="true" tabindex="-1"></a><span class="kw">SELECT</span> CustomerId,&nbsp;</span>
<span id="cb48-2"><a href="#cb48-2" aria-hidden="true" tabindex="-1"></a>&nbsp; &nbsp; &nbsp; OrderDate,&nbsp;</span>
<span id="cb48-3"><a href="#cb48-3" aria-hidden="true" tabindex="-1"></a>&nbsp; &nbsp; &nbsp; UnitPrice,&nbsp;</span>
<span id="cb48-4"><a href="#cb48-4" aria-hidden="true" tabindex="-1"></a>&nbsp; &nbsp; &nbsp; <span class="fu">ROW_NUMBER</span>() <span class="kw">OVER</span> (<span class="kw">PARTITION</span> <span class="kw">BY</span> CustomerId <span class="kw">ORDER</span> <span class="kw">BY</span> UnitPrice <span class="kw">DESC</span>) <span class="kw">AS</span> “UnitRank”</span>
<span id="cb48-5"><a href="#cb48-5" aria-hidden="true" tabindex="-1"></a><span class="kw">FROM</span> [<span class="kw">Order</span>]&nbsp;</span>
<span id="cb48-6"><a href="#cb48-6" aria-hidden="true" tabindex="-1"></a><span class="kw">INNER</span> <span class="kw">JOIN</span> OrderDetail&nbsp;</span>
<span id="cb48-7"><a href="#cb48-7" aria-hidden="true" tabindex="-1"></a><span class="kw">ON</span> [<span class="kw">Order</span>].<span class="kw">Id</span> <span class="op">=</span> OrderDetail.OrderId</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<ul>
<li>Substituting RANK in place of ROW_NUMBER should produce the same results</li>
<li>Note that ranks are skipped (e.g.&nbsp;rank 3 for ALFKI) when there are rows with the same rank
<ul>
<li>If you don’t want ranks skipped, use DENSE_RANK for the window function</li>
</ul></li>
</ul></li>
<li><p><span class="ribbon-highlight">Example</span>: Create a new column that provides the previous order date’s Quantity for each ProductId<br>
<img src="./_resources/SQL.resources/1-U5Pb6kyZYtMvbhHw13o3YA.png" class="img-fluid"></p>
<div class="sourceCode" id="cb49"><pre class="sourceCode sql code-with-copy"><code class="sourceCode sql"><span id="cb49-1"><a href="#cb49-1" aria-hidden="true" tabindex="-1"></a><span class="kw">SELECT</span> ProductId,&nbsp;</span>
<span id="cb49-2"><a href="#cb49-2" aria-hidden="true" tabindex="-1"></a>&nbsp; &nbsp; &nbsp; OrderDate,&nbsp;</span>
<span id="cb49-3"><a href="#cb49-3" aria-hidden="true" tabindex="-1"></a>&nbsp; &nbsp; &nbsp; Quantity,&nbsp;</span>
<span id="cb49-4"><a href="#cb49-4" aria-hidden="true" tabindex="-1"></a>&nbsp; &nbsp; &nbsp; <span class="fu">LAG</span>(Quantity) <span class="kw">OVER</span> (<span class="kw">PARTITION</span> <span class="kw">BY</span> ProductId <span class="kw">ORDER</span> <span class="kw">BY</span> OrderDate) <span class="kw">AS</span> <span class="ot">"LAG"</span></span>
<span id="cb49-5"><a href="#cb49-5" aria-hidden="true" tabindex="-1"></a><span class="kw">FROM</span> [<span class="kw">Order</span>]&nbsp;</span>
<span id="cb49-6"><a href="#cb49-6" aria-hidden="true" tabindex="-1"></a><span class="kw">INNER</span> <span class="kw">JOIN</span> OrderDetail <span class="kw">ON</span> [<span class="kw">Order</span>].<span class="kw">Id</span> <span class="op">=</span> OrderDetail.OrderId</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<ul>
<li>Use LEAD for the <em>following</em> quantity</li>
</ul></li>
<li><p><span class="ribbon-highlight">Example</span>: Create a new column that provides the very first Quantity ever ordered for each ProductId<br>
<img src="./_resources/SQL.resources/1-crsYDwLQoWTRX1Ilrkwusw.png" class="img-fluid"></p>
<div class="sourceCode" id="cb50"><pre class="sourceCode sql code-with-copy"><code class="sourceCode sql"><span id="cb50-1"><a href="#cb50-1" aria-hidden="true" tabindex="-1"></a><span class="kw">SELECT</span> ProductId,&nbsp;</span>
<span id="cb50-2"><a href="#cb50-2" aria-hidden="true" tabindex="-1"></a>&nbsp; &nbsp; &nbsp; OrderDate,&nbsp;</span>
<span id="cb50-3"><a href="#cb50-3" aria-hidden="true" tabindex="-1"></a>&nbsp; &nbsp; &nbsp; Quantity,&nbsp;</span>
<span id="cb50-4"><a href="#cb50-4" aria-hidden="true" tabindex="-1"></a>&nbsp; &nbsp; &nbsp; <span class="fu">FIRST_VALUE</span>(Quantity) <span class="kw">OVER</span> (<span class="kw">PARTITION</span> <span class="kw">BY</span> ProductId <span class="kw">ORDER</span> <span class="kw">BY</span> OrderDate) <span class="kw">AS</span> <span class="ot">"FirstValue"</span></span>
<span id="cb50-5"><a href="#cb50-5" aria-hidden="true" tabindex="-1"></a><span class="kw">FROM</span> [<span class="kw">Order</span>]&nbsp;</span>
<span id="cb50-6"><a href="#cb50-6" aria-hidden="true" tabindex="-1"></a><span class="kw">INNER</span> <span class="kw">JOIN</span> OrderDetail <span class="kw">ON</span> [<span class="kw">Order</span>].<span class="kw">Id</span> <span class="op">=</span> OrderDetail.OrderId</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div></li>
<li><p><span class="ribbon-highlight">Example</span>: Calculate a cumulative moving average UnitPrice for each CustomerId<br>
<img src="./_resources/SQL.resources/1-FK8pEUSQhqKZv4FGNekZFA.png" class="img-fluid"></p>
<div class="sourceCode" id="cb51"><pre class="sourceCode sql code-with-copy"><code class="sourceCode sql"><span id="cb51-1"><a href="#cb51-1" aria-hidden="true" tabindex="-1"></a><span class="kw">SELECT</span> CustomerId,&nbsp;</span>
<span id="cb51-2"><a href="#cb51-2" aria-hidden="true" tabindex="-1"></a>&nbsp; &nbsp; &nbsp; UnitPrice,&nbsp;</span>
<span id="cb51-3"><a href="#cb51-3" aria-hidden="true" tabindex="-1"></a>&nbsp; &nbsp; &nbsp; <span class="fu">AVG</span>(UnitPrice) <span class="kw">OVER</span> (<span class="kw">PARTITION</span> <span class="kw">BY</span> CustomerId&nbsp;</span>
<span id="cb51-4"><a href="#cb51-4" aria-hidden="true" tabindex="-1"></a>&nbsp; &nbsp; &nbsp; <span class="kw">ORDER</span> <span class="kw">BY</span> CustomerId&nbsp;</span>
<span id="cb51-5"><a href="#cb51-5" aria-hidden="true" tabindex="-1"></a>&nbsp; &nbsp; &nbsp; <span class="kw">ROWS</span> <span class="kw">BETWEEN</span> <span class="kw">UNBOUNDED</span> <span class="kw">PRECEDING</span> <span class="kw">AND</span> <span class="kw">CURRENT</span> <span class="kw">ROW</span>) <span class="kw">AS</span> “CumAvg”</span>
<span id="cb51-6"><a href="#cb51-6" aria-hidden="true" tabindex="-1"></a><span class="kw">FROM</span> [<span class="kw">Order</span>]</span>
<span id="cb51-7"><a href="#cb51-7" aria-hidden="true" tabindex="-1"></a><span class="kw">INNER</span> <span class="kw">JOIN</span> OrderDetail <span class="kw">ON</span> [<span class="kw">Order</span>].<span class="kw">Id</span> <span class="op">=</span> OrderDetail.OrderId</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div></li>
<li><p><span class="ribbon-highlight">Example</span>: Rank customers for each department by amount spent</p>
<div class="sourceCode" id="cb52"><pre class="sourceCode sql code-with-copy"><code class="sourceCode sql"><span id="cb52-1"><a href="#cb52-1" aria-hidden="true" tabindex="-1"></a><span class="kw">SELECT</span></span>
<span id="cb52-2"><a href="#cb52-2" aria-hidden="true" tabindex="-1"></a>&nbsp; &nbsp; customer_name,</span>
<span id="cb52-3"><a href="#cb52-3" aria-hidden="true" tabindex="-1"></a>&nbsp; &nbsp; customer_id,</span>
<span id="cb52-4"><a href="#cb52-4" aria-hidden="true" tabindex="-1"></a>&nbsp; &nbsp; amount_spent,</span>
<span id="cb52-5"><a href="#cb52-5" aria-hidden="true" tabindex="-1"></a>&nbsp; &nbsp; department_id,</span>
<span id="cb52-6"><a href="#cb52-6" aria-hidden="true" tabindex="-1"></a>&nbsp; &nbsp; <span class="fu">RANK</span>(amount_spent) <span class="kw">OVER</span>(<span class="kw">ORDER</span> <span class="kw">BY</span> amount_spent <span class="kw">DESC</span> <span class="kw">PARTITION</span> <span class="kw">BY</span> department_id) <span class="kw">AS</span> spend_rank</span>
<span id="cb52-7"><a href="#cb52-7" aria-hidden="true" tabindex="-1"></a><span class="kw">FROM</span> employees</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div></li>
<li><p><span class="ribbon-highlight">Example</span>: Find the model and year of car that been on lot the longest</p>
<div class="sourceCode" id="cb53"><pre class="sourceCode sql code-with-copy"><code class="sourceCode sql"><span id="cb53-1"><a href="#cb53-1" aria-hidden="true" tabindex="-1"></a>SELECT&nbsp;</span>
<span id="cb53-2"><a href="#cb53-2" aria-hidden="true" tabindex="-1"></a><span class="fu">FIRST_VALUE</span>(name) <span class="kw">OVER</span>(<span class="kw">PARTITION</span> <span class="kw">BY</span> model, <span class="dt">year</span> <span class="kw">ORDER</span> <span class="kw">BY</span> date_at_lot <span class="kw">ASC</span>) <span class="kw">AS</span> oldest_car_name</span>
<span id="cb53-3"><a href="#cb53-3" aria-hidden="true" tabindex="-1"></a>model,</span>
<span id="cb53-4"><a href="#cb53-4" aria-hidden="true" tabindex="-1"></a><span class="dt">year</span></span>
<span id="cb53-5"><a href="#cb53-5" aria-hidden="true" tabindex="-1"></a><span class="kw">FROM</span> cars</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div></li>
<li><p><u>Running Totals/Averages (Cumulative Sums)</u></p>
<ul>
<li>Uses <code>SUM</code> as the window function
<ul>
<li>Just replace SUM with AVG to get running averages</li>
</ul></li>
<li><span class="ribbon-highlight">Example</span><br>
<img src="./_resources/SQL.resources/1-vZiZM7MBwfeHhi8GP3QrtQ.png" class="img-fluid">
<ul>
<li>Generate a new dataset grouped by month, instead of timestamp. (CTE)
<ul>
<li>Only include three fields: account_id, occurred_month and total_amount_usd</li>
<li>Only computed for the following accounts: 1041 , 1051, 1061, 10141.</li>
</ul></li>
<li>Compute a running total ordered by occurred_month, without collapsing the rows in the result set.
<ul>
<li>Display 2 columns: occurred_month and cum_amnt_usd_by_month<br>
<img src="./_resources/SQL.resources/1-KcELs2mkbYN3XKk0Gzk-jg.png" class="img-fluid"><img src="./_resources/SQL.resources/1-2u7h_5kxKinnn15C7VGmiw.png" class="img-fluid"></li>
</ul></li>
<li>Because no partition was specified, the running total is applied on the full dataset and ordered by (ascending) occurred_month</li>
</ul></li>
<li><span class="ribbon-highlight">Example</span> running total by grouping variable
<ul>
<li>Using previous CTE
<ul>
<li>Compute a running total by account_id, ordered by occurred_month, and account_id (i.e.&nbsp;a separate running total for each account_id.)
<ul>
<li>Display 3 columns: account_id, occurred_month, and cum_mon_amnt_usd_by_account<br>
<img src="./_resources/SQL.resources/1-Axkp3Gp-fk5iWysxLJXklg.png" class="img-fluid"><img src="./_resources/SQL.resources/1-0jfZNXzNQ0jVT_bIW_KpCw.png" class="img-fluid"></li>
</ul></li>
</ul></li>
<li>Same as previous example except a partition column (account_id) is added</li>
</ul></li>
<li><span class="ribbon-highlight">Example</span> Running total over various window lengths
<ul>
<li>Using previous CTE
<ul>
<li>Compute a 3 months rolling running total using a window that includes the current month.</li>
<li>Compute a 7 months rolling running total using a window where the current month is always the middle month.<br>
<img src="./_resources/SQL.resources/1-lbxUJId6dY1fJHz44A1RKQ.png" class="img-fluid"><img src="./_resources/SQL.resources/1-UXXt7TGvkdFFqm-opBx1mg.png" class="img-fluid"></li>
</ul></li>
<li>First case uses 2 PRECEDING rows and the CURRENT_ROW</li>
<li>Second case uses 3 PRECEDING rows and 3 FOLLOWING rows and the CURRENT_ROW</li>
</ul></li>
</ul></li>
</ul>
</section>
<section id="sec-sql-ctes" class="level2 unnumbered">
<h2 class="unnumbered anchored" data-anchor-id="sec-sql-ctes">Common Table Expressions (CTE)</h2>
<ul>
<li>The result set of a query which exists temporarily and for use only within the context of a larger query. Much like a derived table, the result of a CTE is not stored and exists only for the duration of the query.</li>
<li>Also see
<ul>
<li>Window Functions &gt;&gt; Running Totals &gt;&gt; Examples</li>
<li><a href="(google-analytics-analysis.qmd#sec-goog-goog-anal)">Google, Google Analytics, Analysis</a> &gt;&gt; Examples 12-15, 18, 19</li>
</ul></li>
<li>Use Cases
<ul>
<li>Needing to reference a derived table multiple times in a single query</li>
<li>An alternative to creating a view in the database</li>
<li>Performing the same calculation multiple times over across multiple query components</li>
</ul></li>
<li>Improves readability and <em>usually</em> no performance difference
<ul>
<li>Prior to PostgreSQL 12, https://hakibenita.com/be-careful-with-cte-in-postgre-sql , something with the caching mechanism created a bottleneck. Currently, version 13 is the latest, so hopefully not a common problem anymore.</li>
</ul></li>
<li>Steps
<ul>
<li>Initiate a CTE using “WITH”</li>
<li>Provide a name for the result soon-to-be defined query</li>
<li>After assigning a name, follow with “AS”</li>
<li>Specify column names (optional step)</li>
<li>Define the query to produce the desired result set</li>
<li>If multiple CTEs are required, initiate each subsequent expression with a comma and repeat steps 2-4.</li>
<li>Reference the above-defined CTE(s) in a subsequent query</li>
</ul></li>
<li>Syntax</li>
</ul>
<pre><code>WITH
expression_name_1 AS
(CTE query definition 1)
[, expression_name_X AS
&nbsp; (CTE query definition X)
, etc ]
SELECT expression_A, expression_B, ...
FROM expression_name_1</code></pre>
<ul>
<li><span class="ribbon-highlight">Example</span>
<ul>
<li>Comparison with a “derived” query</li>
<li>“What is the average monthly cost per campaign for the company’s marketing efforts?”</li>
<li>Using CTE workflow</li>
</ul></li>
</ul>
<pre><code>-- define CTE:
WITH Cost_by_Month AS
(SELECT campaign_id AS campaign,
&nbsp; &nbsp; &nbsp; TO_CHAR(created_date, 'YYYY-MM') AS month,
&nbsp; &nbsp; &nbsp; SUM(cost) AS monthly_cost
FROM marketing
WHERE created_date BETWEEN NOW() - INTERVAL '3 MONTH' AND NOW()
GROUP BY 1, 2
ORDER BY 1, 2)
-- use CTE in subsequent query:
SELECT campaign, avg(monthly_cost) as "Avg Monthly Cost"
FROM Cost_by_Month
GROUP BY campaign
ORDER BY campaign</code></pre>
<ul>
<li>Used derived query</li>
</ul>
<pre><code>-- Derived
SELECT campaign, avg(monthly_cost) as "Avg Monthly Cost"
FROM
&nbsp; &nbsp; -- this is where the derived query is used
&nbsp; &nbsp; (SELECT campaign_id AS campaign,
&nbsp; &nbsp; &nbsp; TO_CHAR(created_date, 'YYYY-MM') AS month,
&nbsp; &nbsp; &nbsp; SUM(cost) AS monthly_cost
&nbsp; &nbsp; FROM marketing
&nbsp; &nbsp; WHERE created_date BETWEEN NOW() - INTERVAL '3 MONTH' AND NOW()
&nbsp; &nbsp; GROUP BY 1, 2
&nbsp; &nbsp; ORDER BY 1, 2) as Cost_By_Month
GROUP BY campaign
ORDER BY campaign</code></pre>
<ul>
<li><span class="ribbon-highlight">Example</span>
<ul>
<li>Count the number of interactions of new users</li>
<li>Steps
<ul>
<li>Get new users</li>
<li>Count interactions</li>
<li>Get interactions of new users</li>
</ul></li>
</ul></li>
</ul>
<pre><code>WITH new_users AS (
&nbsp; &nbsp; SELECT id
&nbsp; &nbsp; FROM users
&nbsp; &nbsp; WHERE created &gt;= '2021-01-01'
),
count_interactions AS (
&nbsp; &nbsp; SELECT id,
&nbsp; &nbsp; &nbsp; &nbsp; COUNT(*) n_interactions
&nbsp; &nbsp; FROM interactions
&nbsp; &nbsp; GROUP BY id
),
interactions_by_new_users AS (
&nbsp; &nbsp; SELECT id,
&nbsp; &nbsp; &nbsp; &nbsp; n_interactions
&nbsp; &nbsp; FROM new_users
&nbsp; &nbsp; &nbsp; &nbsp; LEFT JOIN count_interactions USING (id)
)

SELECT *
FROM interactions_by_new_users</code></pre>
<ul>
<li><span class="ribbon-highlight">Example</span>
<ul>
<li>Find the average top Math test score for students in California</li>
<li>Steps
<ol type="1">
<li>Get a subset of students (California)</li>
<li>Get a subset of test scores (Math)</li>
<li>Join them together to get all Math test scores from California students</li>
<li>Get the top score per student</li>
<li>Take the overall average</li>
</ol></li>
<li>Derived Query (i.e.&nbsp;w/o CTE)</li>
</ul></li>
</ul>
<pre><code>SELECT AVG(score)
FROM&nbsp;
&nbsp; (SELECT students.id, MAX(test_results.score) as score
&nbsp; FROM students&nbsp;
&nbsp; JOIN schools ON (
&nbsp; &nbsp; students.school_id = schools.id AND schools.state = 'CA'
&nbsp; )
&nbsp; JOIN test_results ON (
&nbsp; &nbsp; students.id = test_results.student_id
&nbsp; &nbsp; AND test_results.subject = 'math'
&nbsp; )
&nbsp; GROUP BY students.id) as tmp</code></pre>
<ul>
<li>Using CTE</li>
</ul>
<pre><code>WITH
&nbsp; student_subset as (
&nbsp; &nbsp; SELECT students.id&nbsp;
&nbsp; &nbsp; FROM students&nbsp;
&nbsp; &nbsp; JOIN schools ON (
&nbsp; &nbsp; &nbsp; students.school_id = schools.id AND schools.state = 'CA'
&nbsp; &nbsp; )
&nbsp; ),
&nbsp; score_subset as (
&nbsp; &nbsp; SELECT student_id, score&nbsp;
&nbsp; &nbsp; FROM test_results&nbsp;
&nbsp; &nbsp; WHERE subject = 'math'
&nbsp; ),
&nbsp; student_scores as (
&nbsp; &nbsp; SELECT student_subset.id, score_subset.score
&nbsp; &nbsp; FROM student_subset&nbsp;
&nbsp; &nbsp; JOIN score_subset ON (
&nbsp; &nbsp; &nbsp; &nbsp; student_subset.id = score_subset.student_id
&nbsp; &nbsp; )
&nbsp; ),
&nbsp; top_score_per_student as (
&nbsp; &nbsp; SELECT id, MAX(score) as score&nbsp;
&nbsp; &nbsp; FROM student_scores&nbsp;
&nbsp; &nbsp; GROUP BY id
&nbsp; )
SELECT AVG(score)&nbsp;
FROM top_score_per_student</code></pre>
</section>
<section id="sec-sql-str" class="level2 unnumbered">
<h2 class="unnumbered anchored" data-anchor-id="sec-sql-str">Strings</h2>
<ul>
<li>Concatenate
<ul>
<li>“||”</li>
</ul></li>
</ul>
<pre><code>SELECT 'PostgreSQL' || ' ' || 'Databases' AS result;

&nbsp; &nbsp; result
--------------
PostgreSQL Databases</code></pre>
<ul>
<li><code>CONCAT</code></li>
</ul>
<pre><code>SELECT CONCAT('PostgreSQL', ' ', 'Databases') AS result;

&nbsp; &nbsp; result
--------------
PostgreSQL Databases</code></pre>
<ul>
<li>With NULL values</li>
</ul>
<pre><code>SELECT CONCAT('Harry', NULL, 'Peter');

--------------
HarryPeter</code></pre>
<ul>
<li><p>“||” won’t work with NULLs</p></li>
<li><p>Columns</p></li>
</ul>
<pre><code>SELECT first_name, last_name,&nbsp;
CONCAT(first_name,' ' , last_name) "Full Name"&nbsp;
FROM candidates;</code></pre>
<ul>
<li><p>New column, “Full Name”, is created with concatenated columns</p></li>
<li><p>Splitting (BQ)</p></li>
</ul>
<pre><code>SELECT
*,
CASE WHEN ARRAY_LENGTH(SPLIT(page_location, '/')) &gt;= 5&nbsp;
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; AND
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; CONTAINS_SUBSTR(ARRAY_REVERSE(SPLIT(page_location, '/'))[SAFE_OFFSET(0)], '+')
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; AND (LOWER(SPLIT(page_location, '/')[SAFE_OFFSET(4)]) IN&nbsp;
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ('accessories','apparel','brands','campus+collection','drinkware',
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 'electronics','google+redesign',
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 'lifestyle','nest','new+2015+logo','notebooks+journals',
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 'office','shop+by+brand','small+goods','stationery','wearables'
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; )
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; OR
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; LOWER(SPLIT(page_location, '/')[SAFE_OFFSET(3)]) IN&nbsp;
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ('accessories','apparel','brands','campus+collection','drinkware',
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 'electronics','google+redesign',
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 'lifestyle','nest','new+2015+logo','notebooks+journals',
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 'office','shop+by+brand','small+goods','stationery','wearables'
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; )
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; )
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; THEN 'PDP'
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; WHEN NOT(CONTAINS_SUBSTR(ARRAY_REVERSE(SPLIT(page_location, '/'))[SAFE_OFFSET(0)], '+'))
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; AND (LOWER(SPLIT(page_location, '/')[SAFE_OFFSET(4)]) IN&nbsp;
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ('accessories','apparel','brands','campus+collection','drinkware',
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 'electronics','google+redesign',
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 'lifestyle','nest','new+2015+logo','notebooks+journals',
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 'office','shop+by+brand','small+goods','stationery','wearables'
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; )
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; OR&nbsp;
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; LOWER(SPLIT(page_location, '/')[SAFE_OFFSET(3)]) IN&nbsp;
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ('accessories','apparel','brands','campus+collection','drinkware',
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 'electronics','google+redesign',
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 'lifestyle','nest','new+2015+logo','notebooks+journals',
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 'office','shop+by+brand','small+goods','stationery','wearables'
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; )
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; )
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; THEN 'PLP'
&nbsp; &nbsp; &nbsp; ELSE page_title
&nbsp; &nbsp; &nbsp; END AS page_title_adjusted&nbsp;
FROM&nbsp;
&nbsp; unnested_events</code></pre>
<ul>
<li>From <a href="https://towardsdatascience.com/looking-for-power-user-journeys-in-e-commerce-746f5f68b697">article</a>, <a href="https://gist.github.com/khunreus/17d0f5377bd15b41b2e4956a7166710a">gist</a></li>
<li>Query is creating a new categorical column, “page_title_adjusted,” that is “PDP” when a substring in “page_location” is one of a set of words, and “PLP” when it’s not, and the value of page_title otherwise.</li>
<li>SPLIT splits the string by separator, ‘/’</li>
<li>CONTAINS_SUBSTR is looking for substring with a “+”</li>
<li>[SAFE_OFFSET(3)] pulls the 4th substring (think this indexes by 0?)
<ul>
<li>after it’s been reversed via ARRAY_REVERSE (?)</li>
</ul></li>
<li>ELSE says use the value for page_title when length of the substrings after splitting page_location is 5 or less</li>
<li>“unnested_events” is a CTE</li>
</ul>
</section>
<section id="sec-sql-arr" class="level2 unnumbered">
<h2 class="unnumbered anchored" data-anchor-id="sec-sql-arr">Arrays</h2>
<ul>
<li>Misc
<ul>
<li>PostGres
<ul>
<li>Indexing Arrays starts at 1, not at 0</li>
</ul></li>
</ul></li>
<li>Create Array (BQ)</li>
</ul>
<pre><code>SELECT ARRAY
&nbsp; (SELECT 1 UNION ALL
&nbsp; SELECT 2 UNION ALL
&nbsp; SELECT 3) AS new_array;
+-----------+
| new_array |
+-----------+
| [1, 2, 3] |
+-----------+

SELECT
&nbsp; ARRAY
&nbsp; &nbsp; (SELECT AS STRUCT 1, 2, 3
&nbsp; &nbsp; UNION ALL SELECT AS STRUCT 4, 5, 6) AS new_array;
+------------------------+
| new_array&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; |
+------------------------+
| [{1, 2, 3}, {4, 5, 6}] |
+------------------------+

SELECT ARRAY
&nbsp; (SELECT AS STRUCT [1, 2, 3] UNION ALL
&nbsp; SELECT AS STRUCT [4, 5, 6]) AS new_array;
+----------------------------+
| new_array&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; |
+----------------------------+
| [[{]{style='color: #990000'}[1, 2, 3]}, [{]{style='color: #990000'}[4, 5, 6]}] |
+----------------------------+</code></pre>
<ul>
<li>Create a table with Arrays (Postgres)<img src="./_resources/SQL.resources/image.5.png" class="img-fluid"></li>
</ul>
<pre><code>CREATE TEMP TABLE shopping_cart (
&nbsp; cart_id serial PRIMARY KEY,
&nbsp; products text ARRAY
&nbsp; );
INSERT INTO
&nbsp; shopping_cart(products)
VALUES
&nbsp; (ARRAY['product_a', 'product_b']),
&nbsp; (ARRAY['product_c', 'product_d']),
&nbsp; (ARRAY['product_a', 'product_b', 'product_c']),
&nbsp; (ARRAY['product_a', 'product_b', 'product_d']),
&nbsp; (ARRAY['product_b', 'product_d']);

-- alt syntax w/o ARRAY
INSERT INTO
&nbsp; shopping_cart(products)
VALUES
&nbsp; ('{"product_a", "product_d"}');</code></pre>
<ul>
<li><p>Also see Basics &gt;&gt; Add Data &gt;&gt; Example: chatGPT</p></li>
<li><p>Subset an array (postgres)<img src="./_resources/SQL.resources/image.7.png" class="img-fluid"></p></li>
</ul>
<pre><code>SELECT
&nbsp; cart_id,
&nbsp; products[1] AS first_product -- indexing starts at 1
FROM
&nbsp; shopping_cart;</code></pre>
<ul>
<li>Slice an array (postgres)<img src="./_resources/SQL.resources/image.8.png" class="img-fluid"></li>
</ul>
<pre><code>SELECT
&nbsp; cart_id,
&nbsp; products [1:2] AS first_two_products
FROM
&nbsp; shopping_cart
WHERE
&nbsp; CARDINALITY(products) &gt; 2;</code></pre>
<ul>
<li>Unnest an array (postgres)<img src="./_resources/SQL.resources/image.6.png" class="img-fluid"></li>
</ul>
<pre><code>SELECT
&nbsp; cart_id,
&nbsp; UNNEST(products) AS products
FROM
&nbsp; shopping_cart
WHERE
&nbsp; cart_id IN (3, 4);</code></pre>
<ul>
<li><p>Useful if you want to perform a join</p></li>
<li><p>Filter according to items in arrays (postgres)</p></li>
</ul>
<pre><code>SELECT
&nbsp; cart_id,
&nbsp; products
FROM
&nbsp; shopping_cart
WHERE
&nbsp; 'product_c' = ANY (products);</code></pre>
<ul>
<li><p>Only rows with arrays that have “product_c” will be returned</p></li>
<li><p>Change array values using <code>UPDATE</code>, <code>SET</code></p></li>
</ul>
<pre><code>-- update arrays&nbsp;
UPDATE
&nbsp; shopping_cart
SET
&nbsp; products = ARRAY['product_a','product_b','product_e']
WHERE
&nbsp; cart_id = 1;
UPDATE&nbsp;
&nbsp; shopping_cart
SET
&nbsp; products[1] = 'product_f'
WHERE
&nbsp; cart_id = 2;
SELECT
&nbsp; *
FROM
&nbsp; shopping_cart
ORDER BY cart_id;</code></pre>
<ul>
<li><p>First update: all arrays where cart_id == 1 are set to [‘product_a’,‘product_b’,‘product_e’]</p></li>
<li><p>Second update: all array first values where cart_id == 2 are set to ‘product_f’</p></li>
<li><p>Insert array values</p>
<ul>
<li><code>ARRAY_APPEND</code> - puts value at the end of the array</li>
</ul></li>
</ul>
<pre><code>UPDATE
&nbsp; shopping_cart
SET
&nbsp; products = ARRAY_APPEND(products, 'product_x')
WHERE
&nbsp; cart_id = 1;</code></pre>
<ul>
<li><p>arrays in product column where cart_id == 1 get “product_x” appended to the end of their arrays</p></li>
<li><p><code>ARRAY_PREPEND</code> - puts value at the beginning of the array</p></li>
</ul>
<pre><code>UPDATE&nbsp;
&nbsp; shopping_cart
SET
&nbsp; products = ARRAY_PREPEND('product_x', products)
WHERE
&nbsp; cart_id = 2;</code></pre>
<ul>
<li><p>arrays in product column where cart_id == 2 get “product_x” prepended to the beginning of their arrays</p></li>
<li><p><code>ARRAY_REMOVE</code> - remove array item</p></li>
</ul>
<pre><code>UPDATE
&nbsp; shopping_cart
SET
&nbsp; products = array_remove(products, 'product_e')
WHERE cart_id = 1;</code></pre>
<ul>
<li><p>arrays in product column where cart_id == 1 get “product_e” removed from their arrays</p></li>
<li><p><code>ARRAY_CONCAT</code>(BQ), <code>ARRAY_CAT</code>(postgres) - Concantenate</p></li>
</ul>
<pre><code>SELECT ARRAY_CONCAT([1, 2], [3, 4], [5, 6]) as count_to_six;
+--------------------------------------------------+
| count_to_six&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; |
+--------------------------------------------------+
| [1, 2, 3, 4, 5, 6]&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; |
+--------------------------------------------------+

-- postgres
SELECT
&nbsp; cart_id,
&nbsp; ARRAY_CAT(products, ARRAY['promo_product_1', 'promo_product_2'])
FROM shopping_cart
ORDER BY cart_id;</code></pre>
<ul>
<li><code>ARRAY_TO_STRING</code> - Coerce to string (BQ)</li>
</ul>
<pre><code>WITH items AS
&nbsp; (SELECT ['coffee', 'tea', 'milk' ] as list
&nbsp; UNION ALL
&nbsp; SELECT ['cake', 'pie', NULL] as list)
SELECT ARRAY_TO_STRING(list, '--') AS text
FROM items;
+--------------------------------+
| text&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; |
+--------------------------------+
| coffee--tea--milk&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; |
| cake--pie&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; |
+--------------------------------+

WITH items AS
&nbsp; (SELECT ['coffee', 'tea', 'milk' ] as list
&nbsp; UNION ALL
&nbsp; SELECT ['cake', 'pie', NULL] as list)
SELECT ARRAY_TO_STRING(list, '--', 'MISSING') AS text
FROM items;
+--------------------------------+
| text&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; |
+--------------------------------+
| coffee--tea--milk&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; |
| cake--pie--MISSING&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; |
+--------------------------------+</code></pre>
<ul>
<li><code>ARRAY_AGG</code> - gather values of a group by variable into an array (<a href="https://docs.snowflake.com/en/sql-reference/functions/array_agg.html">doc</a>)
<ul>
<li>Makes the output more readable</li>
<li>Example: Get categories for each brand</li>
</ul></li>
</ul>
<pre><code>-- without array_agg
select
&nbsp; &nbsp; brand,
&nbsp; &nbsp; category
from order_item
group by brand, category
order by brand, category
;
Results:
| brand&nbsp; | category&nbsp; |&nbsp;
| ------ | ---------- |&nbsp;
| Arket&nbsp; | jacket&nbsp; &nbsp; |
| COS&nbsp; &nbsp; | shirts&nbsp; &nbsp; |
| COS&nbsp; &nbsp; | trousers&nbsp; |&nbsp;
| COS&nbsp; &nbsp; | vest&nbsp; &nbsp; &nbsp; |
| Levi's | jacket&nbsp; &nbsp; |
| Levi's | jeans&nbsp; &nbsp; &nbsp; |

-- with array_agg
select
&nbsp; brand,
&nbsp; array_agg(distinct category) as all_categories
from order_item
group by brand
order by brand
;
Results:
| brand&nbsp; | all_categories&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; |&nbsp;
| ------ | ---------------------------- |&nbsp;
| Arket&nbsp; | ['jacket']&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; |
| COS&nbsp; &nbsp; | ['shirts','trousers','vest'] |
| Levi's | ['jacket','jeans']&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; |
| Uniqlo | ['shirts','t-shirts','vest'] |</code></pre>
<ul>
<li><code>ARRAY_SIZE</code> - function takes an array or a variant as input and returns the number of items within the array/variant (<a href="https://docs.snowflake.com/en/sql-reference/functions/array_size.html">doc</a>)
<ul>
<li>Example: How many categories does each brand have?</li>
</ul></li>
</ul>
<pre><code>select
&nbsp; brand,
&nbsp; array_agg(distinct category) as all_categories,
&nbsp; array_size(all_categories) as no_of_cat
from order_item
group by brand
order by brand
;
Results:
| brand&nbsp; | all_categories&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; | no_of_cat |
| ------ | ---------------------------&nbsp; | --------- |
| Arket&nbsp; | ['jacket']&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; | 1&nbsp; &nbsp; &nbsp; &nbsp; |
| COS&nbsp; &nbsp; | ['shirts','trousers','vest'] | 3&nbsp; &nbsp; &nbsp; &nbsp; |
| Levi's | ['jacket','jeans']&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; | 2&nbsp; &nbsp; &nbsp; &nbsp; |
| Uniqlo | ['shirts','t-shirts','vest'] | 3&nbsp; &nbsp; &nbsp; &nbsp; |

-- postgres using CARDINALITY to get array_size
SELECT
&nbsp; cart_id,
&nbsp; CARDINALITY(products) AS num_products
FROM
&nbsp; shopping_cart;</code></pre>
<ul>
<li><code>ARRAY_CONTAINS</code> checks if a <em>variant</em> is included in an array and returns a boolean value. (<a href="https://docs.snowflake.com/en/sql-reference/functions/array_contains.html">doc</a>)
<ul>
<li>Variant is just a specific category</li>
<li>Need to cast the item you’d like to check as a variant first</li>
<li>Syntax: <code>ARRAY_CONTAINS(variant, array)</code></li>
<li>Example: What brands have jackets?</li>
</ul></li>
</ul>
<pre><code>select
&nbsp; brand,
&nbsp; array_agg(distinct category) as all_categories,
&nbsp; array_size(all_categories) as no_of_cat,
&nbsp; array_contains('jacket'::variant,all_categories) as has_jacket
from order_item
group by brand
order by brand
;
Results:
| brand&nbsp; | all_categories&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; | no_of_cat | has_jacket |
| ------ | ---------------------------&nbsp; | --------- | ---------- |
| Arket&nbsp; | ['jacket']&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; | 1&nbsp; &nbsp; &nbsp; &nbsp; | true&nbsp; &nbsp; &nbsp; |
| COS&nbsp; &nbsp; | ['shirts','trousers','vest'] | 3&nbsp; &nbsp; &nbsp; &nbsp; | false&nbsp; &nbsp; &nbsp; |
| Levi's | ['jacket','jeans']&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; | 2&nbsp; &nbsp; &nbsp; &nbsp; | true&nbsp; &nbsp; &nbsp; |
| Uniqlo | ['shirts','t-shirts','vest'] | 3&nbsp; &nbsp; &nbsp; &nbsp; | false&nbsp; &nbsp; &nbsp; |

-- postgres contains_operator, @&gt;
SELECT
&nbsp; cart_id,
&nbsp; products
FROM
&nbsp; shopping_cart
WHERE
&nbsp; products&nbsp; @&gt; ARRAY['product_a', 'product_b'];</code></pre>
<ul>
<li>“@&gt;” example returns all rows with arrays containing product_a and product_b</li>
</ul>
</section>
<section id="sec-sql-bizq" class="level2 unnumbered">
<h2 class="unnumbered anchored" data-anchor-id="sec-sql-bizq">Business Queries</h2>
<ul>
<li>Simple Moving Average (SMA)
<ul>
<li>Example: 7-day SMA including today</li>
</ul></li>
</ul>
<pre><code>SELECT
&nbsp; Date, Conversions,
&nbsp; AVG(Conversions) OVER (ORDER BY Date ROWS BETWEEN 6 PRECEDING AND
&nbsp; CURRENT ROW) as SMA
FROM daily_sales</code></pre>
<ul>
<li>Example: 3-day SMA not including today</li>
</ul>
<pre><code>select
&nbsp; date,
&nbsp; sales,
&nbsp; avg(sales) over (order by date
&nbsp; &nbsp; &nbsp; &nbsp; rows between 3 preceding and current row - 1) as moving_avg
from table_daily_sales</code></pre>
<ul>
<li>Rank product categories by shipping cost for each shipping address<img src="./_resources/SQL.resources/image.png" class="img-fluid"></li>
</ul>
<pre><code>SELECT Product_Category,
&nbsp; Shipping_Address,
&nbsp; Shipping_Cost,
&nbsp; ROW_NUMBER() OVER
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; (PARTITION BY Product_Category,
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; Shipping_Address
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ORDER BY Shipping_Cost DESC) as RowNumber,
&nbsp; RANK() OVER&nbsp;
&nbsp; &nbsp; &nbsp; &nbsp; (PARTITION BY Product_Category,
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; Shipping_Address
&nbsp; &nbsp; &nbsp; &nbsp; ORDER BY Shipping_Cost DESC) as RankValues,
&nbsp; DENSE_RANK() OVER&nbsp;
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; (PARTITION BY Product_Category,
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; Shipping_Address&nbsp;
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ORDER BY Shipping_Cost DESC) as DenseRankValues
FROM Dummy_Sales_Data_v1
WHERE Product_Category IS NOT NULL
AND Shipping_Address IN ('Germany','India')
AND Status IN ('Delivered')</code></pre>
<ul>
<li><p><code>RANK()</code> is retrieves ranked rows based on the condition of <code>ORDER BY</code> clause. As you can see there is a tie between 1st two rows i.e.&nbsp;first two rows have same value in Shipping_Cost column (which is mentioned in ORDER BY clause).</p></li>
<li><p><code>DENSE_RANK</code> is similar to the <code>RANK</code> , but it does not skip any numbers even if there is a tie between the rows. This you can see in Blue box in the above picture.</p></li>
<li><p>Rank resets to 1 when “Shipping_Address” changes location</p></li>
<li><p>Total order quantity for each month</p></li>
</ul>
<pre><code>SELECT strftime('%m', OrderDate) as Month,
&nbsp; &nbsp; &nbsp; SUM(Quantity) as Total_Quantity
from Dummy_Sales_Data_v1
GROUP BY strftime('%m', OrderDate)</code></pre>
<ul>
<li><p><code>strftime</code> extracts the month (%m) from the datetime column, “OrderDate”</p></li>
<li><p>Daily counts of open jobs</p>
<ul>
<li>The issue is that there aren’t rows for transactions that remain in a type of holding status
<ul>
<li>e.g.&nbsp;Job Postings website has date columns for the date the job posting was created, the date the job posting went live on the website, and the date the job posting was taken down (action based timestamps), but no dates for the status between “went live” and “taken down”.</li>
</ul></li>
</ul></li>
</ul>
<pre><code>-- create a calendar column
SELECT parse_datetime('2020–01–01 08:00:00', 'yyyy-MM-dd H:m:s') + (interval '1' day * d) as cal_date from&nbsp;
FROM ( SELECT
ROW_NUMBER() OVER () -1 as d
FROM
(SELECT 0 as n UNION SELECT 1) p0,
(SELECT 0 as n UNION SELECT 1) p1,
(SELECT 0 as n UNION SELECT 1) p2,
(SELECT 0 as n UNION SELECT 1) p3,
(SELECT 0 as n UNION SELECT 1) p4,
(SELECT 0 as n UNION SELECT 1) p5,
(SELECT 0 as n UNION SELECT 1) p6,
(SELECT 0 as n UNION SELECT 1) p7,
(SELECT 0 as n UNION SELECT 1) p8,
(SELECT 0 as n UNION SELECT 1) p9,
(SELECT 0 as n UNION SELECT 1) p10
)

-- left-join your table to the calendar column
Select
&nbsp; &nbsp; c.cal_date,
&nbsp; &nbsp; count(distinct opp_id) as "historical_prospects"
From calendar c
Left Join
&nbsp; &nbsp; opportunities o
&nbsp; &nbsp; on
&nbsp; &nbsp; &nbsp; &nbsp; o.stage_entered ≤ c.cal_date&nbsp;
&nbsp; &nbsp; &nbsp; &nbsp; and (o.stage_exited is null or o.stage_exited &gt; c.cal_date)</code></pre>
<ul>
<li><p>Calendar column should probably be a CTE</p></li>
<li><p>Notes from <a href="https://towardsdatascience.com/using-sql-to-calculate-trends-based-on-historical-status-2ee75f23c4e4">Using SQL to calculate trends based on historical status</a></p></li>
<li><p>Some flavours of SQL have a <a href="https://www.postgresql.org/docs/current/functions-srf.html">generate_series</a> function, which will create this calendar column for you</p></li>
<li><p>For one particular month, then create an indicator column with “if posting_publish_date ≤ 2022–01–01 and (posting_closed_date is null or posting_closed_date &gt; 2022–01–31) then True” and then filter for True and count.</p></li>
<li><p>Get the latest order from each customer</p></li>
</ul>
<pre><code>-- Using QUALIFY
select
&nbsp; &nbsp; date,
&nbsp; &nbsp; customer_id,
&nbsp; &nbsp; order_id,
&nbsp; &nbsp; price
from customer_order_table
qualify row_number() over (partition by customer_id order by date desc) = 1
;
-- CTE w/window function
with order_order as
(
select
&nbsp; &nbsp; date,
&nbsp; &nbsp; customer_id,
&nbsp; &nbsp; order_id,
&nbsp; &nbsp; price,
&nbsp; &nbsp; row_number() over (partition by customer_id order by date desc)&nbsp; &nbsp;
&nbsp; &nbsp; as order_of_orders
from customer_order_table&nbsp;
)
select
&nbsp; &nbsp; *
from order_order
where order_of_orders = 1
;
Results:
| date&nbsp; &nbsp; &nbsp; | customer_id | order_id | price |
|------------|-------------|----------|-------|
| 2022-01-03 | 002&nbsp; &nbsp; &nbsp; &nbsp; | 212&nbsp; &nbsp; &nbsp; | 350&nbsp; |
| 2022-01-06 | 005&nbsp; &nbsp; &nbsp; &nbsp; | 982&nbsp; &nbsp; &nbsp; | 300&nbsp; |
| 2022-01-07 | 001&nbsp; &nbsp; &nbsp; &nbsp; | 109&nbsp; &nbsp; &nbsp; | 120&nbsp; |</code></pre>
</section>
<section id="sec-sql-trans" class="level2 unnumbered">
<h2 class="unnumbered anchored" data-anchor-id="sec-sql-trans">Transactions</h2>
<ul>
<li>Misc
<ul>
<li>Also see Terms &gt;&gt; Transaction</li>
<li>When the transaction is successful, COMMIT is applied. When the transaction is aborted, incorrect execution, system failure ROLLBACK occurs.</li>
</ul></li>
<li>Only used with INSERT, UPDATE and DELETE</li>
<li><code>BEGIN TRANSACTION</code>: It indicates the start point of an explicit or local transaction.
<ul>
<li>Represents a point at which the data referenced by a connection is logically and physically consistent.</li>
<li>If errors are encountered, all data modifications made after the BEGIN TRANSACTION can be rolled back to return the data to this known state of consistency</li>
<li>Syntax: <code>BEGIN TRANSACTION transaction_name ;</code></li>
</ul></li>
<li><code>SET TRANSACTION</code>: Places a name on a transaction.
<ul>
<li>Syntax: <code>SET TRANSACTION [ READ WRITE | READ ONLY ];</code></li>
</ul></li>
<li><code>COMMIT</code>: used to permanently save the changes done in the transaction in tables/databases. The database cannot regain its previous state after its execution of commit.
<ul>
<li>If everything is in order with all statements within a single transaction, all changes are recorded together in the database is called committed. The COMMIT command saves all the transactions to the database since the last COMMIT or ROLLBACK command</li>
<li>Example: Delete records</li>
</ul></li>
</ul>
<pre><code>DELETE FROM Student WHERE AGE = 20;
COMMIT;</code></pre>
<ul>
<li><p>Deletes those records from the table which have age = 20 and then commits the changes in the database.</p></li>
<li><p><code>ROLLBACK</code>: used to undo the transactions that have not been saved in the database. The command is only been used to undo changes since the last commit</p>
<ul>
<li>If any error occurs with any of the SQL grouped statements, all changes need to be aborted. The process of reversing changes is called rollback. This command can only be used to undo transactions since the last COMMIT or ROLLBACK command was issued.</li>
<li>Syntax: <code>ROLLBACK;</code></li>
</ul></li>
<li><p><code>SAVEPOINT</code>: creates points within the groups of transactions in which to ROLLBACK.</p>
<ul>
<li>Syntax: <code>SAVEPOINT &lt;savepoint_name&gt;;</code></li>
<li>A savepoint is a point in a transaction in which you can roll the transaction back to a certain point without rolling back the entire transaction.</li>
<li>Remove a savepoint: <code>RELEASE SAVEPOINT &lt;savepoint_name&gt;</code></li>
<li>Example: Rollback a deletion</li>
</ul></li>
</ul>
<pre><code>SAVEPOINT SP1;
//Savepoint created.
DELETE FROM Student WHERE AGE = 20;
//deleted
SAVEPOINT SP2;
//Savepoint created.
ROLLBACK TO SP1;
//Rollback completed.</code></pre>
</section>
<section id="sec-sql-procexp" class="level2 unnumbered">
<h2 class="unnumbered anchored" data-anchor-id="sec-sql-procexp">Processing Expressions</h2>
<ul>
<li>Division and NULLS
<ul>
<li>Any division with NULL values with have a result of NULL.</li>
<li><code>isNull</code> allows to get a different resulting value</li>
</ul></li>
</ul>
<pre><code>SELECT IsNull(&lt;column&gt;, 0) / 45</code></pre>
<ul>
<li><p>All NULL values in the column will replaced with 0s during the division operation.</p></li>
<li><p>Use multiple conditions in a WHERE expression</p></li>
</ul>
<pre><code>select
&nbsp; &nbsp; *
from XXX_table
where 1=1
&nbsp; &nbsp; (if condition A) and clause 1&nbsp;
&nbsp; &nbsp; (if condition B) and clause 2&nbsp;
&nbsp; &nbsp; (if condition C) and clause 3
;</code></pre>
<ul>
<li>The “1=1” prevents errors that would occur when the first condition doesn’t apply to any rows.
<ul>
<li>Can also use “true”</li>
</ul></li>
<li>Select unique rows without using DISTINCT
<ul>
<li>Using UNION</li>
</ul></li>
</ul>
<pre><code>SELECT employee_id,
&nbsp; &nbsp; &nbsp; employee_name,
&nbsp; &nbsp; &nbsp; department
FROM Dummy_employees
UNION
SELECT employee_id,
&nbsp; &nbsp; &nbsp; employee_name,
&nbsp; &nbsp; &nbsp; department
FROM Dummy_employees</code></pre>
<ul>
<li><p>there must be same number and order of columns in both the SELECT statements</p></li>
<li><p>Using INTERSECT</p></li>
</ul>
<pre><code>SELECT employee_id,
&nbsp; &nbsp; &nbsp; employee_name,
&nbsp; &nbsp; &nbsp; department
FROM Dummy_employees
INTERSECT
SELECT employee_id,
&nbsp; &nbsp; &nbsp; employee_name,
&nbsp; &nbsp; &nbsp; department
FROM Dummy_employees</code></pre>
<ul>
<li><p>there must be same number and order of columns in both the SELECT statements</p></li>
<li><p>Using ROW_NUMBER</p></li>
</ul>
<pre><code>WITH temporary_employees as
(
SELECT
&nbsp; employee_id,
&nbsp; employee_name,
&nbsp; department,
&nbsp; ROW_NUMBER() OVER(PARTITION BY employee_name,
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; department,
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; employee_id) as row_count
FROM Dummy_employees
)
SELECT *
FROM temporary_employees
WHERE row_count = 1</code></pre>
<ul>
<li>Using GROUP BY</li>
</ul>
<pre><code>SELECT employee_id,
&nbsp; &nbsp; &nbsp; employee_name,
&nbsp; &nbsp; &nbsp; department
FROM Dummy_employees
GROUP BY employee_id,
&nbsp; &nbsp; &nbsp; &nbsp; employee_name,
&nbsp; &nbsp; &nbsp; &nbsp; department</code></pre>
<ul>
<li><p>Just need to group by all the columns. Useful to use in conjunction with aggregate functions.</p></li>
<li><p>CASE WHEN</p></li>
</ul>
<pre><code>SELECT OrderID,
&nbsp; &nbsp; &nbsp; OrderDate,
&nbsp; &nbsp; &nbsp; Sales_Manager,
&nbsp; &nbsp; &nbsp; Quantity,
&nbsp; &nbsp; &nbsp; CASE WHEN Quantity &gt; 51 THEN 'High'
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; WHEN Quantity &lt; 51 THEN 'Low'
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ELSE 'Medium'&nbsp;
&nbsp; &nbsp; &nbsp; END AS OrderVolume
FROM Dummy_Sales_Data_v1</code></pre>
<ul>
<li><code>END AS</code> specifies the name of the new column, “OrderVolume”</li>
<li><code>ELSE</code> specifies the value when none of the conditions are met
<ul>
<li>If you did not mention ELSE clause and no condition is satisfied, the query will return NULL for that specific record</li>
</ul></li>
<li>Pivot Wider<img src="./_resources/SQL.resources/image.1.png" class="img-fluid"></li>
</ul>
<pre><code>SELECT Sales_Manager,
&nbsp; &nbsp; &nbsp; COUNT(CASE WHEN Shipping_Address = 'Singapore' THEN OrderID
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; END) AS Singapore_Orders,

&nbsp; &nbsp; &nbsp; COUNT(CASE WHEN Shipping_Address = 'UK' THEN OrderID
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; END) AS UK_Orders,

&nbsp; &nbsp; &nbsp; COUNT(CASE WHEN Shipping_Address = 'Kenya' THEN OrderID
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; END) AS Kenya_Orders,

&nbsp; &nbsp; &nbsp; COUNT(CASE WHEN Shipping_Address = 'India' THEN OrderID
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; END) AS India_Orders
FROM Dummy_Sales_Data_v1
GROUP BY Sales_Manager</code></pre>
<ul>
<li><p>Depending on your use-case you can also use different aggregation such as SUM, AVG, MAX, MIN with CASE statement.</p></li>
<li><p>Extract components from date-time columns</p></li>
</ul>
<pre><code>/* MySQL */
EXTRACT(part_of_date FROM date_time_column_name)
YEAR(date_time_column_name)
MONTH(date_time_column_name)
MONTHNAME(date_time_column_name)
DATE_FORMAT(date_time_column_name)

/* SQLte */
SELECT strftime('%m', OrderDate) as Month</code></pre>
<ul>
<li><p><code>strftime</code> codes<img src="./_resources/SQL.resources/image.2.png" class="img-fluid"></p></li>
<li><p>Duplicated Rows</p>
<ul>
<li>Remove duplicated rows with window function</li>
</ul></li>
</ul>
<pre><code>WITH temporary_employees as&nbsp;
(SELECT&nbsp;
&nbsp; employee_id,&nbsp;
&nbsp; employee_name,&nbsp;
&nbsp; department,&nbsp;
&nbsp; ROW_NUMBER() OVER(PARTITION BY employee_name,&nbsp;
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; department,&nbsp;
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; employee_id) as row_count&nbsp;
FROM Dummy_employees)

SELECT *&nbsp;
FROM temporary_employees&nbsp;
WHERE row_count = 1</code></pre>
<ul>
<li>Use a hash column as id column, then test for duplicates, remove them or investigate them (BigQuery)<img src="./_resources/SQL.resources/image.3.png" class="img-fluid"></li>
</ul>
<pre><code>WITH
&nbsp; &nbsp; inbound_zoo_elephants AS (
&nbsp; &nbsp; &nbsp; &nbsp; SELECT *
&nbsp; &nbsp; &nbsp; &nbsp; FROM flowfunctions.examples.zoo_elephants
&nbsp; &nbsp; ),
&nbsp; &nbsp; add_row_hash AS (
&nbsp; &nbsp; &nbsp; &nbsp; SELECT
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; *,
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; TO_HEX(MD5(TO_JSON_STRING(inbound_zoo_elephants))) AS hex_row_hash
&nbsp; &nbsp; &nbsp; &nbsp; FROM inbound_zoo_elephants
&nbsp; &nbsp; )

SELECT
&nbsp; &nbsp; COUNT(*) AS records,
&nbsp; &nbsp; COUNT(DISTINCT hex_row_hash) AS unique_records
FROM add_row_hash</code></pre>
<ul>
<li>No duplicate records found, since “records” = 9 and “unique_records” = 9
<ul>
<li>if records &gt; unique_records, duplicates exist</li>
</ul></li>
<li>Can select distinct hex_row_hash if you want to remove duplicates</li>
<li>Can count hex_row_hash then filter where hex_row_hash &gt; 1 to find which rows are duplicates</li>
<li>Notes from <a href="https://towardsdatascience.com/how-to-build-a-unique-md5-row-hash-using-sql-in-bigquery-plus-a-few-related-things-e6f71820f38b">link</a></li>
<li>Description
<ul>
<li>flowfunctions is the project name</li>
<li>examples is a directory (?)</li>
<li>zoo_elephants is the dataset</li>
</ul></li>
<li>Steps
<ul>
<li>TO_JSON_STRING - creates column with json string for each row</li>
<li>MD5 hashes that string</li>
<li>TO_HEX makes it alpha-numeric and gets rid of the symbols in the hash
<ul>
<li>Easier to deal with in BigQuery</li>
<li>Assume this is still unique (?)</li>
</ul></li>
</ul></li>
<li>Note: By adding “true” value, <code>TO_JSON_STRING(inbound_zoo_elephants, true)</code> , TO_JSON_STRING adds line breaks to the json string for easier readability.</li>
<li>Hashing function options
<ul>
<li><a href="https://cloud.google.com/bigquery/docs/reference/standard-sql/hash_functions#md5">MD5</a> -&nbsp; shortest one (16 characters), fine for this use case
<ul>
<li><a href="https://en.wikipedia.org/wiki/MD5">cryptographically broken</a>, returns 16 characters and suffices for our use-case. Other options are</li>
</ul></li>
<li><a href="https://cloud.google.com/bigquery/docs/reference/standard-sql/hash_functions#farm_fingerprint">FARM_FINGERPRINT</a> - returns a signed integer of variable length</li>
<li><a href="https://cloud.google.com/bigquery/docs/reference/standard-sql/hash_functions#sha1">SHA1</a>, <a href="https://cloud.google.com/bigquery/docs/reference/standard-sql/hash_functions#sha256">SHA256</a> and <a href="https://cloud.google.com/bigquery/docs/reference/standard-sql/hash_functions#sha512">SHA512</a>, which return 20, 32 and 64 bytes respectively and are more secure for cryptographic use cases.</li>
</ul></li>
<li>Nested Data
<ul>
<li>Recursive CTE
<ul>
<li>Recursive CTEs are used primarily when you want to query hierarchical data or graphs. This could be a company’s organizational structure, a family tree, a restaurant menu, or various routes between cities</li>
<li>Also see
<ul>
<li><a href="https://learnsql.com/blog/sql-recursive-cte/">What Is a Recursive CTE in SQL?</a>
<ul>
<li>Tutorial, 3 examples, and links to other articles</li>
</ul></li>
</ul></li>
<li>Syntax</li>
</ul></li>
</ul></li>
</ul>
<pre><code>WITH RECURSIVE cte_name AS (
&nbsp; &nbsp; cte_query_definition (the anchor member)
&nbsp; &nbsp; UNION ALL
&nbsp; &nbsp; cte_query_definition (the recursive member)
)
SELECT *
FROM&nbsp; cte_name;</code></pre>
<ul>
<li>Example: postgres</li>
</ul>
<pre><code>WITH RECURSIVE category_tree(id, name, parent_id, depth, path) AS (
&nbsp; SELECT id, name, parent_id, 1, ARRAY[id]
&nbsp; FROM categories
&nbsp; WHERE parent_id IS NULL
&nbsp; UNION ALL
&nbsp; SELECT categories.id, categories.name, categories.parent_id, category_tree.depth + 1, path || categories.id
&nbsp; FROM categories
&nbsp; JOIN category_tree ON categories.parent_id = category_tree.id
)
SELECT id, name, parent_id, depth, path
FROM category_tree;</code></pre>
<ul>
<li>CTE (<code>WITH</code>) + <code>RECURSIVE</code> says it’s a recursive query.</li>
<li><code>UNION ALL</code>combines the results of both statements.
<ul>
<li>Example is defined by 2 Select statements
<ul>
<li>Anchor Member: First SELECT statement selects the root nodes of the category tree (nodes with no parent)
<ul>
<li>Root node is indicated by “parent_id” = NULL</li>
</ul></li>
<li>Recursive member: Second SELECT statement selects the child nodes recursively</li>
</ul></li>
<li>Also see Arrays for further examples of the use of <code>UNION ALL</code></li>
</ul></li>
<li>The “depth” column is used to keep track of the depth of each category node in the tree.
<ul>
<li>“1” in the first statement</li>
<li>“category_tree.depth + 1” in the second statement
<ul>
<li>With every recursion, the CTE will add 1 to the previous depth level, and it will do that until it reaches the end of the hierarchy</li>
</ul></li>
</ul></li>
<li>The “path” column is an array that stores the path from the root to the current node.
<ul>
<li>“ARRAY[id]” in the first statement</li>
<li>“path || categories.id” in the second statement
<ul>
<li>“||” concatenates “path” and “id” columns (See Strings)</li>
</ul></li>
</ul></li>
<li>Preprocess Time Series with 4 Lags (<a href="https://towardsdatascience.com/concurrently-train-multiple-time-series-models-over-spark-with-xgboost-c6d5ec4a6430">article</a>)</li>
</ul>
<pre><code>WITH top_customers as (
&nbsp; &nbsp; --- select the customter ids you want to track
),
transactions as (
&nbsp; &nbsp; SELECT&nbsp;
&nbsp; &nbsp; &nbsp; cust_id,&nbsp;
&nbsp; &nbsp; &nbsp; dt,&nbsp;
&nbsp; &nbsp; &nbsp; date_trunc('hour', cast(event_time as timestamp)) as event_hour,&nbsp;
&nbsp; &nbsp; &nbsp; count(*) as transactions
&nbsp; &nbsp; FROM ourTable
&nbsp; &nbsp; WHERE
&nbsp; &nbsp; &nbsp; &nbsp; dt between cast(date_add('day', -7, current_date) as varchar)&nbsp;
&nbsp; &nbsp; &nbsp; &nbsp; and cast(current_date as varchar)
&nbsp; &nbsp; GROUP BY 1,2,3 Order By event_hour asc
)

SELECT transactions.cust_id,
&nbsp; &nbsp; &nbsp; transactions.event_hour,
&nbsp; &nbsp; &nbsp; day_of_week(transactions.event_hour) day_of_week,
&nbsp; &nbsp; &nbsp; &nbsp; hour(transactions.event_hour) hour_of_day,
&nbsp; &nbsp; &nbsp; &nbsp; transactions.transactions as transactions,
&nbsp; &nbsp; &nbsp; &nbsp; LAG(transactions,1) OVER&nbsp;
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; (PARTITION BY transactions.cust_id ORDER BY event_hour) AS lag1,
&nbsp; &nbsp; &nbsp; &nbsp; LAG(transactions,2) OVER&nbsp;
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; (PARTITION BY transactions.cust_id ORDER BY event_hour) AS lag2,
&nbsp; &nbsp; &nbsp; &nbsp; LAG(transactions,3) OVER&nbsp;
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; (PARTITION BY transactions.cust_id ORDER BY event_hour) AS lag3,
&nbsp; &nbsp; &nbsp; &nbsp; LAG(transactions,4) OVER&nbsp;
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; (PARTITION BY transactions.cust_id ORDER BY event_hour) AS lag4
FROM transactions&nbsp;
&nbsp; &nbsp; join top_customers&nbsp;
&nbsp; &nbsp; &nbsp; on transactions.cust_id = top_customers.cust_id

/* output */
"cust_id", "event_hour", "day_of_week", "hour_of_day", "transactions", "lag1", "lag2", "lag3", "lag4"
"Customer-123","2023-01-14 00:00:00.000","6","0","4093",,,,,,
"Customer-123","2023-01-14 01:00:00.000","6","1","4628","4093",,,,,
"Customer-123","2023-01-14 02:00:00.000","6","2","5138","4628","4093",,,,
"Customer-123","2023-01-14 03:00:00.000","6","3","5412","5138","4628","4093",,,
"Customer-123","2023-01-14 04:00:00.000","6","4","5645","5412","5138","4628","4093",
"Customer-123","2023-01-14 05:00:00.000","6","5","5676","5645","5412","5138","4628",
"Customer-123","2023-01-14 06:00:00.000","6","6","6045","5676","5645","5412","5138",
"Customer-123","2023-01-14 07:00:00.000","6","7","6558","6045","5676","5645","5412",</code></pre>
<ul>
<li>Dataset contains number of transactions made per customer per hour.</li>
<li>2 WITH clauses: the first just extracts a list of customers we are interested in. Here you can add any condition that is supposed to filter in or out specific customers (perhaps you want to filter new customers or only include customers with sufficient traffic). The second WITH clause simply creates the first data set — Dataset A, which pulls a week of data for these customers and selects the customer id, date, hour, and number of transactions.</li>
<li>Finally, the last and most important SELECT clause generates Dataset B, by using SQL lag() function on each row in order to capture the number of transactions in each of the hours that preceded the hour in the row.</li>
</ul>
</section>
<section id="sec-sql-tools" class="level2 unnumbered">
<h2 class="unnumbered anchored" data-anchor-id="sec-sql-tools">Tools</h2>
<ul>
<li><span style="color: goldenrod">{{</span><a href="https://pypi.org/project/sqlglot/" style="color: goldenrod">sqlglot</a><span style="color: goldenrod">}}</span> - no dependency Python SQL parser, transpiler, optimizer, and engine
<ul>
<li>Format SQL or translate between nearly twenty different SQL dialects.
<ul>
<li>It doesn’t just transpile active SQL code, too. Moves comments from one dialect to another.</li>
</ul></li>
<li>The parser itself can be customized</li>
<li>Can also help you analyze queries, traverse parsed expression trees, and incrementally (and, programmatically) build SQL queries.</li>
<li><a href="https://github.com/tobymao/sqlglot/blob/main/sqlglot/optimizer/optimizer.py">support for optimizing SQL queries</a>, and performing <a href="https://github.com/tobymao/sqlglot/blob/main/posts/sql_diff.md">semantic diffs</a>.</li>
<li>Can be used to <a href="https://github.com/tobymao/sqlglot#sql-execution">unit test queries</a> through mocks based on Python dictionaries.</li>
<li>Example: translate duckdb to hive</li>
</ul></li>
</ul>
<pre><code>import sqlglot
sqlglot.transpile(
&nbsp; "SELECT EPOCH_MS(1618088028295)",&nbsp;
&nbsp; read = "duckdb",&nbsp;
&nbsp; write = "hive"
)[0]
---
'SELECT FROM_UNIXTIME(1618088028295 / 1000)'</code></pre>


</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
<nav class="page-navigation">
  <div class="nav-page nav-page-previous">
      <a href="../qmd/spreadsheets.html" class="pagination-link">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text"><span class="chapter-number">167</span>&nbsp; <span class="chapter-title">Spreadsheets</span></span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
      <a href="../qmd/stochastic-processes.html" class="pagination-link">
        <span class="nav-page-text"><span class="chapter-number">168</span>&nbsp; <span class="chapter-title">Stochastic Processes</span></span> <i class="bi bi-arrow-right-short"></i>
      </a>
  </div>
</nav>
</div> <!-- /content -->



</body></html>