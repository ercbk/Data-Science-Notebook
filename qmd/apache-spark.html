<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.5.57">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>Spark – Data Science</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../site_libs/clipboard/clipboard.min.js"></script>
<script src="../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../site_libs/quarto-search/fuse.min.js"></script>
<script src="../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../">
<link href="../qmd/apis.html" rel="next">
<link href="../qmd/apache-arrow.html" rel="prev">
<link href="../images/ds-favicon-32.png" rel="icon" type="image/png">
<script src="../site_libs/quarto-html/quarto.js"></script>
<script src="../site_libs/quarto-html/popper.min.js"></script>
<script src="../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../site_libs/quarto-html/anchor.min.js"></script>
<link href="../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script src="../site_libs/quarto-contrib/glightbox/glightbox.min.js"></script>
<link href="../site_libs/quarto-contrib/glightbox/glightbox.min.css" rel="stylesheet">
<link href="../site_libs/quarto-contrib/glightbox/lightbox.css" rel="stylesheet">
<script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>

  <script src="https://cdnjs.cloudflare.com/polyfill/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

<script type="text/javascript">
const typesetMath = (el) => {
  if (window.MathJax) {
    // MathJax Typeset
    window.MathJax.typeset([el]);
  } else if (window.katex) {
    // KaTeX Render
    var mathElements = el.getElementsByClassName("math");
    var macros = [];
    for (var i = 0; i < mathElements.length; i++) {
      var texText = mathElements[i].firstChild;
      if (mathElements[i].tagName == "SPAN") {
        window.katex.render(texText.data, mathElements[i], {
          displayMode: mathElements[i].classList.contains('display'),
          throwOnError: false,
          macros: macros,
          fleqn: false
        });
      }
    }
  }
}
window.Quarto = {
  typesetMath
};
</script>

<link rel="stylesheet" href="../styles.css">
</head>

<body class="nav-sidebar floating">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" role="button" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
        <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="../qmd/apache-arrow.html">Apache</a></li><li class="breadcrumb-item"><a href="../qmd/apache-spark.html">Spark</a></li></ol></nav>
        <a class="flex-grow-1" role="navigation" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
        </a>
      <button type="button" class="btn quarto-search-button" aria-label="Search" onclick="window.quartoOpenSearch();">
        <i class="bi bi-search"></i>
      </button>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal quarto-sidebar-collapse-item sidebar-navigation floating overflow-auto">
    <div class="pt-lg-2 mt-2 text-left sidebar-header">
    <div class="sidebar-title mb-0 py-0">
      <a href="../">Data Science</a> 
        <div class="sidebar-tools-main tools-wide">
    <a href="https://ericbook.netlify.app/" title="" class="quarto-navigation-tool px-1" aria-label=""><i class="bi bi-house"></i></a>
    <a href="https://ercbk.github.io/Domain-Knowledge-Notebook/" title="" class="quarto-navigation-tool px-1" aria-label=""><i class="bi bi-lightbulb"></i></a>
    <a href="https://ercbk.github.io/Statistical-Rethinking-Notebook/" title="" class="quarto-navigation-tool px-1" aria-label=""><i class="bi bi-book"></i></a>
    <a href="https://github.com/ercbk/Data-Science-Notebook" title="Source Code" class="quarto-navigation-tool px-1" aria-label="Source Code"><i class="bi bi-github"></i></a>
  <a href="" class="quarto-reader-toggle quarto-navigation-tool px-1" onclick="window.quartoToggleReader(); return false;" title="Toggle reader mode">
  <div class="quarto-reader-toggle-btn">
  <i class="bi"></i>
  </div>
</a>
</div>
    </div>
      </div>
        <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Search"></div>
        </div>
        </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Preface</span></a>
  </div>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" role="navigation" aria-expanded="false">
 <span class="menu-text">Algorithms</span></a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" role="navigation" aria-expanded="false" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-1" class="collapse list-unstyled sidebar-section depth1 ">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../qmd/algorithms-learn-to-rank.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Learn-to-Rank</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../qmd/algorithms-marketing.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Marketing</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../qmd/algorithms-ml.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">1</span>&nbsp; <span class="chapter-title">ML</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../qmd/algorithms-product.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">Algorithms, Product</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../qmd/algorithms-recommendation.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Recommendation</span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../qmd/anomaly-detection.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Anomaly Detection</span></a>
  </div>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" role="navigation" aria-expanded="true">
 <span class="menu-text">Apache</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-2" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../qmd/apache-arrow.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Arrow</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../qmd/apache-spark.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text">Spark</span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../qmd/apis.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">APIs</span></a>
  </div>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" role="navigation" aria-expanded="false">
 <span class="menu-text">Association</span></a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" role="navigation" aria-expanded="false" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-3" class="collapse list-unstyled sidebar-section depth1 ">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../qmd/association-copulas.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">Copulas</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../qmd/association-general.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">General</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../qmd/association-time-series.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Time Series</span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../qmd/aws.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">AWS</span></a>
  </div>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-4" role="navigation" aria-expanded="false">
 <span class="menu-text">Bayes</span></a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-4" role="navigation" aria-expanded="false" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-4" class="collapse list-unstyled sidebar-section depth1 ">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../qmd/bayes-priors.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Priors</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../qmd/bayes-reporting.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Reporting</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../qmd/bayes-troubleshooting-hmc.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Troubleshooting HMC</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../qmd/bayes-workflow.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Workflow</span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../qmd/big-data.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Big Data</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../qmd/business-plots.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Business Plots</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../qmd/causal-inference.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Causal Inference</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../qmd/classification.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Classification</span></a>
  </div>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-5" role="navigation" aria-expanded="false">
 <span class="menu-text">CLI</span></a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-5" role="navigation" aria-expanded="false" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-5" class="collapse list-unstyled sidebar-section depth1 ">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../qmd/cli-general.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">General</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../qmd/cli-linux.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Linux</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../qmd/cli-windows.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Windows</span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../qmd/cloud-services.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Cloud Services</span></a>
  </div>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-6" role="navigation" aria-expanded="false">
 <span class="menu-text">Clustering</span></a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-6" role="navigation" aria-expanded="false" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-6" class="collapse list-unstyled sidebar-section depth1 ">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../qmd/clustering-time-series.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Time Series</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../qmd/clustering-general.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">General</span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-7" role="navigation" aria-expanded="false">
 <span class="menu-text">Code</span></a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-7" role="navigation" aria-expanded="false" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-7" class="collapse list-unstyled sidebar-section depth1 ">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../qmd/code-debug.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Debugging</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../qmd/code-optimization.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Optimization</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../qmd/code-review.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Review</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../qmd/code-style-guide.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Style Guide</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../qmd/code-testing.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Testing</span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../qmd/confidence-and-prediction-intervals.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Confidence &amp; Prediction Intervals</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../qmd/cross-validation.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Cross-Validation</span></a>
  </div>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-8" role="navigation" aria-expanded="false">
 <span class="menu-text">CSS</span></a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-8" role="navigation" aria-expanded="false" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-8" class="collapse list-unstyled sidebar-section depth1 ">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../qmd/css-general.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">General</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../qmd/css-recipes.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Recipes</span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-9" role="navigation" aria-expanded="false">
 <span class="menu-text">Databases</span></a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-9" role="navigation" aria-expanded="false" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-9" class="collapse list-unstyled sidebar-section depth1 ">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../qmd/db-dbt.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">dbt</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../qmd/db-duckdb.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">DuckDB</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../qmd/db-engineering.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Engineering</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../qmd/db-feature-stores.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Feature Stores</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../qmd/db-lakes.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Lakes</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../qmd/db-modeling.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Modeling</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../qmd/db-normalization.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Normalization</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../qmd/db-nosql.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">NoSQL</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../qmd/db-other.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Other</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../qmd/db-postgres.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Postgres</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../qmd/db-relational.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Relational</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../qmd/db-vector.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Vector Databases</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../qmd/db-warehouses.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Warehouses</span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../qmd/decision-intelligence.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Decision Intelligence</span></a>
  </div>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-10" role="navigation" aria-expanded="false">
 <span class="menu-text">Diagnostics</span></a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-10" role="navigation" aria-expanded="false" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-10" class="collapse list-unstyled sidebar-section depth1 ">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../qmd/diagnostics-bayes.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Bayes</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../qmd/diagnostics-classification.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Classification</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../qmd/diagnostics-clustering.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Clustering</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../qmd/diagnostics-cv.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">CV</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../qmd/diagnostics-dl.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">DL</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../qmd/diagnostics-forecasting.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Forecasting</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../qmd/diagnostics-glm.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">GLM</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../qmd/diagnostics-mixed-effects.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Mixed Effects</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../qmd/diagnostics-model-agnostic.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Model Agnostic</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../qmd/diagnostics-nlp.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">NLP</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../qmd/diagnostics-probabilistic.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Probabilistic</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../qmd/diagnostics-regression.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Regression</span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../qmd/distributions.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Distributions</span></a>
  </div>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-11" role="navigation" aria-expanded="false">
 <span class="menu-text">Deep Learning</span></a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-11" role="navigation" aria-expanded="false" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-11" class="collapse list-unstyled sidebar-section depth1 ">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../qmd/dl-audio.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Audio</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../qmd/dl-general.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">General</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../qmd/dl-graph.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Graph</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../qmd/dl-image.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Image</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../qmd/dl-tabular.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Tabular</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../qmd/dl-training.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Training</span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-12" role="navigation" aria-expanded="false">
 <span class="menu-text">Docker</span></a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-12" role="navigation" aria-expanded="false" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-12" class="collapse list-unstyled sidebar-section depth1 ">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../qmd/docker-aws.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">AWS</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../qmd/docker-fundamentals.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">Docker, Fundamentals</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../qmd/docker-misc.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Misc</span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-13" role="navigation" aria-expanded="false">
 <span class="menu-text">Econometrics</span></a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-13" role="navigation" aria-expanded="false" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-13" class="collapse list-unstyled sidebar-section depth1 ">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../qmd/econometrics-discrete-choice-models.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Discrete Choice Models</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../qmd/econometrics-fixed-effects.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Fixed Effects</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../qmd/econometrics-general.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">General</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../qmd/econometrics-psa.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Propensity Score Analysis</span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-14" role="navigation" aria-expanded="false">
 <span class="menu-text">EDA</span></a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-14" role="navigation" aria-expanded="false" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-14" class="collapse list-unstyled sidebar-section depth1 ">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../qmd/eda-geospatial.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Geospatial</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../qmd/eda-general.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">General</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../qmd/eda-multilevel-longitudinal.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Multilevel, Longitudinal</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../qmd/eda-text.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Text</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../qmd/eda-time-series.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Time Series</span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-15" role="navigation" aria-expanded="false">
 <span class="menu-text">Experiments</span></a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-15" role="navigation" aria-expanded="false" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-15" class="collapse list-unstyled sidebar-section depth1 ">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../qmd/experiments-a_b-testing.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">A/B Testing</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../qmd/experiments-analysis.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Analysis</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../qmd/experiments-designs.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Designs</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../qmd/experiments-planning.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Planning</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../qmd/experiments-rct.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">RCT</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../qmd/experiments-stepped-wedge-cluster-design.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Stepped Wedge Cluster Design</span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../qmd/extreme-value-theory-(evt).html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">5</span>&nbsp; <span class="chapter-title">Extreme Value Theory</span></span></a>
  </div>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-16" role="navigation" aria-expanded="false">
 <span class="menu-text">Feature Engineering</span></a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-16" role="navigation" aria-expanded="false" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-16" class="collapse list-unstyled sidebar-section depth1 ">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../qmd/feature-engineering-embeddings.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Embeddings</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../qmd/feature-engineering-general.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">General</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../qmd/feature-engineering-geospatial.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Geospatial</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../qmd/feature-engineering-time-series.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Time Series</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../qmd/feature-engineering-splines.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Splines</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../qmd/feature-engineering-tokenization.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Tokenization</span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-17" role="navigation" aria-expanded="false">
 <span class="menu-text">Feature Reduction</span></a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-17" role="navigation" aria-expanded="false" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-17" class="collapse list-unstyled sidebar-section depth1 ">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../qmd/feature-reduction-general.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">General</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../qmd/feature-reduction-time-series.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Time Series</span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../qmd/feature-selection.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Feature Selection</span></a>
  </div>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-18" role="navigation" aria-expanded="false">
 <span class="menu-text">Forecasting</span></a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-18" role="navigation" aria-expanded="false" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-18" class="collapse list-unstyled sidebar-section depth1 ">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../qmd/forecasting-decomposition.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Decomposition</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../qmd/forecasting-dl.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Deep Learning</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../qmd/forecasting-ensembling.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Ensembling</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../qmd/forecasting-hierarchical_grouped.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Hierarchical/Grouped</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../qmd/forecasting-ml.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">ML</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../qmd/forecasting-multivariate.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Multivariate</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../qmd/forecasting-nonlinear.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Nonlinear</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../qmd/forecasting-statistical.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Statistical</span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../qmd/generalized-additive-models-(gam).html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Generalized Additive Models</span></a>
  </div>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-19" role="navigation" aria-expanded="false">
 <span class="menu-text">Geospatial</span></a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-19" role="navigation" aria-expanded="false" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-19" class="collapse list-unstyled sidebar-section depth1 ">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../qmd/geospatial-analysis.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Analysis</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../qmd/geospatial-general.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">General</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../qmd/geospatial-remote-sensing.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Remote Sensing</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../qmd/geospatial-processing.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Preprocessing</span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-20" role="navigation" aria-expanded="false">
 <span class="menu-text">Git</span></a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-20" role="navigation" aria-expanded="false" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-20" class="collapse list-unstyled sidebar-section depth1 ">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../qmd/git-general.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">General</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../qmd/git-github-actions.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Github Actions</span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../qmd/glossary-ds-terms.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Glossary: DS terms</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../qmd/gnu-make.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">GNU Make</span></a>
  </div>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-21" role="navigation" aria-expanded="false">
 <span class="menu-text">Google</span></a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-21" role="navigation" aria-expanded="false" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-21" class="collapse list-unstyled sidebar-section depth1 ">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../qmd/google-analytics-analysis.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Analytics, Analysis</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../qmd/google-analytics-reports.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Analytics, Reports</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../qmd/google-bigquery.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">BigQuery</span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../qmd/html.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">HTML</span></a>
  </div>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-22" role="navigation" aria-expanded="false">
 <span class="menu-text">IDEs</span></a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-22" role="navigation" aria-expanded="false" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-22" class="collapse list-unstyled sidebar-section depth1 ">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../qmd/ide-jupyter.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Jupyter</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../qmd/ide-rstudio.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">RStudio</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../qmd/ide-vscode.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">VS Code</span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../qmd/information-theory.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Information Theory</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../qmd/inkscape.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Inkscape</span></a>
  </div>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-23" role="navigation" aria-expanded="false">
 <span class="menu-text">Job</span></a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-23" role="navigation" aria-expanded="false" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-23" class="collapse list-unstyled sidebar-section depth1 ">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../qmd/job-management-leadership.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Management / Leadership</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../qmd/job-on-the-job.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">On the job</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../qmd/job-organizational-and-team-development.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Organizational and Team Development</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../qmd/job-reports.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Reports</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../qmd/job-search.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Search</span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-24" role="navigation" aria-expanded="false">
 <span class="menu-text">Javascript</span></a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-24" role="navigation" aria-expanded="false" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-24" class="collapse list-unstyled sidebar-section depth1 ">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../qmd/js-general.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">General</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../qmd/js-observable.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Observable</span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../qmd/json.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">JSON</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../qmd/kubernetes.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Kubernetes</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../qmd/latex.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">LaTeX</span></a>
  </div>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-25" role="navigation" aria-expanded="false">
 <span class="menu-text">LLMs</span></a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-25" role="navigation" aria-expanded="false" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-25" class="collapse list-unstyled sidebar-section depth1 ">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../qmd/llms-agent-chains.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Agent Chains</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../qmd/llms-fine-tuning.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Fine Tuning</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../qmd/llms-general.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">General</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../qmd/llms-prompt-engineering.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Prompt Engineering</span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../qmd/loss-functions.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">6</span>&nbsp; <span class="chapter-title">Loss Functions</span></span></a>
  </div>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-26" role="navigation" aria-expanded="false">
 <span class="menu-text">Mathematics</span></a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-26" role="navigation" aria-expanded="false" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-26" class="collapse list-unstyled sidebar-section depth1 ">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../qmd/mathematics-linear-algebra.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Linear Algebra</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../qmd/mathematics-glossary.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Glossary</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../qmd/mathematics-notation.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Notation</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../qmd/mathematics-probability.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">7</span>&nbsp; <span class="chapter-title">Probability</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../qmd/mathematics-statistics.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Statistics</span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../qmd/misc.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Misc</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../qmd/missingness.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Missingness</span></a>
  </div>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-27" role="navigation" aria-expanded="false">
 <span class="menu-text">Mixed Effects</span></a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-27" role="navigation" aria-expanded="false" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-27" class="collapse list-unstyled sidebar-section depth1 ">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../qmd/mixed-effects-bmlr.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">BMLR</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../qmd/mixed-effects-general.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">General</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../qmd/mixed-effects-glmm.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">GLMM</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../qmd/mixed-effects-residual-covar.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Residual Covariance Structures</span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../qmd/mlops.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">MLOps</span></a>
  </div>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-28" role="navigation" aria-expanded="false">
 <span class="menu-text">Model Building</span></a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-28" role="navigation" aria-expanded="false" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-28" class="collapse list-unstyled sidebar-section depth1 ">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../qmd/model-building-brms.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">brms</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../qmd/model-building-concepts.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Concepts</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../qmd/model-building-ensembling.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Ensembling</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../qmd/model-building-h2o-automl.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">H2O AutoML</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../qmd/model-building-modeltime.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">modeltime</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../qmd/model-building-rstanarm.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">rstanarm</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../qmd/model-building-sklearn.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">sklearn</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../qmd/model-building-tidymodels.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">tidymodels</span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-29" role="navigation" aria-expanded="false">
 <span class="menu-text">Networks</span></a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-29" role="navigation" aria-expanded="false" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-29" class="collapse list-unstyled sidebar-section depth1 ">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../qmd/networks-analysis.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Analysis</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../qmd/networks-knowledge-graphs.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Knowledge Graphs</span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-30" role="navigation" aria-expanded="false">
 <span class="menu-text">NLP</span></a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-30" role="navigation" aria-expanded="false" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-30" class="collapse list-unstyled sidebar-section depth1 ">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../qmd/nlp-general.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">General</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../qmd/nlp-sentiment.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Sentiment</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../qmd/nlp-summarization-extraction.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Summarization and Extraction</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../qmd/nlp-topic.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Topic</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../qmd/nlp-transformers.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Transformers</span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../qmd/optimization-equation-systems.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Optimization</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../qmd/outliers.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Outliers</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../qmd/package-development.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Package Development</span></a>
  </div>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-31" role="navigation" aria-expanded="false">
 <span class="menu-text">Post-Hoc Analysis</span></a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-31" role="navigation" aria-expanded="false" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-31" class="collapse list-unstyled sidebar-section depth1 ">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../qmd/post-hoc-analysis-ab.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">A/B</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../qmd/post-hoc-analysis-anova.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">ANOVA</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../qmd/post-hoc-analysis-emmeans.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">emmeans</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../qmd/post-hoc-analysis-general.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">General</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../qmd/post-hoc-analysis-multilevel.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Multilevel</span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../qmd/privacy.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Privacy/Security</span></a>
  </div>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-32" role="navigation" aria-expanded="false">
 <span class="menu-text">Production</span></a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-32" role="navigation" aria-expanded="false" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-32" class="collapse list-unstyled sidebar-section depth1 ">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../qmd/production-data-validation.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Data Validation</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../qmd/production-deployment.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Deployment</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../qmd/production-development.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Development</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../qmd/production-ml-monitoring.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">8</span>&nbsp; <span class="chapter-title">ML Monitoring</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../qmd/production-testing.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Testing</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../qmd/production-tools.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">9</span>&nbsp; <span class="chapter-title">Tools</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-33" role="navigation" aria-expanded="false">
 <span class="menu-text">Projects</span></a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-33" role="navigation" aria-expanded="false" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-33" class="collapse list-unstyled sidebar-section depth1 ">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../qmd/project-analyses.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Analyses</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../qmd/project-development.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Development</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../qmd/project-management.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Management</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../qmd/project-planning.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Planning</span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-34" role="navigation" aria-expanded="false">
 <span class="menu-text">Python</span></a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-34" role="navigation" aria-expanded="false" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-34" class="collapse list-unstyled sidebar-section depth1 ">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../qmd/python-classes.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Classes</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../qmd/python-general.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">General</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../qmd/python-misc.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Misc</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../qmd/python-numpy.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Numpy</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../qmd/python-pandas-recipes.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Pandas, Recipes</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../qmd/python-pandas.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Pandas</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../qmd/python-polars.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Polars</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../qmd/python-reticulate.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">reticulate</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../qmd/python-snippets.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Snippets</span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../qmd/quarto-rmarkdown.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Quarto</span></a>
  </div>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-35" role="navigation" aria-expanded="false">
 <span class="menu-text">R</span></a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-35" role="navigation" aria-expanded="false" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-35" class="collapse list-unstyled sidebar-section depth1 ">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../qmd/r-base-r.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Base R</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../qmd/r-data-table.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">data.table</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../qmd/r-polars.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Polars</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../qmd/r-snippets.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Snippets</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../qmd/r-tidyverse.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Tidyverse</span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../qmd/regex.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Regex</span></a>
  </div>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-36" role="navigation" aria-expanded="false">
 <span class="menu-text">Regression</span></a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-36" role="navigation" aria-expanded="false" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-36" class="collapse list-unstyled sidebar-section depth1 ">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../qmd/regression-discrete.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Discrete</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../qmd/regression-interactions.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Interactions</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../qmd/regression-linear.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Linear</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../qmd/regression-logistic.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Logistic</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../qmd/regression-multinomial.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Multinomial</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../qmd/regression-multivariate.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Multivariate</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../qmd/regression-ordinal.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Ordinal</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../qmd/regression-other.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Other</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../qmd/regression-quantile.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Quantile</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../qmd/regression-regularized.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Regularized</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../qmd/regression-survival.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Survival</span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../qmd/renv.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Renv</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../qmd/scraping.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Scraping</span></a>
  </div>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-37" role="navigation" aria-expanded="false">
 <span class="menu-text">Shiny</span></a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-37" role="navigation" aria-expanded="false" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-37" class="collapse list-unstyled sidebar-section depth1 ">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../qmd/shiny-general.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">General</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../qmd/shiny-hosting.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Hosting</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../qmd/shiny-mobile.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Mobile</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../qmd/shiny-modules.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Modules</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../qmd/shiny-production.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Production</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../qmd/shiny-python.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Python</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../qmd/shiny-ui.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">UI</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../qmd/shiny-ui-examples.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">UI Examples</span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../qmd/simulation-data.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Simulation, Data</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../qmd/spreadsheets.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Spreadsheets</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../qmd/sql.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">SQL</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../qmd/stochastic-processes.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">10</span>&nbsp; <span class="chapter-title">Stochastic Processes</span></span></a>
  </div>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-38" role="navigation" aria-expanded="false">
 <span class="menu-text">Surveys</span></a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-38" role="navigation" aria-expanded="false" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-38" class="collapse list-unstyled sidebar-section depth1 ">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../qmd/surveys-analysis.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">11</span>&nbsp; <span class="chapter-title">Analysis</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../qmd/surveys-census-data.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Census Data</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../qmd/surveys-design.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Design</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../qmd/surveys-sampling-methods.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Sampling Methods</span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../qmd/teaching.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Teaching</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../qmd/tidyeval.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Tidyeval</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../qmd/tuning.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Tuning</span></a>
  </div>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-39" role="navigation" aria-expanded="false">
 <span class="menu-text">Visualization</span></a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-39" role="navigation" aria-expanded="false" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-39" class="collapse list-unstyled sidebar-section depth1 ">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../qmd/visualization-general.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">General</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../qmd/visualization-ggplot2.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">ggplot2</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../qmd/visualization-gtable.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">gtable</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../qmd/visualization-diagrams.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Diagrams</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../qmd/visualization-mixed-effects.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Mixed Effects</span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-40" role="navigation" aria-expanded="false">
 <span class="menu-text">Web</span></a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-40" role="navigation" aria-expanded="false" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-40" class="collapse list-unstyled sidebar-section depth1 ">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../qmd/web-design.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Web Design</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../qmd/web-servers.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Server</span></a>
  </div>
</li>
      </ul>
  </li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" class="quarto-sidebar-collapse-item" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Table of contents</h2>
   
  <ul>
  <li><a href="#sec-apache-spark-misc" id="toc-sec-apache-spark-misc" class="nav-link active" data-scroll-target="#sec-apache-spark-misc">Misc</a></li>
  <li><a href="#sec-apache-spark-procov" id="toc-sec-apache-spark-procov" class="nav-link" data-scroll-target="#sec-apache-spark-procov">Process Overview</a></li>
  <li><a href="#sec-apache-spark-setup" id="toc-sec-apache-spark-setup" class="nav-link" data-scroll-target="#sec-apache-spark-setup">Set-Up</a></li>
  <li><a href="#sec-apache-spark-errors" id="toc-sec-apache-spark-errors" class="nav-link" data-scroll-target="#sec-apache-spark-errors">Errors</a>
  <ul>
  <li><a href="#sec-apache-spark-errors-datskew" id="toc-sec-apache-spark-errors-datskew" class="nav-link" data-scroll-target="#sec-apache-spark-errors-datskew">Data Skew</a></li>
  <li><a href="#sec-apache-spark-errors-datsp" id="toc-sec-apache-spark-errors-datsp" class="nav-link" data-scroll-target="#sec-apache-spark-errors-datsp">Disk Spill</a></li>
  </ul></li>
  <li><a href="#sec-apache-spark-opt" id="toc-sec-apache-spark-opt" class="nav-link" data-scroll-target="#sec-apache-spark-opt">Optimization</a>
  <ul>
  <li><a href="#sec-apache-spark-opt-config" id="toc-sec-apache-spark-opt-config" class="nav-link" data-scroll-target="#sec-apache-spark-opt-config">Configuration</a></li>
  <li><a href="#sec-apache-spark-opt-part" id="toc-sec-apache-spark-opt-part" class="nav-link" data-scroll-target="#sec-apache-spark-opt-part">Partitioning</a></li>
  <li><a href="#sec-apache-spark-opt-cach" id="toc-sec-apache-spark-opt-cach" class="nav-link" data-scroll-target="#sec-apache-spark-opt-cach">Caching</a></li>
  <li><a href="#sec-apache-spark-opt-shuf" id="toc-sec-apache-spark-opt-shuf" class="nav-link" data-scroll-target="#sec-apache-spark-opt-shuf">Shuffling</a>
  <ul>
  <li><a href="#sec-apache-spark-opt-shuf-brjoin" id="toc-sec-apache-spark-opt-shuf-brjoin" class="nav-link" data-scroll-target="#sec-apache-spark-opt-shuf-brjoin">Broadcast Joins</a></li>
  <li><a href="#sec-apache-spark-opt-shuf-iterbrjoin" id="toc-sec-apache-spark-opt-shuf-iterbrjoin" class="nav-link" data-scroll-target="#sec-apache-spark-opt-shuf-iterbrjoin">Iterative Broadcast Joins</a></li>
  </ul></li>
  <li><a href="#sec-apache-spark-opt-serial" id="toc-sec-apache-spark-opt-serial" class="nav-link" data-scroll-target="#sec-apache-spark-opt-serial">Serialization</a></li>
  <li><a href="#sec-apache-spark-opt-loop" id="toc-sec-apache-spark-opt-loop" class="nav-link" data-scroll-target="#sec-apache-spark-opt-loop">Avoid Loops</a></li>
  <li><a href="#sec-apache-spark-opt-unop" id="toc-sec-apache-spark-opt-unop" class="nav-link" data-scroll-target="#sec-apache-spark-opt-unop">Union Operator</a></li>
  </ul></li>
  <li><a href="#sec-apache-spark-dating" id="toc-sec-apache-spark-dating" class="nav-link" data-scroll-target="#sec-apache-spark-dating">Data Ingestion</a></li>
  <li><a href="#sec-apache-spark-func" id="toc-sec-apache-spark-func" class="nav-link" data-scroll-target="#sec-apache-spark-func">Functions</a></li>
  <li><a href="#sec-apache-spark-spsql" id="toc-sec-apache-spark-spsql" class="nav-link" data-scroll-target="#sec-apache-spark-spsql">Spark SQL</a></li>
  <li><a href="#sec-apache-spark-mod" id="toc-sec-apache-spark-mod" class="nav-link" data-scroll-target="#sec-apache-spark-mod">Modeling</a></li>
  <li><a href="#sec-apache-spark-stream" id="toc-sec-apache-spark-stream" class="nav-link" data-scroll-target="#sec-apache-spark-stream">Streaming</a></li>
  <li><a href="#sec-apache-spark-mon" id="toc-sec-apache-spark-mon" class="nav-link" data-scroll-target="#sec-apache-spark-mon">Monitoring</a></li>
  <li><a href="#sec-apache-spark-cloud" id="toc-sec-apache-spark-cloud" class="nav-link" data-scroll-target="#sec-apache-spark-cloud">Cloud</a>
  <ul>
  <li><a href="#sec-apache-spark-cloud-dbric" id="toc-sec-apache-spark-cloud-dbric" class="nav-link" data-scroll-target="#sec-apache-spark-cloud-dbric">Databricks</a></li>
  <li><a href="#sec-apache-spark-cloud-aws" id="toc-sec-apache-spark-cloud-aws" class="nav-link" data-scroll-target="#sec-apache-spark-cloud-aws">AWS</a></li>
  <li><a href="#kubernetes" id="toc-kubernetes" class="nav-link" data-scroll-target="#kubernetes">Kubernetes</a></li>
  <li><a href="#sec-apache-spark-cloud-gcp" id="toc-sec-apache-spark-cloud-gcp" class="nav-link" data-scroll-target="#sec-apache-spark-cloud-gcp">Google Cloud Platform (GCP)</a></li>
  </ul></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default"><nav class="quarto-page-breadcrumbs quarto-title-breadcrumbs d-none d-lg-block" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="../qmd/apache-arrow.html">Apache</a></li><li class="breadcrumb-item"><a href="../qmd/apache-spark.html">Spark</a></li></ol></nav>
<div class="quarto-title">
<h1 class="title"><span id="sec-apache-spark" class="quarto-section-identifier">Spark</span></h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  


</header>


<section id="sec-apache-spark-misc" class="level2 unnumbered">
<h2 class="unnumbered anchored" data-anchor-id="sec-apache-spark-misc">Misc</h2>
<ul>
<li><p>Packages</p>
<ul>
<li><span style="color: #990000">{</span><a href="https://spark.rstudio.com/" style="color: #990000">sparklyr</a><span style="color: #990000">}</span></li>
<li><span style="color: #990000">{</span><a href="https://github.com/mitre/sparklyr.nested" style="color: #990000">sparklyr.nested</a><span style="color: #990000">}</span> - Extension for nested data</li>
<li><span style="color: #990000">{</span><a href="https://spark.posit.co/packages/sparkxgb/" style="color: #990000">sparkxgb</a><span style="color: #990000">}</span> - XGBoost in Spark</li>
<li><span style="color: #990000">{</span><a href="https://github.com/r-spark/sparklyr.flint" style="color: #990000">sparklyr.flint</a><span style="color: #990000">}</span> - Time Series Computation</li>
<li><span style="color: #990000">{</span><a href="https://multidplyr.tidyverse.org/" style="color: #990000">multiplyr</a><span style="color: #990000">}</span>
<ul>
<li>Alternative option for data with &gt; 10M rows and you only have access to one machine</li>
<li>Spreads data over local cores</li>
</ul></li>
</ul></li>
<li><p>Resources</p>
<ul>
<li>2022 sparklyr <a href="https://spark.rstudio.com/images/homepage/sparklyr.pdf">cheatsheet</a></li>
<li><a href="https://therinspark.com/intro.html">Mastering Apache Spark with R</a></li>
</ul></li>
<li><p>Potential issues with transferring R code to Spark</p>
<ul>
<li><p>Can’t subset reference dataframe columns</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="co"># doesn't work</span></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a>results <span class="ot">&lt;-</span> <span class="fu">your_function</span>(products_ref<span class="sc">$</span>order_id)</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Have to collect the column variable and bring the data into the R environ</span></span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a>order_id <span class="ot">&lt;-</span> product_ref <span class="sc">%&gt;%</span></span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="fu">select</span>(order_id) <span class="sc">%&gt;%</span></span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="fu">collect</span>()</span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a>results <span class="ot">&lt;-</span> <span class="fu">your_function</span>(order_id)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div></li>
</ul></li>
<li><p>Also becomes an issue within nested functions. Might need to add collect( ) to the end of the inner function code.</p></li>
<li><p>Cluster Manager - Responsible to allocate the resources across the Spark Application. This architecture has several advantages. Each application run is isolated from other application run, because each gets its own executor process. Driver schedules its own tasks and executes it in different application run on different JVM. Downside is, that data can not be shared across different Spark applications, without being written (RDD) to a storage system, that is outside of this particular application</p></li>
<li><p><strong>Drill</strong> - A lightweight version of Spark (no ML stuff, just query). It was orphaned after Dec 19 after some company bought some other company. Can be used through <span style="color: #990000">{sergeant}</span> PKG.</p></li>
<li><p><strong>Hive</strong> - Apache Hive is a data warehouse open-source project which allows querying of large amounts of data. Like SQL it uses an easy-to-understand language called Hive QL</p></li>
<li><p><strong>Hive partitions</strong> - Used to split the larger table into several smaller parts based on one or multiple columns (partition key, for example, date, state e.t.c). The hive partition is similar to table partitioning available in SQL server or any other RDBMS database tables.</p>
<ul>
<li>Embeds field names and values in path segments, such as “/year=2019/month=2/<hash> or part_<number>.parquet”. <strong>HDFS -</strong> Hadoop Distributed File System is a data storage system used by Hadoop. It provides flexibility to manage structured or unstructured data. <em>Storing large amounts of financial transactional data in an HDFS to query using Hive QL.</em></number></hash></li>
</ul>
<p><strong>Kafka</strong> - More complex to work with than NiFi as it doesn’t have a user interface (UI), mainly used for real-time streaming data. It is a messaging system first created by LinkedIn engineers. <em>Streaming real-time weather events using Kafka</em></p></li>
<li><p>Spark integration services for the Cloud: <a href="https://aws.amazon.com/emr/features/spark/?nc1=h_ls">AWS EMR</a>, <a href="https://azure.microsoft.com/en-gb/services/hdinsight/">Azure HDInsight</a>, <a href="https://cloud.google.com/dataproc">GCP Dataproc</a>.</p></li>
<li><p>If Spark is used with Databricks, another particularly interesting format is the delta format which offers <a href="https://docs.databricks.com/delta/quick-start.html#optimize-a-table">automatic optimisation tools</a>.</p></li>
</ul>
</section>
<section id="sec-apache-spark-procov" class="level2 unnumbered">
<h2 class="unnumbered anchored" data-anchor-id="sec-apache-spark-procov">Process Overview</h2>
<ul>
<li>Distributed computation is performed by
<ul>
<li><p><strong>Configuring</strong> - Requests the cluster manager for resources: total machines, memory, and so on.</p></li>
<li><p><strong>Partitioning</strong> - Splits the data available for computation across each compute instance.</p></li>
<li><p><strong>Executing</strong> - Means running an arbitrary transformation over each partition.</p></li>
<li><p><strong>Shuffling</strong> - Redistributes data to the correct machine.</p></li>
<li><p><strong>Caching</strong> - Preserves data in memory across different computation cycles.</p></li>
<li><p><strong>Serializing</strong> - Transforms data to be sent over the network to other workers or back to the driver node.<br>
<a href="./_resources/Apache,_Spark.resources/1-UeNRlmH00Xb1uxlyijMzhg.png" class="lightbox" data-gallery="quarto-lightbox-gallery-1"><img src="./_resources/Apache,_Spark.resources/1-UeNRlmH00Xb1uxlyijMzhg.png" class="img-fluid" width="532"></a></p>
<ul>
<li><strong>Spark Driver</strong> (aka <strong>master node</strong>) - Orchestrates the execution of the processing and its distribution among the <strong>Spark Executors</strong>.
<ul>
<li>Not necessarily hosted by the computing cluster, it can be an external client.</li>
</ul></li>
<li>A <strong>Spark Executor</strong> is a <em>process</em> that runs on a <strong>Worker Node</strong> and is responsible for executing the tasks of a specific Spark application.
<ul>
<li>Executors are allocated a certain amount of memory and CPU cores on the Worker Node. They can run multiple tasks concurrently, using threads to parallelize execution.</li>
<li>Executors typically persist for the duration of the Spark application, reusing cached data and avoiding overheads of starting new processes for each job.</li>
</ul></li>
<li><strong>Cluster Manager</strong> - Manages the available resources of the cluster in real time.
<ul>
<li>With a better overview than the Spark application, it allocates the requested resources to the Spark driver if they are available</li>
<li>e.g.&nbsp;Standalone cluster manager (Spark’s own manager that is deployed on private cluster), Apache Mesos, Hadoop YARN, or Kubernetes</li>
</ul></li>
<li><strong>Worker Node</strong> - The physical compute or virtual machine that is responsible for executing tasks and storing data.
<ul>
<li>Managed by the <strong>Cluster Manager</strong>, such as Apache Mesos or YARN, which allocates resources to them.</li>
<li>Provides CPU, memory, and storage for <strong>Spark Executors</strong> to run and can host multiple executors from different Spark applications, depending on its available resources.</li>
</ul></li>
</ul></li>
<li><p><span class="ribbon-highlight">Example</span> (process)</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a>data <span class="ot">&lt;-</span> <span class="fu">copy_to</span>(sc,&nbsp;</span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">data.frame</span>(<span class="at">id =</span> <span class="fu">c</span>(<span class="dv">4</span>, <span class="dv">9</span>, <span class="dv">1</span>, <span class="dv">8</span>, <span class="dv">2</span>, <span class="dv">3</span>, <span class="dv">5</span>, <span class="dv">7</span>, <span class="dv">6</span>)),</span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a>             <span class="at">repartition =</span> <span class="dv">3</span>)</span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a>data <span class="sc">%&gt;%</span> <span class="fu">arrange</span>(id) <span class="sc">%&gt;%</span> <span class="fu">collect</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<ol type="1">
<li>The numbers 1 through 9 are <em>partitioned</em> across three storage instances.</li>
<li>Each worker node loads this implicit partition; for instance, 4, 9, and 1 are loaded in the first worker node.</li>
<li>A task is distributed to each worker to apply a transformation to each data partition in each worker node.</li>
<li>The task <em>executes</em> a sorting operation within a partition.
<ul>
<li>Tasks are denoted as f(x) in the Spark webui DAG</li>
</ul></li>
<li>The result is then <em>shuffled</em> to the correct machine to finish the sorting operation across the entire dataset, which completes a stage.
<ol type="1">
<li>The sorted results can be optionally <em>cached</em> in memory to avoid rerunning this computation multiple times.</li>
</ol></li>
<li>Finally, a small subset of the results is <em>serialized</em>, through the network connecting the cluster machines, back to the driver node to print a preview of this sorting example.</li>
</ol></li>
</ul></li>
<li>Spark Job<br>
<a href="./_resources/Apache,_Spark.resources/1-FdGrw0cwu-z5qaeMm88Hww.png" class="lightbox" data-gallery="quarto-lightbox-gallery-2"><img src="./_resources/Apache,_Spark.resources/1-FdGrw0cwu-z5qaeMm88Hww.png" class="img-fluid" width="532"></a>
<ul>
<li><strong>Stages</strong> are a set of operations that Spark can execute without shuffling data between machines
<ul>
<li>Often delimited by a data transfer in the network between the executing nodes</li>
<li>e.g.&nbsp;A join operation between two tables.</li>
</ul></li>
<li><strong>Task</strong>: A unit of execution in Spark that is assigned to a partition of data.</li>
</ul></li>
<li>Spark Transformation types:<br>
<a href="./_resources/Apache,_Spark.resources/1-u69zDQgxukpRQTiZZ6Alqg.png" class="lightbox" data-gallery="quarto-lightbox-gallery-3"><img src="./_resources/Apache,_Spark.resources/1-u69zDQgxukpRQTiZZ6Alqg.png" class="img-fluid" width="532"></a>
<ul>
<li><strong>Shuffle</strong>: A redistribution of the data partitions in the network between the executing nodes
<ul>
<li>Isn’t usually 1:1 copying as hash keys are typically used to determine how data is grouped by and where to copy. This process usually means data is copied through numerous executors and machines.</li>
<li>Computationally expensive
<ul>
<li>Speed Factors: Data size and latency within cluster</li>
</ul></li>
<li>Wide transformations require shuffling</li>
</ul></li>
</ul></li>
<li><strong>Lazy Evaluation</strong> - Triggers processing only when a Spark action is run and not a Spark transformation
<ul>
<li>Allows Spark to prepare a logical and physical execution plan to perform the action efficiently.</li>
</ul></li>
</ul>
</section>
<section id="sec-apache-spark-setup" class="level2 unnumbered">
<h2 class="unnumbered anchored" data-anchor-id="sec-apache-spark-setup">Set-Up</h2>
<ul>
<li>Java
<ul>
<li>Install Java or see which version you have installed</li>
<li>See which versions of Spark are compatible with your version of Java</li>
</ul></li>
<li>Versions that available to install - <code>spark_available_versions()</code></li>
<li>Versions that have been installed - <code>spark_installed_versions()</code></li>
<li>Install
<ul>
<li><p>spark_install has a version argument if you want a specific version</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="fu">spark_install</span>(<span class="at">version =</span> <span class="st">"3.1"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div></li>
</ul></li>
<li>Version 3.1 is compatible with Java 11</li>
<li>Uninstall a version - <code>spark_uninstall("2.2.0")</code></li>
<li>Connection
<ul>
<li><p>Connect</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a>sc <span class="ot">&lt;-</span> <span class="fu">spark_connect</span>(</span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">master =</span> <span class="st">"local"</span>,</span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">version =</span> <span class="st">"3.1.1"</span>,</span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">config =</span> conf)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<ul>
<li><span class="arg-text">sc</span> is the connection object</li>
<li><span class="arg-text">local</span> means that the cluster is set-up on your local machine</li>
<li>conf is the list of configuration parameter:value pairs (see below, Optimization &gt;&gt; Configuration)</li>
</ul></li>
</ul></li>
<li>Disconnect from cluster - <code>spark_disconnect_all()</code></li>
</ul>
</section>
<section id="sec-apache-spark-errors" class="level2 unnumbered">
<h2 class="unnumbered anchored" data-anchor-id="sec-apache-spark-errors">Errors</h2>
<ul>
<li><code>java.lang.OutOfMemoryError: Java heap space</code>
<ul>
<li><strong>out-of-memory</strong> (<strong>OOM</strong>) error</li>
<li>Solutions:
<ul>
<li>add more executor memory</li>
<li>rebalance executor memory through parameters</li>
</ul></li>
</ul></li>
<li><code>Service 'sparkDriver' failed after 16 retries</code>
<ul>
<li>Worker node networking error</li>
<li>See <a href="https://towardsdatascience.com/spark-fix-cant-assign-driver-32406580375">article</a> for details on implementing these solutions</li>
<li>Solutions
<ul>
<li>Exporting the corresponding SPARK_LOCAL_IP environment variable that is loaded when the JVM is initialized on worker nodes</li>
<li>Setting the corresponding spark.driver.bindAddress configuration in the SparkSession (note that this approach will override SPARK_LOCAL_IP environment variable)</li>
<li>Updating the hostname on your local machine</li>
<li>Check whether you have enabled a Virtual Private Network (VPN) — or any other tool that may be affecting the networking on your local machine — as this may sometimes affect binding addresses</li>
</ul></li>
</ul></li>
</ul>
<section id="sec-apache-spark-errors-datskew" class="level3 unnumbered">
<h3 class="unnumbered anchored" data-anchor-id="sec-apache-spark-errors-datskew">Data Skew</h3>
<ul>
<li>The OOM error can occur on joins of very large tables or very large table + medium table with skewed data because of unevenly distributed keys
<ul>
<li>When a key (also see shuffle in Process Overview &gt;&gt; Spark Transformation types above) has considerably more volume than the others, this “HOT KEY” causes a data skew</li>
<li>When they say “skewed”, they mean something closer to imbalanced. Partitions and join/group_by variables are usually discrete and this seems like a imbalanced categorical variable issue</li>
</ul></li>
<li>Examples:
<ul>
<li>A sales analysis that requires a breakdown by city. The cities with more populations like New York, Chicago, San Fransico have a higher chance to get data skew problems.</li>
<li>A table is partitioned by month and it has many more records in a few months than all the rest</li>
<li>Too many null values in a join or group-by key</li>
</ul></li>
<li>Other symptoms
<ul>
<li><p>Frozen stages and tasks</p></li>
<li><p>Low utilization of CPU</p></li>
<li><p>e.g.&nbsp;most tasks finish within a reasonable amount of time, only to have one task take forever<br>
<img src="./_resources/Apache,_Spark.resources/image.png" class="img-fluid"></p>
<ul>
<li>In the webui, the bottom bar is a task that takes substantially more time to complete than the other tasks</li>
</ul></li>
</ul></li>
<li>Solution: Adaptive Query Execution (AQE)
<ul>
<li>Implemented in Spark 3.0 and default in 3.2.
<ul>
<li>May not provide the most optimized settings for edge cases
<ul>
<li>See <a href="https://towardsdatascience.com/deep-dive-into-handling-apache-spark-data-skew-57ce0d94ee38">Deep Dive into Handling Apache Spark Data Skew</a>
<ul>
<li>Details on diagnosing, and manually tuning settings (includes salting code and links)</li>
</ul></li>
</ul></li>
</ul></li>
<li><a href="https://www.youtube.com/watch?v=PiZcQKbomDU">Video</a></li>
<li>See <a href="https://towardsdatascience.com/five-tips-to-fasten-your-skewed-joins-in-apache-spark-420f558b219e">Five Tips to Fasten Skewed Joins in Apache Spark</a> for explainer on the process</li>
<li>Set <span class="arg-text">spark.sql.adaptive.enabled = TRUE</span> in the config</li>
<li>Configuration parameters
<ul>
<li><span class="arg-text">spark.sql.adaptive.skewJoin.enabled</span> : This boolean parameter controls whether skewed join optimization is turned on or off. Default value is true.</li>
<li><span class="arg-text">spark.sql.adaptive.skewJoin.skewedPartitionFactor</span>: This integer parameter controls the interpretation of a skewed partition. Default value is 5.</li>
<li><span class="arg-text">spark.sql.adaptive.skewJoin.skewedPartitionThresholdInBytes</span>: This parameter in MBs also controls the interpretation of a skewed partition. Default value is 256 MB.</li>
<li>A partition is considered skewed when both (partition size &gt; <span class="arg-text">skewedPartitionFactor</span> * median partition size) and (partition size &gt; <span class="arg-text">skewedPartitionThresholdInBytes</span>) are true.</li>
</ul></li>
<li>Issues
<ul>
<li>Cannot handle ‘Full Outer Join’</li>
<li>Cannot handle skewedness on both input datasets
<ul>
<li>Can handle skew only in the left dataset in the Left Joins category (Outer, Semi and Anti)</li>
<li>Can handle skew in the right dataset in the Right Joins category</li>
</ul></li>
</ul></li>
</ul></li>
<li>Solution: Use broadcast joins (See Optimization &gt;&gt; Shuffling &gt;&gt; Broadcast Joins)
<ul>
<li>For inner joins, See <a href="../qmd/apache-spark.html#sec-apache-spark-opt-shuf-iterbrjoin" style="color: green">Optimization &gt;&gt; Shuffling &gt;&gt; Iterative Broadcast Joins</a></li>
</ul></li>
<li>Solution: “Salt” the join key(s)
<ul>
<li>See <a href="https://www.youtube.com/watch?v=d41_X78ojCg">video</a> (haven’t found any good step-by-step resources)</li>
<li>For the largest table, you concantenate the join variable with “_” + random number or letter
<ul>
<li>May be better to create a new column with the salted join key so it can be deleted later</li>
<li>I think the range of the random numbers might need to be the number of threads you’re using but it may not matter as long as its larger than the cardinality of your join variable</li>
</ul></li>
<li>For the other table(s) involved in the join, each join variable value should have the same range of numbers as it’s counterpart in the largest table. So rows will essentially be replicated.
<ul>
<li>This increases the size of the table.
<ul>
<li>It might increase it to the size of the largest table as all other column values get replicated.</li>
</ul></li>
</ul></li>
<li>Join tables then perform calculations (e.g.&nbsp;group_by(join_id) %&gt;% count)</li>
<li>Delete the join column or remove the concantenated part</li>
</ul></li>
<li>Solution: Salted Sort Merge Join
<ul>
<li><p>Notes from</p>
<ul>
<li><a href="https://towardsdatascience.com/five-tips-to-fasten-your-skewed-joins-in-apache-spark-420f558b219e">Five Tips to Fasten Skewed Joins in Apache Spark</a>
<ul>
<li><a href="https://www.linkedin.com/in/ajaywlan/">Ajay Gupta</a> (says contact him for code snippets)</li>
</ul></li>
</ul></li>
<li><p>Also see <a href="https://towardsdatascience.com/deep-dive-into-handling-apache-spark-data-skew-57ce0d94ee38">Deep Dive into Handling Apache Spark Data Skew</a></p>
<ul>
<li>Details on diagnosing, and manually tuning settings (includes salting code and links)</li>
</ul></li>
<li><p>Useful when joining a large skewed dataset with a smaller non-skewed dataset but there are constraints on the executor’s memory</p></li>
<li><p>Can be used to perform Left Join of smaller non-skewed dataset with the larger skewed dataset which is not possible with Broadcast Hash Join even when the smaller dataset can be broadcasted to executors</p></li>
<li><p>Issues</p>
<ul>
<li>Cannot handle Full Outer Join</li>
<li>Cannot handle skewness on both input datasets
<ul>
<li>Can handle skew only in the left dataset in the Left Joins category (Outer, Semi and Anti)</li>
<li>Can handle skew only in the right dataset in the Right Joins category</li>
</ul></li>
</ul></li>
<li><p>Have to turn off the ‘Broadcast Hash Join’ approach. This can be done by setting ‘spark.sql.autoBroadcastJoinThreshold’ to -1</p></li>
<li><p>Similar to ‘Iterative Broadcast Hash’ Join (Optimization &gt;&gt; Shuffling &gt;&gt; Iterative Broadcast Joins)</p></li>
<li><p>Process Option 1</p>
<ul>
<li>An additional column ‘<em>salt key</em>’ is introduced in one of the skewed input datasets.</li>
<li>A number is randomly assigned from a selected range of salt key values for the ‘<em>salt key</em>’ column to every record</li>
<li>A for-loop is initiated on salt key values in the selected range. For every salt key value:
<ul>
<li>FIlter the salted input dataset for the iterated salt key value</li>
<li>Join the salted filtered input dataset with the other unsalted input dataset to produce a partial joined output.</li>
</ul></li>
<li>To produce the final joined output, all the partial joined outputs are combined together using the <em>Union</em> operator.</li>
</ul></li>
<li><p>Process Option 2<br>
<img src="./_resources/Apache,_Spark.resources/image.2.png" class="img-fluid"></p>
<ul>
<li>An additional column ‘<em>salt key</em>’ is introduced in one of the skewed input datasets.</li>
<li>A number is randomly assigned from a selected range of salt key values for the ‘<em>salt key</em>’ column to every record</li>
<li>A for-loop is initiated on salt key values in the selected range. For every salt key value:
<ul>
<li>The second non skewed input dataset is enriched with the current iterated salt key value by repeating the the same value in the new ‘<em>salt</em>’ column to produce a partial salt enriched dataset.</li>
</ul></li>
<li>All these partial enriched datasets are combined using the <em>Union</em> operator to produce a combined salt enriched dataset version of the second non-skewed dataset.</li>
<li>The first skewed salted dataset is Joined with the second salt enriched dataset to produce the final joined output</li>
</ul></li>
<li><p>Process Option 3</p></li>
</ul></li>
<li>Solution: Broadcast MapPartitions Join
<ul>
<li>Only method to handle a skewed ‘Full Outer Join’ between a large skewed dataset and a smaller non-skewed dataset.
<ul>
<li>supports all type of Joins and can handle skew in either or both of the dataset</li>
</ul></li>
<li>Issues
<ul>
<li>Requires considerable memory on executors.
<ul>
<li>Larger executor memory is required to broadcast the smaller input dataset and to support intermediate in-memory collection for manual Join provision.</li>
</ul></li>
</ul></li>
<li>The smaller of the two input dataset is broadcasted to executors while the Join logic is manually provisioned in the ‘MapPartitions’ transformation which is invoked on the larger non-broadcasted dataset.</li>
</ul></li>
</ul>
</section>
<section id="sec-apache-spark-errors-datsp" class="level3 unnumbered">
<h3 class="unnumbered anchored" data-anchor-id="sec-apache-spark-errors-datsp">Disk Spill</h3>
<ul>
<li>Notes from <a href="https://selectfrom.dev/spark-performance-tuning-spill-7318363e18cb">Spark Performance Tuning: Spill</a>
<ul>
<li>Article also has a nice breakdown of the memory types, parameters, etc for executors and where spill occurs.</li>
</ul></li>
<li>Spark is designed to leverage in-memory processing. If you don’t have enough memory, spark will try to write the extra data to disk to prevent your process from crashing. (i.e.&nbsp;data is “spilling” over because memory is “full”)</li>
<li>Monitoring
<ul>
<li>If there is disk spill, the spill metrics will be included in the various monitoring tables
<ul>
<li>Spill (Memory): Captures the size of data in memory <em>before</em> it’s spilled to disk and serialized.
<ul>
<li>More directly gauges the volume of data being processed in memory before spilling.</li>
</ul></li>
<li>Spill (Disk): The size of the serialized data on disk <em>after</em> it was spilled from memory during shuffle operations.
<ul>
<li>More directly reflects the actual disk usage during spilling.</li>
<li>Before spilling, Spark serializes the data (converts it into a compact format for efficient disk storage).</li>
</ul></li>
</ul></li>
<li>Tables (e.g.&nbsp;large partitions leading to disk spillage)<br>
<a href="_resources/Apache,_Spark.resources/spill-mon-jobs-1.webp" class="lightbox" data-gallery="quarto-lightbox-gallery-4"><img src="_resources/Apache,_Spark.resources/spill-mon-jobs-1.webp" class="img-fluid" width="532"></a>
<ul>
<li>Summary<br>
<a href="_resources/Apache,_Spark.resources/spill-mon-stats-sum-1.webp" class="lightbox" data-gallery="quarto-lightbox-gallery-5"><img src="_resources/Apache,_Spark.resources/spill-mon-stats-sum-1.webp" class="img-fluid" width="532"></a></li>
<li>Aggregated<br>
<a href="_resources/Apache,_Spark.resources/spill-mon-stats-agg.webp" class="lightbox" data-gallery="quarto-lightbox-gallery-6"><img src="_resources/Apache,_Spark.resources/spill-mon-stats-agg.webp" class="img-fluid" width="532"></a></li>
<li>Task<br>
<a href="_resources/Apache,_Spark.resources/spill-mon-stats-task-1.webp" class="lightbox" data-gallery="quarto-lightbox-gallery-7"><img src="_resources/Apache,_Spark.resources/spill-mon-stats-task-1.webp" class="img-fluid" width="532"></a></li>
<li>SQL Plan (On sort step)<br>
<a href="_resources/Apache,_Spark.resources/spill-mon-sqlplan-1.webp" class="lightbox" data-gallery="quarto-lightbox-gallery-8"><img src="_resources/Apache,_Spark.resources/spill-mon-sqlplan-1.webp" class="img-fluid" width="332"></a></li>
</ul></li>
</ul></li>
<li>Actions that can generate spill
<ul>
<li>Data Skew</li>
<li>Reducing <span class="arg-text">spark.sql.shuffle.partitions</span>leads to bigger file sizes per partition.
<ul>
<li><p><span class="ribbon-highlight">Example</span></p>
<div class="sourceCode" id="cb5"><pre class="sourceCode scala code-with-copy"><code class="sourceCode scala"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="co">// Create a large partition by mismanaging shuffle partitions</span></span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a>spark<span class="op">.</span>conf<span class="op">.</span><span class="fu">set</span><span class="op">(</span>“spark<span class="op">.</span>sql<span class="op">.</span>shuffle<span class="op">.</span>partitions”<span class="op">,</span> <span class="dv">60</span><span class="op">)</span></span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a><span class="co">// The location of our non-skewed set of transactions</span></span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a><span class="kw">val</span> trxPath <span class="op">=</span> “<span class="op">./</span>transactions<span class="op">/</span><span class="dv">2011</span><span class="op">-</span>to<span class="op">-</span><span class="dv">2018</span>_int<span class="op">-</span>only_60gb<span class="op">.</span>delta”</span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a>spark</span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a> <span class="op">.</span>read<span class="op">.</span><span class="fu">format</span><span class="op">(</span>“delta”<span class="op">).</span><span class="fu">load</span><span class="op">(</span>trxPath<span class="op">)</span> <span class="co">// Load the transactions table</span></span>
<span id="cb5-7"><a href="#cb5-7" aria-hidden="true" tabindex="-1"></a> <span class="op">.</span><span class="fu">orderBy</span><span class="op">(</span>“trx_id”<span class="op">)</span> <span class="co">// Some wide transformation</span></span>
<span id="cb5-8"><a href="#cb5-8" aria-hidden="true" tabindex="-1"></a> <span class="op">.</span>write<span class="op">.</span><span class="fu">format</span><span class="op">(</span>“noop”<span class="op">).</span><span class="fu">mode</span><span class="op">(</span>“overwrite”<span class="op">).</span><span class="fu">save</span><span class="op">()</span> <span class="co">// Execute a noop </span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div></li>
</ul></li>
<li><code>join</code> or <code>crossJoin</code> between 2 data tables.</li>
<li>Setting <span class="arg-text">spark.sql.files.maxPartitionBytes</span> to high (default is 128 MBs).</li>
<li><code>explode</code> on multiple columns in data tables.
<ul>
<li><p><span class="ribbon-highlight">Example</span></p>
<div class="sourceCode" id="cb6"><pre class="sourceCode scala code-with-copy"><code class="sourceCode scala"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="co">// An array that will grow each partions by a factor of 8</span></span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a><span class="kw">val</span> data <span class="op">=</span> <span class="bu">Seq</span><span class="op">(</span><span class="dv">0</span><span class="op">,</span><span class="dv">1</span><span class="op">,</span><span class="dv">3</span><span class="op">,</span><span class="dv">4</span><span class="op">,</span><span class="dv">5</span><span class="op">,</span><span class="dv">6</span><span class="op">,</span><span class="dv">7</span><span class="op">,</span><span class="dv">8</span><span class="op">).</span>toArray</span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a><span class="kw">val</span> count <span class="op">=</span> spark</span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a> <span class="op">.</span>read<span class="op">.</span><span class="fu">format</span><span class="op">(</span>“delta”<span class="op">).</span><span class="fu">load</span><span class="op">(</span>trxPath<span class="op">)</span> <span class="co">// Load the transactions table</span></span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a> <span class="op">.</span><span class="fu">withColumn</span><span class="op">(</span>“stuff”<span class="op">,</span> <span class="fu">lit</span><span class="op">(</span>data<span class="op">))</span> <span class="co">// Add an array of N items</span></span>
<span id="cb6-6"><a href="#cb6-6" aria-hidden="true" tabindex="-1"></a> <span class="op">.</span><span class="fu">select</span><span class="op">(</span>$”<span class="op">*</span>”<span class="op">,</span> <span class="fu">explode</span><span class="op">(</span>$”stuff”<span class="op">))</span> <span class="co">// Explode dataset in size by N-1 </span></span>
<span id="cb6-7"><a href="#cb6-7" aria-hidden="true" tabindex="-1"></a> <span class="op">.</span><span class="fu">distinct</span><span class="op">()</span> <span class="co">// Some wide transformation</span></span>
<span id="cb6-8"><a href="#cb6-8" aria-hidden="true" tabindex="-1"></a> <span class="op">.</span>write<span class="op">.</span><span class="fu">format</span><span class="op">(</span>“noop”<span class="op">).</span><span class="fu">mode</span><span class="op">(</span>“overwrite”<span class="op">).</span><span class="fu">save</span><span class="op">()</span> <span class="co">// Execute a noop</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div></li>
</ul></li>
</ul></li>
<li>Solutions:
<ul>
<li>Fix Skew</li>
<li>Process less data per task, which can be achieved reducing file size per partition via <a href="https://spark.apache.org/docs/latest/sql-performance-tuning.html#other-configuration-options">spark.shuffle.partitions</a> or <a href="https://spark.apache.org/docs/3.1.3/api/python/reference/api/pyspark.sql.DataFrame.repartition.html">repartition</a>.
<ul>
<li>See <a href="../qmd/apache-spark.html#sec-apache-spark-opt-part" style="color: green">Optimization &gt;&gt; Partitioning</a></li>
</ul></li>
<li>Increase the RAM to core ratio in your compute, i.e.&nbsp;add more memory per worker (increase worker size).</li>
<li>Adjust <span class="arg-text">spark.sql.files.maxPartitionBytes</span> - Influences size of partitions when reading in files. Parquet files are already efficient in this respect but CSVs and others may benefite.
<ul>
<li>See <a href="../qmd/apache-spark.html#sec-apache-spark-opt-part" style="color: green">Optimization &gt;&gt; Partitioning</a></li>
</ul></li>
<li>Increase <span class="arg-text">spark.shuffle.spill.fraction</span>: Specifies the fraction of executor memory that can be used for shuffle data before spilling starts. Default: 0.20 (20%)
<ul>
<li><span class="ribbon-highlight">Example</span>: If executor memory is 10GB and spark.shuffle.spill.fraction is 0.2, then spilling to disk starts when shuffle data reaches 2GB (20% of 10GB).</li>
<li>Increasing:
<ul>
<li>Delays spilling, potentially improving performance by keeping more data in memory.</li>
<li>Risks out-of-memory errors if memory is limited.</li>
</ul></li>
</ul></li>
</ul></li>
</ul>
</section>
</section>
<section id="sec-apache-spark-opt" class="level2 unnumbered">
<h2 class="unnumbered anchored" data-anchor-id="sec-apache-spark-opt">Optimization</h2>
<p><a href="./_resources/Apache,_Spark.resources/1-0a3eoFBqKLS-lajp4uk4_w.png" class="lightbox" data-gallery="quarto-lightbox-gallery-9"><img src="./_resources/Apache,_Spark.resources/1-0a3eoFBqKLS-lajp4uk4_w.png" class="img-fluid" width="632"></a></p>
<ul>
<li>Use event timeline in the UI to find bottlenecks</li>
</ul>
<section id="sec-apache-spark-opt-config" class="level3 unnumbered">
<h3 class="unnumbered anchored" data-anchor-id="sec-apache-spark-opt-config">Configuration</h3>
<ul>
<li><p>Values of parameters can be viewed in the UI under the Environment tab</p></li>
<li><p>Configuration object used as input to the config arg in <code>spark_connect</code></p></li>
<li><p>Misc</p>
<ul>
<li>Recommended to request significantly more memory for the driver than the memory available over each worker node.</li>
<li>In most cases, you will want to request one core per worker.</li>
</ul></li>
<li><p>Parameters</p>
<ul>
<li><span class="arg-text">cores.local</span>: (local mode) number of cores you want used by the cluster</li>
<li><span class="arg-text">shell.driver-memory</span>: amount RAM you want used by the driver node (or cluster if local)</li>
<li><span class="arg-text">spark.memory.fraction</span>: percentage of that RAM you want dedicated to jobs that will be run in the cluster and storing RDDs
<ul>
<li>Default: 0.60</li>
<li>Probably want to hold some back for monitoring, administering the cluster, etc.</li>
</ul></li>
<li><span class="arg-text">spark.memory.storageFraction</span>: percentage of RAM you want specifically for storing RDDs
<ul>
<li>If you’re mostly doing things like quickly filtering and retrieving subsets, then you can set this equal to your spark.memory.fraction</li>
<li>Spark will borrow execution memory from storage and vice versa if needed and if possible; therefore, in practice, there should be little need to tune the memory settings</li>
</ul></li>
<li><span class="arg-text">spark.executor.memory</span>: percentage of RAM you want specifically for executing actions</li>
</ul></li>
<li><p><span class="ribbon-highlight">Example</span> (method 1)</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a> conf <span class="ot">&lt;-</span> <span class="fu">list</span>()</span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a> conf<span class="sc">$</span><span class="st">`</span><span class="at">sparklyr.cores.local</span><span class="st">`</span> <span class="ot">&lt;-</span> <span class="dv">6</span></span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a> conf<span class="sc">$</span><span class="st">`</span><span class="at">sparklyr.shell.driver-memory</span><span class="st">`</span> <span class="ot">&lt;-</span> <span class="st">"6G"</span></span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a> conf<span class="sc">$</span><span class="st">`</span><span class="at">spark.memory.fraction</span><span class="st">`</span> <span class="ot">&lt;-</span> <span class="fl">0.9</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div></li>
<li><p><span class="ribbon-highlight">Example</span> (method 2)</p>
<div class="sourceCode" id="cb8"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Initialize configuration with defaults</span></span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a>config <span class="ot">&lt;-</span> <span class="fu">spark_config</span>()</span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Memory</span></span>
<span id="cb8-5"><a href="#cb8-5" aria-hidden="true" tabindex="-1"></a>config[<span class="st">"sparklyr.shell.driver-memory"</span>] <span class="ot">&lt;-</span> <span class="st">"2g"</span></span>
<span id="cb8-6"><a href="#cb8-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-7"><a href="#cb8-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Cores</span></span>
<span id="cb8-8"><a href="#cb8-8" aria-hidden="true" tabindex="-1"></a>config[<span class="st">"sparklyr.connect.cores.local"</span>] <span class="ot">&lt;-</span> <span class="dv">2</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div></li>
<li><p><span class="ribbon-highlight">Example</span> (method 3)</p>
<div class="sourceCode" id="cb9"><pre class="sourceCode yaml code-with-copy"><code class="sourceCode yaml"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="fu">default</span><span class="kw">:</span></span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">sparklyr.shell.driver-memory</span><span class="kw">:</span><span class="at"> 2G</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<ul>
<li>Allows you to have cleaner code</li>
<li>Create a <em>config.yml</em> file in the working dir or a parent dir. Then there’s no need to specify the config parameter when creating a connection
<ul>
<li>You can also specify an alternate configuration filename or location by setting the file parameter in <code>spark_config()</code></li>
<li>Can also change the default configuration by changing the value of the R_CONFIG_ACTIVE environment variable. See the GitHub <a href="https://oreil.ly/74jIL">rstudio/config</a> repo for additional information</li>
</ul></li>
</ul></li>
</ul>
</section>
<section id="sec-apache-spark-opt-part" class="level3 unnumbered">
<h3 class="unnumbered anchored" data-anchor-id="sec-apache-spark-opt-part">Partitioning</h3>
<ul>
<li><p>Ideally, Spark organises one thread per task and per CPU core</p></li>
<li><p>Increasing partitions can help performance but don’t create too many partitions</p>
<ul>
<li>There is a deterioration of I/O performance due to the operations performed by the file system (e.g.&nbsp;opening, closing, listing files), which is often amplified with a distributed file system like HDFS.</li>
<li>Scheduling problems can also be observed if the number of partitions is too large.</li>
</ul></li>
<li><p>Types</p>
<ul>
<li><strong>Implicit</strong>: type of partitioning already present in the storage system
<ul>
<li>e.g.&nbsp;directory tree of Arrow files that have been partitioned; table schema in a relational db (?)</li>
<li>(default) it’s more effective to run computations where the data is already located</li>
</ul></li>
<li><strong>Explicit</strong>: Manaully setting the number of partitions (i.e.&nbsp;repartitioning)
<ul>
<li>Useful when when you have many more or far fewer compute instances than data partitions. In both cases, it can help to <em>repartition</em> data to match your cluster resources</li>
<li>Various data functions, like <code>spark_read_csv()</code> or <code>copy_to()</code>, already support a repartition parameter to request that Spark repartition data appropriately
<ul>
<li>Also,<code>spark_df %&gt;% sdf_repartition(4)</code>(e.g.&nbsp;repartitions a Spark DataFrame to have 4 partitions)
<ul>
<li>Should be shown as the <span class="arg-text">spark.sql.shuffle.partitions</span> parameter in the webui or config</li>
</ul></li>
<li><code>sdf_coalesce(x, partitions)</code> can reduce the number of partitions without shuffling</li>
</ul></li>
</ul></li>
</ul></li>
<li><p>Check number of partitions for a data object</p>
<div class="sourceCode" id="cb10"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="fu">sdf_len</span>(sc, <span class="dv">10</span>) <span class="sc">%&gt;%</span> <span class="fu">sdf_num_partitions</span>()</span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a><span class="sc">&gt;</span><span class="er">&gt;</span> <span class="dv">2</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<ul>
<li><code>sdf_len</code> creates a spark df with a sequence length (e.g.&nbsp;10 in this toy example)
<ul>
<li>I think this a numeric vector in R but they just call everything a df in Spark</li>
</ul></li>
<li>I think the default is set the partitions to the number of cores/instances that are being used in the cluster</li>
</ul></li>
<li><p><span class="arg-text">spark.sql.files.maxPartitionBytes</span> - Influences size of partitions when reading in files. Parquet files are already efficient in this respect but CSVs and others may benefite.</p>
<ul>
<li>Data Size and Distribution:
<ul>
<li>Large Files<strong>:</strong> For massive files, smaller partitions can improve parallelism and processing speed by distributing work across more cores.</li>
<li>Small Files<strong>:</strong> Too many small partitions can introduce overhead, so larger partitions might be better.</li>
<li>Skewed Data<strong>:</strong> If data distribution is uneven (some partitions much larger than others), adjusting the parameter can help balance workload and prevent bottlenecks.</li>
</ul></li>
<li>File Format:
<ul>
<li>Columnar Formats (Parquet, ORC): Efficiently handle larger partitions due to compression and selective column reads.</li>
<li>Text-based Formats (CSV, JSON): Might benefit from smaller partitions for faster parsing and processing.</li>
</ul></li>
<li>Memory Constraints:
<ul>
<li>Limited Memory: Smaller partitions can reduce memory pressure, but excessive partitioning can increase overhead.</li>
</ul></li>
<li>Computation Type:
<ul>
<li>Shuffle-intensive Operations (joins, aggregations): Benefit from larger partitions to minimize data movement and shuffling overhead.</li>
<li>Transformations on individual partitions: Less affected by partition size.</li>
</ul></li>
<li>Hardware Configuration:
<ul>
<li>Number of Cores: More cores can handle larger partitions effectively.</li>
<li>Disk I/O Speed: Slower disks might favor smaller partitions to reduce disk seeks.</li>
</ul></li>
<li>General Recommendations:
<ul>
<li>Default (128MB): Often a good starting point.</li>
<li>Larger Files: Consider increasing the value (e.g., 1GB).</li>
<li>Small Files: Decrease the value (e.g., 64MB).</li>
<li>Skewed Data: Experiment with different values to find the best balance.</li>
</ul></li>
<li>Best Practices:
<ul>
<li>Monitor performance metrics to assess partitioning effectiveness.</li>
<li>Adjust the parameter based on specific data characteristics and workload requirements.</li>
<li>Consider other configuration options like <span class="arg-text">spark.sql.files.openCostInBytes</span> and <span class="arg-text">spark.sql.files.minPartitionNum</span> for fine-tuning.</li>
</ul></li>
</ul></li>
</ul>
</section>
<section id="sec-apache-spark-opt-cach" class="level3 unnumbered">
<h3 class="unnumbered anchored" data-anchor-id="sec-apache-spark-opt-cach">Caching</h3>
<ul>
<li>Functions like <code>spark_read_parquet()</code> or <code>copy_to()</code> load/cache data objects into memory (aka resilient distributed dataset (RDD))
<ul>
<li>Save data from being lost when a worker fails</li>
<li><code>tbl_uncache(sc, "iris")</code> can be used to free up memory by removing a RDD from cache</li>
</ul></li>
<li>Inspect RDDs through the UI (Storage Tab &gt;&gt; <rdd name="">)<br>
<a href="./_resources/Apache,_Spark.resources/tuning-cache-rdd-web-resized.png" class="lightbox" data-gallery="quarto-lightbox-gallery-10"><img src="./_resources/Apache,_Spark.resources/tuning-cache-rdd-web-resized.png" class="img-fluid" width="532"></a></rdd></li>
<li>Checkpoints
<ul>
<li><code>sdf_checkpoint</code> caches a spark dataframe or an object thats coerceable to a spark dataframe
<ul>
<li>Useful during analysis after computationally intensive calculations so that you don’t have to repeat them
<ul>
<li>There is a cost to writing these results to disk, so you might need to test whether the calculation is intensive enough for checkpointing to be more efficient.</li>
</ul></li>
<li><code>spark_set_checkpoint_dir() spark_get_checkpoint_dir()</code> are for setting and getting the location of the cache directory</li>
<li>Cache is deleted after the end of the spark session</li>
</ul></li>
</ul></li>
</ul>
</section>
<section id="sec-apache-spark-opt-shuf" class="level3 unnumbered">
<h3 class="unnumbered anchored" data-anchor-id="sec-apache-spark-opt-shuf">Shuffling</h3>
<p><a href="./_resources/Apache,_Spark.resources/1-pGL7i8B1ALEUosUhbXqYEQ.png" class="lightbox" data-gallery="quarto-lightbox-gallery-11"><img src="./_resources/Apache,_Spark.resources/1-pGL7i8B1ALEUosUhbXqYEQ.png" class="img-fluid" width="532"></a></p>
<ul>
<li>Spark stores the intermediate results of a shuffle operation on the local disks of the executor machines, so the quality of the disks, especially the I/O quality, is really important.
<ul>
<li>The use of SSD disks will significantly improve performance for this type of transformation</li>
</ul></li>
<li>Sort Merge (Default) requires full shuffling of both data sets via network which is heavy task for Spark
<ul>
<li>Other Joins: <a href="https://databricks.com/fr/session/optimizing-apache-spark-sql-joins">Docs</a></li>
</ul></li>
</ul>
<section id="sec-apache-spark-opt-shuf-brjoin" class="level4 unnumbered">
<h4 class="unnumbered anchored" data-anchor-id="sec-apache-spark-opt-shuf-brjoin">Broadcast Joins</h4>
<ul>
<li><p>** Think this only needs to be explicitly specified for Spark 2.x. Spark 3.0 has Adaptive Query Execution (AQE) which uses the optimal type of join automatically. **</p>
<ul>
<li><a href="https://www.youtube.com/watch?v=PiZcQKbomDU">Video</a></li>
<li>May need Databricks (runtime &gt;7.0) to get AQE and set <span class="arg-text">spark.sql.adaptive.enabled = TRUE</span> in the config</li>
</ul></li>
<li><p>Useful when one df is orders of magnitude smaller than the one you’re joining it too</p>
<ul>
<li>It pushes one of the smaller DataFrames to each of the worker nodes to reduce shuffling the bigger DataFrame</li>
<li>By duplicating the smallest table, the join no longer requires any significant data exchange in the cluster apart from the broadcast of this table beforehand</li>
<li>If you are joining two data sets and both are very large, then broadcasting any table would kill your spark cluster and fails your job.</li>
</ul></li>
<li><p>Can be set according to difference in size in bytes using <span class="arg-text">spark.sql.autoBroadcastHashJoin</span> (not sure if this is available in <span style="color: #990000">{sparklyr}</span></p>
<ul>
<li>Default = 10 MB difference in sizes</li>
<li>Setting to -1 means spark always uses a broadcast join (maybe useful with sufficient memory available)</li>
</ul></li>
<li><p>Adjust (increase?) <span class="arg-text">spark.sql.autoBroadcastJoinThreshold</span> to get smaller tables broadcasted</p>
<ul>
<li>Should be done to ensure sufficient driver and executor memory</li>
<li>Setting to -1 disables it</li>
</ul></li>
<li><p>Issues</p>
<ul>
<li>Not Applicable for Full Outer Join.</li>
<li>For Inner Join, executor memory should accommodate at least smaller of the two input dataset. (See Iterative Broadcast Joins below as a potential solution)</li>
<li>For Left , Left Anti and Left Semi Joins, executor memory should accommodate the right input dataset as the right one needs to be broadcasted.</li>
<li>For Right , Right Anti and Right Semi Joins, executor memory should accommodate the left input dataset as the left one needs to be broadcasted.</li>
<li>There is also a considerable demand of execution memory on executors based on the size of broadcasted dataset.</li>
</ul></li>
<li><p><span class="ribbon-highlight">Example</span>:</p>
<div class="sourceCode" id="cb11"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="fu">sdf_len</span>(sc, <span class="dv">10000</span>) <span class="sc">%&gt;%</span></span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">sdf_broadcast</span>() <span class="sc">%&gt;%</span></span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(<span class="fu">sdf_len</span>(sc, <span class="dv">100</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div></li>
</ul>
</section>
<section id="sec-apache-spark-opt-shuf-iterbrjoin" class="level4 unnumbered">
<h4 class="unnumbered anchored" data-anchor-id="sec-apache-spark-opt-shuf-iterbrjoin">Iterative Broadcast Joins</h4>
<ul>
<li>** Limited to Inner Joins only**</li>
<li>An adaption of ‘Broadcast Hash’ join in order to handle larger skewed datasets. It is useful in situations where either of the input dataset cannot be broadcasted to executors. This may happen due to the constraints on the executor memory limits.</li>
<li>Breaks downs one of the input data set (preferably the smaller one) into one or more smaller chunks thereby ensuring that each of the resulting chunk can be easily broadcasted.
<ul>
<li>Outputs from these multiple joins is finally combined together using the ‘Union’ operator to produce the final output.</li>
</ul></li>
<li>Process<br>
<a href="./_resources/Apache,_Spark.resources/image.1.png" class="lightbox" data-gallery="quarto-lightbox-gallery-12"><img src="./_resources/Apache,_Spark.resources/image.1.png" class="img-fluid" width="475"></a>
<ul>
<li>Assign a random number out of the desired number of chunks to each record of the Dataset in a newly added column, ‘chunkId’.</li>
<li>A for-loop is initiated to iterate on chunk numbers. For each iteration:
<ul>
<li>Records are filtered on the ‘chunkId’ column corresponding to current iteration chunk number.</li>
<li>The filtered dataset, in each iteration, is then joined with the unbroken other input dataset using the standard ‘Broadcast Hash’ Join to get the partial joined output.</li>
<li>The partial joined output is then combined with the previous partial joined output.</li>
</ul></li>
<li>After the loop is exited, one would get the overall output of the join operation of the two original datasets</li>
</ul></li>
</ul>
</section>
</section>
<section id="sec-apache-spark-opt-serial" class="level3 unnumbered">
<h3 class="unnumbered anchored" data-anchor-id="sec-apache-spark-opt-serial">Serialization</h3>
<ul>
<li><p><a href="https://oreil.ly/TRbNh">Kryo Serializer</a> that can provide performance improvements over the default <a href="https://oreil.ly/0DMsd">Java Serializer</a></p>
<div class="sourceCode" id="cb12"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a>config <span class="ot">&lt;-</span> <span class="fu">spark_config</span>()</span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a>config<span class="sc">$</span>spark.serializer <span class="ot">&lt;-</span> <span class="st">"org.apache.spark.serializer.KryoSerializer"</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div></li>
</ul>
</section>
<section id="sec-apache-spark-opt-loop" class="level3 unnumbered">
<h3 class="unnumbered anchored" data-anchor-id="sec-apache-spark-opt-loop">Avoid Loops</h3>
<ul>
<li><p>In the planning phase, spark creates a directed acyclical graph (DAG) which indicates how your specified transformations will be carried out. The planning phase is relatively expensive and can sometimes take several seconds, so you want to invoke it as infrequently as possible.</p></li>
<li><p><span class="ribbon-highlight">Example</span>: pyspark</p>
<div class="sourceCode" id="cb13"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> functools</span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> pyspark.sql <span class="im">import</span> DataFrame</span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-4"><a href="#cb13-4" aria-hidden="true" tabindex="-1"></a>paths <span class="op">=</span> get_file_paths()</span>
<span id="cb13-5"><a href="#cb13-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-6"><a href="#cb13-6" aria-hidden="true" tabindex="-1"></a><span class="co"># BAD: For loop</span></span>
<span id="cb13-7"><a href="#cb13-7" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> path <span class="kw">in</span> paths:</span>
<span id="cb13-8"><a href="#cb13-8" aria-hidden="true" tabindex="-1"></a>  df <span class="op">=</span> spark.read.load(path)</span>
<span id="cb13-9"><a href="#cb13-9" aria-hidden="true" tabindex="-1"></a>  df <span class="op">=</span> fancy_transformations(df)</span>
<span id="cb13-10"><a href="#cb13-10" aria-hidden="true" tabindex="-1"></a>  df.write.mode(<span class="st">"append"</span>).saveAsTable(<span class="st">"xyz"</span>)</span>
<span id="cb13-11"><a href="#cb13-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-12"><a href="#cb13-12" aria-hidden="true" tabindex="-1"></a><span class="co"># GOOD: functools.reduce</span></span>
<span id="cb13-13"><a href="#cb13-13" aria-hidden="true" tabindex="-1"></a>lazily_evaluated_reads <span class="op">=</span> [spark.read.load(path) <span class="cf">for</span> path <span class="kw">in</span> paths]</span>
<span id="cb13-14"><a href="#cb13-14" aria-hidden="true" tabindex="-1"></a>lazily_evaluted_transforms <span class="op">=</span> [fancy_transformations(df) <span class="cf">for</span> df <span class="kw">in</span> lazily_evaluated_reads]</span>
<span id="cb13-15"><a href="#cb13-15" aria-hidden="true" tabindex="-1"></a>unioned_df <span class="op">=</span> functools.<span class="bu">reduce</span>(DataFrame.union, lazily_evaluted_transforms)</span>
<span id="cb13-16"><a href="#cb13-16" aria-hidden="true" tabindex="-1"></a>unioned_df.write.mode(<span class="st">"append"</span>).saveAsTable(<span class="st">"xyz"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<ul>
<li>I assume pyspark can do the same trick with wildcards that sparklyr uses, so not sure how necessary this is.</li>
</ul></li>
<li><p><span class="ribbon-highlight">Example</span>: sparklyr</p>
<div class="sourceCode" id="cb14"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(sparklyr)</span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a><span class="co"># wildcard</span></span>
<span id="cb14-4"><a href="#cb14-4" aria-hidden="true" tabindex="-1"></a>file_paths <span class="ot">&lt;-</span> <span class="st">"/path/to/directory/*.csv"</span></span>
<span id="cb14-5"><a href="#cb14-5" aria-hidden="true" tabindex="-1"></a><span class="co"># directory</span></span>
<span id="cb14-6"><a href="#cb14-6" aria-hidden="true" tabindex="-1"></a>file_paths <span class="ot">&lt;-</span> <span class="st">"/path/to/directory"</span></span>
<span id="cb14-7"><a href="#cb14-7" aria-hidden="true" tabindex="-1"></a><span class="co"># explicitly</span></span>
<span id="cb14-8"><a href="#cb14-8" aria-hidden="true" tabindex="-1"></a>file_paths <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"/path/to/file1.csv"</span>, <span class="st">"/path/to/file2.csv"</span>)</span>
<span id="cb14-9"><a href="#cb14-9" aria-hidden="true" tabindex="-1"></a><span class="co"># arrow</span></span>
<span id="cb14-10"><a href="#cb14-10" aria-hidden="true" tabindex="-1"></a>data <span class="ot">&lt;-</span> arrow<span class="sc">::</span><span class="fu">open_dataset</span>(<span class="at">sources =</span> <span class="st">"/path/to/directory"</span>)</span>
<span id="cb14-11"><a href="#cb14-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-12"><a href="#cb14-12" aria-hidden="true" tabindex="-1"></a>data <span class="ot">&lt;-</span> <span class="fu">spark_read_csv</span>(<span class="at">sc =</span> sc, <span class="at">name =</span> <span class="st">"my_data"</span>, <span class="at">path =</span> file_paths)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div></li>
</ul>
</section>
<section id="sec-apache-spark-opt-unop" class="level3 unnumbered">
<h3 class="unnumbered anchored" data-anchor-id="sec-apache-spark-opt-unop">Union Operator</h3>
<ul>
<li><p>e.g.&nbsp;<code>df = df1.union(df2).union(df3)</code> (<a href="https://towardsdatascience.com/boosting-spark-union-operator-performance-optimization-tips-for-improved-query-speed-9123ae6ada80">article</a>)</p></li>
<li><p>If users don’t use union on entirely different data sources, union operators will face a potential performance bottleneck — Catalyst isn’t “smart” to identify the shared data frames to reuse.</p></li>
<li><p>Ensure rows follow the same structure:</p>
<ul>
<li>The number of columns must be identical.</li>
<li>Column data types should match</li>
<li>The column names should follow the same sequence for each data frame. Nevertheless, that’s not mandatory.
<ul>
<li>The first data frame will be chosen as the default for the column name. So mixing order can potentially cause an undesired result.</li>
<li>Spark <code>unionByName</code> is intended to resolve this issue.</li>
</ul></li>
</ul></li>
<li><p><code>unionAll</code> is an alias to <code>union</code> that doesn’t remove duplication. We’d need to add distinct after performing union to perform SQL-like union operations without duplication.</p></li>
<li><p>Typical Use Case<br>
<a href="./_resources/Apache,_Spark.resources/image.3.png" class="lightbox" data-gallery="quarto-lightbox-gallery-13"><img src="./_resources/Apache,_Spark.resources/image.3.png" class="img-fluid" width="532"></a></p>
<ul>
<li>“Fact 1” and “Fact 2” are 2 large tables that have been joined and split (e.g.&nbsp;filtering) into subsets. Each subset uses different transformations, and eventually, we combine those 4 data frames into the final one.</li>
<li>Since Catalyst doesn’t recognize these are the same dfs, it performs the two big table join four times!</li>
</ul></li>
<li><p>Solutions</p>
<ul>
<li>Double the number of executors to run more concurrent tasks</li>
<li>Hint to Catalyst and let it reuse the joined data frame from memory through caching</li>
</ul></li>
<li><p><span class="ribbon-highlight">Example</span>: Caching</p>
<div class="sourceCode" id="cb15"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="co">## Perform inner join on df1 and df2</span></span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a>df <span class="op">=</span> df1.join(df2, how<span class="op">=</span><span class="st">"inner"</span>, on<span class="op">=</span><span class="st">"value"</span>)</span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-4"><a href="#cb15-4" aria-hidden="true" tabindex="-1"></a><span class="co">## add cache here</span></span>
<span id="cb15-5"><a href="#cb15-5" aria-hidden="true" tabindex="-1"></a>df.cache()</span>
<span id="cb15-6"><a href="#cb15-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-7"><a href="#cb15-7" aria-hidden="true" tabindex="-1"></a><span class="co">## Split the joined result into two data frames: one only contains the odd numbers, another one for the even numbers</span></span>
<span id="cb15-8"><a href="#cb15-8" aria-hidden="true" tabindex="-1"></a>df_odd <span class="op">=</span> df.<span class="bu">filter</span>(df.value <span class="op">%</span> <span class="dv">2</span> <span class="op">==</span> <span class="dv">1</span>)</span>
<span id="cb15-9"><a href="#cb15-9" aria-hidden="true" tabindex="-1"></a>df_even <span class="op">=</span> df.<span class="bu">filter</span>(df.value <span class="op">%</span> <span class="dv">2</span> <span class="op">==</span> <span class="dv">0</span>)</span>
<span id="cb15-10"><a href="#cb15-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-11"><a href="#cb15-11" aria-hidden="true" tabindex="-1"></a><span class="co">## Add a transformation with a field called magic_value which is generated by two dummy transformations.</span></span>
<span id="cb15-12"><a href="#cb15-12" aria-hidden="true" tabindex="-1"></a>df_odd <span class="op">=</span> df_odd.withColumn(<span class="st">"magic_value"</span>, df.value<span class="op">+</span><span class="dv">1</span>)</span>
<span id="cb15-13"><a href="#cb15-13" aria-hidden="true" tabindex="-1"></a>df_even <span class="op">=</span> df_even.withColumn(<span class="st">"magic_value"</span>, df.value<span class="op">/</span><span class="dv">2</span>)</span>
<span id="cb15-14"><a href="#cb15-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-15"><a href="#cb15-15" aria-hidden="true" tabindex="-1"></a><span class="co">## Union the odd and even number data frames</span></span>
<span id="cb15-16"><a href="#cb15-16" aria-hidden="true" tabindex="-1"></a>df_odd.union(df_even).count()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<ul>
<li>Reduces the plan from 50 to 32 stages</li>
</ul></li>
</ul>
</section>
</section>
<section id="sec-apache-spark-dating" class="level2 unnumbered">
<h2 class="unnumbered anchored" data-anchor-id="sec-apache-spark-dating">Data Ingestion</h2>
<ul>
<li><p>Send data from R to the Spark Cluster</p>
<div class="sourceCode" id="cb16"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a>iris_ref <span class="ot">&lt;-</span> dplyr<span class="sc">::</span><span class="fu">copy_to</span>(sc, iris_df, <span class="st">"iris_tbl"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<ul>
<li><span class="var-text">iris_ref</span>
<ul>
<li>List object in R environment that is a reference to iris_tbl in spark</li>
<li>Work with this object in R like normal</li>
</ul></li>
<li><span class="var-text">iris_df</span>
<ul>
<li>Data object in the R environment that you want to load into spark</li>
</ul></li>
<li><span class="var-text">iris_tbl</span>
<ul>
<li>Name that you want the spark table to have in the spark cluster</li>
</ul></li>
</ul></li>
<li><p>Manipulate ref objs and create new object in spark and R</p>
<div class="sourceCode" id="cb17"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a>full_products <span class="ot">&lt;-</span> </span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">copy_to</span>(sc, products_ref) <span class="sc">%&gt;%</span></span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a>      <span class="fu">inner_join</span>(departments_ref) <span class="sc">%&gt;%</span></span>
<span id="cb17-4"><a href="#cb17-4" aria-hidden="true" tabindex="-1"></a>      <span class="fu">inner_join</span>(aisles_ref,</span>
<span id="cb17-5"><a href="#cb17-5" aria-hidden="true" tabindex="-1"></a>                 <span class="at">name =</span> <span class="st">"product_full"</span>,</span>
<span id="cb17-6"><a href="#cb17-6" aria-hidden="true" tabindex="-1"></a>                 <span class="at">overwrite =</span> <span class="cn">TRUE</span>)</span>
<span id="cb17-7"><a href="#cb17-7" aria-hidden="true" tabindex="-1"></a><span class="co"># or use the spark object name to create an ref object</span></span>
<span id="cb17-8"><a href="#cb17-8" aria-hidden="true" tabindex="-1"></a><span class="fu">tbl</span>(sc, <span class="st">"product_full"</span>) <span class="sc">%&gt;%</span> <span class="fu">select</span>(var_name)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<ul>
<li><code>copy_to</code> also can be used to create new objects in spark from reference objects in R
<ul>
<li><span class="var-text">products_ref</span>, <span class="var-tx">departments_ref</span>, and <span class="var-text">aisles_ref</span> are reference objects for tables inside spark</li>
<li><span class="var-text">products_full</span> is the name we want for the new table inside spark</li>
<li><span class="var-text">full_products</span> will be the reference object for <span class="var-text">products_full</span></li>
</ul></li>
</ul></li>
<li><p>Read csv file into spark cluster</p>
<div class="sourceCode" id="cb18"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a>products_ref <span class="ot">&lt;-</span> <span class="fu">spark_read_csv</span>(sc, <span class="st">"products_tbl"</span>, <span class="st">"folder/folder/products.csv"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<ul>
<li><span class="var-text">products_ref</span> is the reference object</li>
<li><span class="var-text">sc</span> is the connection object</li>
<li><span class="var-text">products_tbl</span> is the name we want for the table inside spark</li>
<li>Last part is the path to the file</li>
</ul></li>
<li><p>Read multiple files</p>
<div class="sourceCode" id="cb19"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(sparklyr)</span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-3"><a href="#cb19-3" aria-hidden="true" tabindex="-1"></a><span class="co"># wildcard</span></span>
<span id="cb19-4"><a href="#cb19-4" aria-hidden="true" tabindex="-1"></a>file_paths <span class="ot">&lt;-</span> <span class="st">"/path/to/directory/*.csv"</span></span>
<span id="cb19-5"><a href="#cb19-5" aria-hidden="true" tabindex="-1"></a><span class="co"># directory</span></span>
<span id="cb19-6"><a href="#cb19-6" aria-hidden="true" tabindex="-1"></a>file_paths <span class="ot">&lt;-</span> <span class="st">"/path/to/directory"</span></span>
<span id="cb19-7"><a href="#cb19-7" aria-hidden="true" tabindex="-1"></a><span class="co"># explicitly</span></span>
<span id="cb19-8"><a href="#cb19-8" aria-hidden="true" tabindex="-1"></a>file_paths <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"/path/to/file1.csv"</span>, <span class="st">"/path/to/file2.csv"</span>)</span>
<span id="cb19-9"><a href="#cb19-9" aria-hidden="true" tabindex="-1"></a><span class="co"># arrow</span></span>
<span id="cb19-10"><a href="#cb19-10" aria-hidden="true" tabindex="-1"></a>data <span class="ot">&lt;-</span> arrow<span class="sc">::</span><span class="fu">open_dataset</span>(<span class="at">sources =</span> <span class="st">"/path/to/directory"</span>)</span>
<span id="cb19-11"><a href="#cb19-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-12"><a href="#cb19-12" aria-hidden="true" tabindex="-1"></a>data <span class="ot">&lt;-</span> <span class="fu">spark_read_csv</span>(<span class="at">sc =</span> sc, <span class="at">name =</span> <span class="st">"my_data"</span>, <span class="at">path =</span> file_paths)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div></li>
<li><p>View tables in cluster - <code>src_tbl(sc)</code></p></li>
<li><p>Bring Data from the Cluster into R</p>
<div class="sourceCode" id="cb20"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a>pred_iris <span class="ot">&lt;-</span> </span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ml_predict</span>(model_iris, test_iris) <span class="sc">%&gt;%</span></span>
<span id="cb20-3"><a href="#cb20-3" aria-hidden="true" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">collect</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<ul>
<li><code>collect</code> brings the predictions data into the R environment</li>
</ul></li>
</ul>
</section>
<section id="sec-apache-spark-func" class="level2 unnumbered">
<h2 class="unnumbered anchored" data-anchor-id="sec-apache-spark-func">Functions</h2>
<ul>
<li><p>nrow <span class="math inline">\(\rightarrow\)</span> <code>sdf_nrow(ref_obj)</code></p>
<ul>
<li>Using nrow on a reference object with output a NA</li>
</ul></li>
<li><p>quantile <span class="math inline">\(\rightarrow\)</span> <code>percentile</code></p></li>
<li><p><span class="ribbon-highlight">Example</span>:</p>
<div class="sourceCode" id="cb21"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a>cars <span class="sc">%&gt;%</span></span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span>(<span class="at">mpg_percentile =</span> <span class="fu">percentile</span>(mpg, <span class="fu">array</span>(<span class="dv">0</span>, <span class="fl">0.25</span>, <span class="fl">0.5</span>, <span class="fl">0.75</span>, <span class="dv">1</span>))) <span class="sc">%&gt;%</span></span>
<span id="cb21-3"><a href="#cb21-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">mpg_percentile =</span> <span class="fu">explode</span>(mpg_percentile))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<ul>
<li><span class="var-text">cars</span> is a reference object</li>
<li><code>percentile</code> returns a list so <code>explode</code> (unnesting/flattening) coerces it into a vector
<ul>
<li>I found an example of “explode” in <span style="color: #990000">{sparklyr}</span> docs but no function documentation. Function also available in <span style="color: #990000">{sparkr}</span> and <span style="color: #990000">{sparklyr.nested}</span></li>
</ul></li>
</ul></li>
<li><p>cor <span class="math inline">\(\rightarrow\)</span> <code>ml_corr(ref_obj)</code></p>
<ul>
<li>Pearson correlation on a reference object</li>
</ul></li>
</ul>
</section>
<section id="sec-apache-spark-spsql" class="level2 unnumbered">
<h2 class="unnumbered anchored" data-anchor-id="sec-apache-spark-spsql">Spark SQL</h2>
<ul>
<li><p>Get sql query from a dplyr operations</p>
<div class="sourceCode" id="cb22"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a><span class="fu">count</span>(ref_obj) <span class="sc">%&gt;%</span></span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">show_query</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<ul>
<li>Can use mutate, group_by, summarize, across, etc.</li>
</ul></li>
<li><p>Use SQL to query spark object</p>
<div class="sourceCode" id="cb23"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a>DBI<span class="sc">::</span><span class="fu">dbGetQuery</span>(</span>
<span id="cb23-2"><a href="#cb23-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">conn =</span> sc,</span>
<span id="cb23-3"><a href="#cb23-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">statement =</span> <span class="st">"SELECT COUNT(*) AS 'n' FROM `full_product`"</span></span>
<span id="cb23-4"><a href="#cb23-4" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<ul>
<li>Where <span class="var-text">full_product</span> is the name of the table <em>in the cluster</em></li>
</ul></li>
</ul>
</section>
<section id="sec-apache-spark-mod" class="level2 unnumbered">
<h2 class="unnumbered anchored" data-anchor-id="sec-apache-spark-mod">Modeling</h2>
<ul>
<li><p>Partition, Register, Create Reference Object</p>
<ol type="1">
<li><p><code>sdf_partition</code> creates partition reference object for train, test sets</p></li>
<li><p><code>sdf_register</code> takes the partition reference object and “registers” the splits in the cluster</p>
<ul>
<li>Not sure if <span class="var-text">partition_iris</span> is in the cluster, but I think when the “registering” occurs is when the splitting takes place inside the cluster and separate objects are created.</li>
</ul></li>
<li><p><code>tbl</code> creates a separate reference object for train data in R</p>
<div class="sourceCode" id="cb24"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a>partition_iris <span class="ot">&lt;-</span> <span class="fu">sdf_partition</span>(iris_ref, <span class="at">training =</span> <span class="fl">0.8</span>, <span class="at">testing =</span> <span class="fl">0.2</span>)</span>
<span id="cb24-2"><a href="#cb24-2" aria-hidden="true" tabindex="-1"></a><span class="fu">sdf_register</span>(partition_iris, <span class="fu">c</span>(<span class="st">"spark_training_iris"</span>, <span class="st">"spark_testing_iris"</span>))</span>
<span id="cb24-3"><a href="#cb24-3" aria-hidden="true" tabindex="-1"></a>tidy_iris <span class="ot">&lt;-</span> </span>
<span id="cb24-4"><a href="#cb24-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tbl</span>(sc, <span class="st">"spark_iris_training"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb24-5"><a href="#cb24-5" aria-hidden="true" tabindex="-1"></a>      <span class="fu">select</span>(Species, Petal_Length, Petal_Width)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div></li>
</ol></li>
<li><p>Train Basic Spark ML model</p>
<div class="sourceCode" id="cb25"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a>model_iris <span class="ot">&lt;-</span> </span>
<span id="cb25-2"><a href="#cb25-2" aria-hidden="true" tabindex="-1"></a>  tidy_iris <span class="sc">%&gt;%</span></span>
<span id="cb25-3"><a href="#cb25-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">ml_decision_tree</span>(<span class="at">response =</span> <span class="st">"Species"</span>, </span>
<span id="cb25-4"><a href="#cb25-4" aria-hidden="true" tabindex="-1"></a>                     <span class="at">features =</span> <span class="fu">c</span>(<span class="st">"Petal_Width"</span>, <span class="st">"Petal_Length"</span>))</span>
<span id="cb25-5"><a href="#cb25-5" aria-hidden="true" tabindex="-1"></a>test_iris <span class="ot">&lt;-</span> <span class="fu">tbl</span>(sc, <span class="st">"spark_testing_iris"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<ul>
<li><span class="var-text">test_iris</span> and <span class="var-text">tidy_iris</span> are reference objects</li>
<li>I don’t think <span class="var-text">model_iris</span> is a reference object. It’s a spark class objecti but I believe it’s in your environment and not on the cluster</li>
</ul></li>
<li><p>Predict</p>
<div class="sourceCode" id="cb26"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a>pred_iris <span class="ot">&lt;-</span> </span>
<span id="cb26-2"><a href="#cb26-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ml_predict</span>(model_iris, test_iris) <span class="sc">%&gt;%</span></span>
<span id="cb26-3"><a href="#cb26-3" aria-hidden="true" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">collect</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div></li>
<li><p>Summary - <code>summary(model)</code></p></li>
<li><p>Models</p>
<ul>
<li>OLS - <code>ml_linear_regression(cars, mpg ~ hp)</code>
<ul>
<li>Where <span class="var-text">cars</span> is a reference object</li>
</ul></li>
</ul></li>
<li><p>XGBoost</p>
<div class="sourceCode" id="cb27"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(sparkxgb)</span>
<span id="cb27-2"><a href="#cb27-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(sparklyr)</span>
<span id="cb27-3"><a href="#cb27-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-4"><a href="#cb27-4" aria-hidden="true" tabindex="-1"></a>sc <span class="ot">&lt;-</span> <span class="fu">spark_connect</span>(<span class="at">master =</span> <span class="st">"local"</span>)</span>
<span id="cb27-5"><a href="#cb27-5" aria-hidden="true" tabindex="-1"></a>iris_tbl <span class="ot">&lt;-</span> <span class="fu">copy_to</span>(sc, iris)</span>
<span id="cb27-6"><a href="#cb27-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-7"><a href="#cb27-7" aria-hidden="true" tabindex="-1"></a>xgb_model <span class="ot">&lt;-</span> <span class="fu">xgboost_classifier</span>(</span>
<span id="cb27-8"><a href="#cb27-8" aria-hidden="true" tabindex="-1"></a>  iris_tbl,</span>
<span id="cb27-9"><a href="#cb27-9" aria-hidden="true" tabindex="-1"></a>  Species <span class="sc">~</span> .,</span>
<span id="cb27-10"><a href="#cb27-10" aria-hidden="true" tabindex="-1"></a>  <span class="at">num_class =</span> <span class="dv">3</span>,</span>
<span id="cb27-11"><a href="#cb27-11" aria-hidden="true" tabindex="-1"></a>  <span class="at">num_round =</span> <span class="dv">50</span>,</span>
<span id="cb27-12"><a href="#cb27-12" aria-hidden="true" tabindex="-1"></a>  <span class="at">max_depth =</span> <span class="dv">4</span></span>
<span id="cb27-13"><a href="#cb27-13" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb27-14"><a href="#cb27-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-15"><a href="#cb27-15" aria-hidden="true" tabindex="-1"></a>xgb_model <span class="sc">%&gt;%</span> </span>
<span id="cb27-16"><a href="#cb27-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ml_predict</span>(iris_tbl) <span class="sc">%&gt;%</span> </span>
<span id="cb27-17"><a href="#cb27-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(Species, predicted_label, <span class="fu">starts_with</span>(<span class="st">"probability_"</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb27-18"><a href="#cb27-18" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">glimpse</span>()</span>
<span id="cb27-19"><a href="#cb27-19" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Rows: ??</span></span>
<span id="cb27-20"><a href="#cb27-20" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Columns: 5</span></span>
<span id="cb27-21"><a href="#cb27-21" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Database: spark_connection</span></span>
<span id="cb27-22"><a href="#cb27-22" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; $ Species                &lt;chr&gt; "setosa", "setosa", "setosa", "setosa", "setosa…</span></span>
<span id="cb27-23"><a href="#cb27-23" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; $ predicted_label        &lt;chr&gt; "setosa", "setosa", "setosa", "setosa", "setosa…</span></span>
<span id="cb27-24"><a href="#cb27-24" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; $ probability_setosa     &lt;dbl&gt; 0.9971547, 0.9948581, 0.9968392, 0.9968392, 0.9…</span></span>
<span id="cb27-25"><a href="#cb27-25" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; $ probability_versicolor &lt;dbl&gt; 0.002097376, 0.003301427, 0.002284616, 0.002284…</span></span>
<span id="cb27-26"><a href="#cb27-26" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; $ probability_virginica  &lt;dbl&gt; 0.0007479066, 0.0018403779, 0.0008762418, 0.000…</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div></li>
</ul>
</section>
<section id="sec-apache-spark-stream" class="level2 unnumbered">
<h2 class="unnumbered anchored" data-anchor-id="sec-apache-spark-stream">Streaming</h2>
<ul>
<li><p><a href="https://spark.rstudio.com/guides/streaming.html">Intro to Spark Streaming with sparklyr</a></p></li>
<li><p>Spark server will continue to run and detect changes/updates</p>
<ul>
<li>To files in a folder</li>
<li>To Apache Kafka stream</li>
</ul></li>
<li><p>Start a stream - <code>stream_read_csv(sc, "&lt;input folder path&gt;/")</code></p>
<ul>
<li>Make sure path to folder (e.g.&nbsp;“stream_input/”) ends with a backslash</li>
</ul></li>
<li><p>Write output of processed stream - <code>stream_write_csv(&lt;processed_stream_obj&gt;, "&lt;output folder path&gt;/")</code></p></li>
<li><p>Stop stream</p>
<ul>
<li>Might have to stop connection to spark server with <code>spark_disconnect_all()</code></li>
</ul></li>
<li><p><span class="ribbon-highlight">Example</span>:</p>
<div class="sourceCode" id="cb28"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a>stream <span class="ot">&lt;-</span> <span class="fu">stream_read_csv</span>(sc, <span class="st">"stream_input/"</span>)</span>
<span id="cb28-2"><a href="#cb28-2" aria-hidden="true" tabindex="-1"></a>stream <span class="sc">%&gt;%</span></span>
<span id="cb28-3"><a href="#cb28-3" aria-hidden="true" tabindex="-1"></a>&nbsp; &nbsp; <span class="fu">select</span>(mpg, cyl, disp) <span class="sc">%&gt;%</span></span>
<span id="cb28-4"><a href="#cb28-4" aria-hidden="true" tabindex="-1"></a>&nbsp; &nbsp; <span class="fu">stream_write_csv</span>(<span class="st">"stream_output/"</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div></li>
</ul>
</section>
<section id="sec-apache-spark-mon" class="level2 unnumbered">
<h2 class="unnumbered anchored" data-anchor-id="sec-apache-spark-mon">Monitoring</h2>
<ul>
<li><p><u>Sparklint</u><br>
<a href="./_resources/Apache,_Spark.resources/screen_shot.png" class="lightbox" data-gallery="quarto-lightbox-gallery-14"><img src="./_resources/Apache,_Spark.resources/screen_shot.png" class="img-fluid" width="632"></a></p>
<ul>
<li><a href="https://github.com/groupon/sparklint">Github</a></li>
<li>Provides advance metrics and better visualization about your spark application’s resource utilization
<ul>
<li>Vital application life time stats like idle time, average vcore usage, distribution of locality</li>
<li>View task allocation by executor</li>
<li>VCore usage graphs by FAIR scheduler group</li>
<li>VCore usage graphs by task locality</li>
<li>Current works-in-progress (WIP)
<ul>
<li>Find rdds that can benefit from persisting</li>
<li>Automated report on application bottle neck</li>
<li>Opportunity to give the running application real-time hints on magic numbers like partitions size, job submission parallelism, whether to persist rdd or not</li>
</ul></li>
</ul></li>
</ul></li>
<li><p><u>webui</u></p>
<ul>
<li><code>spark_web(sc)</code>
<ul>
<li>Where <span class="var-text">sc</span> is the spark connection object</li>
</ul></li>
<li>Resources
<ul>
<li>Docs: https://spark.apache.org/docs/latest/web-ui.html</li>
<li><a href="https://therinspark.com/tuning.html#overview-4">R in Spark</a> (sections on DAGs, event timeline, and probably more)</li>
</ul></li>
<li>Default URL: http:driver_host:4040</li>
</ul></li>
<li><p>Spark metrics also available through a REST API</p>
<ul>
<li>API Metrics
<ul>
<li>SparkListener API docs: https://spark.apache.org/docs/2.4.8/api/java/org/apache/spark/scheduler/SparkListener.html</li>
<li>Examples: start/end, job start/end, stage start/end, execution time, records read/written, bytes read/written, etc.</li>
</ul></li>
<li>Might require knowing Java to take advantage of the api
<ul>
<li>Example of a “listener” was written in Java but it’s an API, so not why you can’t use any language</li>
</ul></li>
</ul></li>
<li><p><u>Prometheus</u></p>
<ul>
<li>Experimental support
<ul>
<li>REST API: /metrics/executors/Prometheus
<ul>
<li>Conditional to “spark.ui.prometheus.enabled=true”</li>
</ul></li>
</ul></li>
</ul></li>
<li><p><u>Graphana</u></p>
<ul>
<li>Visualizes metrics streaming to it <a href="./_resources/Apache,_Spark.resources/Screenshot (480).png" class="lightbox" data-gallery="quarto-lightbox-gallery-15"><img src="./_resources/Apache,_Spark.resources/Screenshot (480).png" class="img-fluid" width="532"></a>
<ul>
<li><span class="ribbon-highlight">Example</span>: This sends metrics to <a href="https://docs.influxdata.com/influxdb/v1.8/supported_protocols/graphite/">influxdb</a> using a <a href="https://graphite.readthedocs.io/en/latest/overview.html">Graphite</a> “protocol” which can be visualized in <a href="https://grafana.com/">Graphana</a><br>
<a href="./_resources/Apache,_Spark.resources/Screenshot (484).png" class="lightbox" data-gallery="quarto-lightbox-gallery-16"><img src="./_resources/Apache,_Spark.resources/Screenshot (484).png" class="img-fluid" width="532"></a><br>
<a href="./_resources/Apache,_Spark.resources/Screenshot (482).png" class="lightbox" data-gallery="quarto-lightbox-gallery-17"><img src="./_resources/Apache,_Spark.resources/Screenshot (482).png" class="img-fluid" width="532"></a>
<ul>
<li>Monitor tasks and memory usage
<ul>
<li>Might be able do determine more efficient memory allocations</li>
</ul></li>
</ul></li>
</ul></li>
<li>Plugins
<ul>
<li>Allow you to monitor
<ul>
<li>Cloud Storage</li>
<li>OS metrics (important for kubernetes)</li>
<li>Improved HDFS monitoring</li>
</ul></li>
</ul></li>
</ul></li>
</ul>
</section>
<section id="sec-apache-spark-cloud" class="level2 unnumbered">
<h2 class="unnumbered anchored" data-anchor-id="sec-apache-spark-cloud">Cloud</h2>
<section id="sec-apache-spark-cloud-dbric" class="level3 unnumbered">
<h3 class="unnumbered anchored" data-anchor-id="sec-apache-spark-cloud-dbric">Databricks</h3>
<ul>
<li><u>Misc</u>
<ul>
<li>Free community edition available</li>
<li>{sparkR} and <span style="color: #990000">{sparklyr}</span> are already installed on a databricks instance</li>
<li>Databricks Connect is now able to run regular Python code inside Spark. <span style="color: #990000">{sparklyr}</span> takes advantage of this capability by having Python transport and run the R code. It does this via the <span style="color: goldenrod">{{rpy2}}</span>.
<ul>
<li><span style="color: goldenrod">{{rpy2}}</span> will have to be manually installed on the Spark cluster. (See <a href="https://docs.databricks.com/en/libraries/cluster-libraries.html">docs</a> for instructions)</li>
</ul></li>
<li>Using RStudio and databricks
<ul>
<li>Via driver node
<ul>
<li>R runtime including required packages installed on every node in the cluster while RStudio Server only runs on the driver node where also the web UI is provided</li>
<li>No network latency occurs by transferring data between R and Databricks as the JVM processes run on the same machine</li>
<li>Avoids having to set up another infrastructure</li>
<li>If your Databricks cluster is constantly running and you haven’t lot going on besides the interactive workloads, then this option might even be more convenient</li>
</ul></li>
<li>Separate environment
<ul>
<li>Avoids resource contention</li>
<li>Allows you to connect to any other remote storage or compute resources if required</li>
<li>For details on this connection see <a href="https://towardsdatascience.com/rstudio-and-databricks-better-together-5752e5c02a1d">RStudio and Databricks Better Together</a></li>
</ul></li>
</ul></li>
</ul></li>
<li><u>Connect</u>
<ul>
<li><p><code>sparklyr::spark_connect(method = "databricks")</code></p>
<ul>
<li>May require some extra information on the location of the databricks spark location</li>
</ul></li>
<li><p><span class="ribbon-highlight">Example</span>:</p>
<div class="sourceCode" id="cb29"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a>databricks_connect_spark_home <span class="ot">&lt;-</span> <span class="fu">system</span>(<span class="st">"databricks-connect get-spark-home"</span>, <span class="at">intern =</span> <span class="cn">TRUE</span>)</span>
<span id="cb29-2"><a href="#cb29-2" aria-hidden="true" tabindex="-1"></a>sc <span class="ot">&lt;-</span> <span class="fu">spark_connect</span>(</span>
<span id="cb29-3"><a href="#cb29-3" aria-hidden="true" tabindex="-1"></a>&nbsp; &nbsp; <span class="at">method =</span> <span class="st">"databricks"</span>,</span>
<span id="cb29-4"><a href="#cb29-4" aria-hidden="true" tabindex="-1"></a>&nbsp; &nbsp; <span class="at">spark_home =</span> databricks_connect_spark_home,</span>
<span id="cb29-5"><a href="#cb29-5" aria-hidden="true" tabindex="-1"></a>&nbsp; &nbsp; <span class="at">config =</span> conf</span>
<span id="cb29-6"><a href="#cb29-6" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div></li>
</ul></li>
<li><u>UDFs</u>
<ul>
<li><p><code>spark_apply</code></p>
<div class="sourceCode" id="cb30"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a><span class="fu">spark_apply</span>(</span>
<span id="cb30-2"><a href="#cb30-2" aria-hidden="true" tabindex="-1"></a>  tbl_mtcars,</span>
<span id="cb30-3"><a href="#cb30-3" aria-hidden="true" tabindex="-1"></a>  nrow,</span>
<span id="cb30-4"><a href="#cb30-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">group_by =</span> <span class="st">"am"</span>, </span>
<span id="cb30-5"><a href="#cb30-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">columns =</span> <span class="st">"am double, x long"</span></span>
<span id="cb30-6"><a href="#cb30-6" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb30-7"><a href="#cb30-7" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; # Source:   table&lt;`sparklyr_tmp_table_87ef961e_1009_42f8_abdb_2a04c2a5ad38`&gt; [2 x 2]</span></span>
<span id="cb30-8"><a href="#cb30-8" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; # Database: spark_connection</span></span>
<span id="cb30-9"><a href="#cb30-9" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;      am     x</span></span>
<span id="cb30-10"><a href="#cb30-10" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;   &lt;dbl&gt; &lt;dbl&gt;</span></span>
<span id="cb30-11"><a href="#cb30-11" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 1     0    19</span></span>
<span id="cb30-12"><a href="#cb30-12" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 2     1    13</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<ul>
<li><span class="arg-text">columns</span>: Specifying a schema makes it run faster. Otherwise, it looks at the first 10 rows and tries to figure out what the column types are.</li>
<li><span class="arg-text">arrow_max_records_per_batch</span>: Controls then number of parallel jobs.
<ul>
<li>Arrow is installed on all clusters by default. So instead of using <span class="arg-text">group_by</span> to determine how the data will be partitioned, it will controlled by this argument.</li>
<li>The equivalent Spark setting is <span class="arg-text">spark.sql.execution.arrow.maxRecordsPerBatch</span></li>
</ul></li>
<li>Currently only works on Databricks “Single Access” mode and not “Shared Access” mode.
<ul>
<li>If <code>mapInPandas</code> and <code>applyInPandas</code> are ever implemented in Shared Access, then this will mean <code>spark_apply</code> will also.</li>
</ul></li>
</ul></li>
</ul></li>
<li><u>Monitoring</u>
<ul>
<li>Databricks workspace provides through its UI a fairly easy and intuitive way of visualizing the run history of individual jobs</li>
<li>Databricks REST API can be used to extract you jobs data
<ul>
<li><a href="https://docs.databricks.com/dev-tools/api/latest/index.html">docs</a></li>
<li><a href="https://towardsdatascience.com/monitoring-databricks-jobs-through-calls-to-the-rest-api-4c02d7d27278">Monitoring Databricks jobs through calls to the REST API</a></li>
</ul></li>
</ul></li>
</ul>
</section>
<section id="sec-apache-spark-cloud-aws" class="level3 unnumbered">
<h3 class="unnumbered anchored" data-anchor-id="sec-apache-spark-cloud-aws">AWS</h3>
<ul>
<li><a href="https://aws.amazon.com/glue/">AWS Glue</a> allows you to spin up in a couple of seconds a spark cluster up to 100 executors where each executor is 4 CPUs and 16GB RAM.</li>
<li><a href="https://aws.amazon.com/emr/">AWS EMR</a> is a managed service if you want a more configurable cluster</li>
<li><a href="https://aws.amazon.com/emr/features/spark/?nc1=h_ls">EMR</a>
<ul>
<li>Cons
<ul>
<li>Over-Provisioning or under-provisioning leads to wasted resources or queued jobs
<ul>
<li>e.g.&nbsp;Ad-Hoc exploration of the researchers with bursts of high usage.</li>
</ul></li>
<li>Can’t run multiple versions of Spark simultaneously.
<ul>
<li>Example: The consequence of this was a burden for migration and testing. Routinely creating new EMR clusters to test out against new dependencies. The added infrastructure burden delayed upgrades and increased the accumulation of technical debt.</li>
</ul></li>
<li>Scattered visibility
<ul>
<li>No single place to visualize Spark job metrics, Executor/Driver Logs, and the Application UI</li>
<li>Debugging executor failures due to out-of-memory was often tricky
<ul>
<li>Since Spark is a distributed computational framework - failure stack traces wouldn’t always be informative about the root cause since it may be a red herring.</li>
</ul></li>
</ul></li>
<li>Lack of configuration agility
<ul>
<li>No ability to change the underlying execution environment to remediate the failure reason(s) automatically</li>
</ul></li>
</ul></li>
</ul></li>
</ul>
</section>
<section id="kubernetes" class="level3">
<h3 class="anchored" data-anchor-id="kubernetes">Kubernetes</h3>
<ul>
<li>Options
<ul>
<li>Spark’s integration with Kubernetes (non-AWS I think)</li>
<li>EMR on EKS
<ul>
<li>Good binding for IAM, EMRFS, and S3, and AWS-provided integrations and container images</li>
</ul></li>
</ul></li>
<li>EMR on EKS
<ul>
<li><a href="https://multithreaded.stitchfix.com/blog/2022/03/14/spark-eks/">Stitchfix configuration</a>
<ul>
<li>Misc
<ul>
<li>Saw a 45-55% reduction in infrastructure cost for all our Spark-based compute by switching from EMR to EMR on EKS</li>
<li>They’re running thousands of daily spark jobs, so this may not be a solution for everyone plus it would require some substantial programming expertise to implement some of this stuff</li>
</ul></li>
<li><a href="https://github.com/kubernetes/autoscaler/tree/master/cluster-autoscaler">Cluster Autoscaler</a> - As Spark pods are scheduled, EKS cluster nodes are added or removed based on load
<ul>
<li>Set to cull nodes after an unused interval of 5 minutes and a scanning interval of 1 minute</li>
</ul></li>
<li>Container images use official EMR on EKS images as base images and then add other dependencies
<ul>
<li>Same cluster can run multiple versions of Spark
<ul>
<li>Testing a new version only requires producing a new container image base and running an ad hoc testing job</li>
</ul></li>
<li>Each cluster node uses the <a href="http://blog.itaysk.com/2017/12/26/the-single-use-daemonset-pattern-and-prepulling-images-in-kubernetes">image pre-puller</a> pattern to cache the Spark images to improve job startup time</li>
</ul></li>
<li>Monitoring
<ul>
<li>EKS pod events + <a href="https://docs.aws.amazon.com/emr/latest/EMR-on-EKS-DevelopmentGuide/monitoring.html#monitoring-cloudwatch-events">EMR on EKS CloudWatch events</a>
<ul>
<li>EKS pod events: provide granular visibility into the setup, execution, and tear down of a job.</li>
<li>EMR cloudwatch: provide high-level overview of the job state (i.e., queued, started, or finished).</li>
</ul></li>
<li>Stream logs from S3 buckets to <a href="https://github.com/stitchfix/flotilla-os">Flotilla</a> for monitoring and debugging
<ul>
<li>Each of the container logs comes from the driver, executor, and controller pods.</li>
</ul></li>
<li>Metrics
<ul>
<li>Cluster instrumented with <a href="https://victoriametrics.com/">Victoria Metrics</a> to collect detailed container metrics and visualized via Grafana
<ul>
<li>Can diagnose difficult shuffles, disk spills, needed or unneeded caching, mis-sized executors, poor concurrency, CPU throttling, memory usage, network throttling, and many other job execution details</li>
</ul></li>
</ul></li>
<li>Active and Completed jobs
<ul>
<li>Something technical (see article for details)</li>
</ul></li>
</ul></li>
<li>Adaptive Behaviors
<ul>
<li>Executor and Driver Memory
<ul>
<li>If a job fails due to Executor or Driver running out of memory (exit code 137), automatically schedule the next run with more memory. (<a href="https://komodor.com/learn/how-to-fix-oomkilled-exit-code-137/">link</a>)</li>
</ul></li>
<li>Other stuff (see article for details)</li>
</ul></li>
</ul></li>
</ul></li>
</ul>
</section>
<section id="sec-apache-spark-cloud-gcp" class="level3 unnumbered">
<h3 class="unnumbered anchored" data-anchor-id="sec-apache-spark-cloud-gcp">Google Cloud Platform (GCP)</h3>
<ul>
<li><p>Read data from cloud storage to local spark cluster</p>
<div class="sourceCode" id="cb31"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a>bucket_name <span class="ot">&lt;-</span> <span class="st">"ndir-metis-bucket"</span></span>
<span id="cb31-2"><a href="#cb31-2" aria-hidden="true" tabindex="-1"></a>path <span class="ot">&lt;-</span> glue<span class="sc">::</span><span class="fu">glue</span>(<span class="st">"gs://{bucket_name}/asteroid/Asteroid_Updated.csv"</span>)</span>
<span id="cb31-3"><a href="#cb31-3" aria-hidden="true" tabindex="-1"></a>df <span class="ot">&lt;-</span> <span class="fu">spark_read_csv</span>(path, <span class="at">sep=</span><span class="st">','</span>, <span class="at">inferSchema=</span>True, <span class="at">header=</span>True)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<ul>
<li>I adapted this from a pyspark example but should be similar for R</li>
</ul></li>
</ul>


</section>
</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const onCopySuccess = function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  }
  const getTextToCopy = function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
    text: getTextToCopy
  });
  clipboard.on('success', onCopySuccess);
  if (window.document.getElementById('quarto-embedded-source-code-modal')) {
    // For code content inside modals, clipBoardJS needs to be initialized with a container option
    // TODO: Check when it could be a function (https://github.com/zenorocha/clipboard.js/issues/860)
    const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
      text: getTextToCopy,
      container: window.document.getElementById('quarto-embedded-source-code-modal')
    });
    clipboardModal.on('success', onCopySuccess);
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp('/' + window.location.host + '/');
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
<nav class="page-navigation">
  <div class="nav-page nav-page-previous">
      <a href="../qmd/apache-arrow.html" class="pagination-link" aria-label="Arrow">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text">Arrow</span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
      <a href="../qmd/apis.html" class="pagination-link" aria-label="APIs">
        <span class="nav-page-text">APIs</span> <i class="bi bi-arrow-right-short"></i>
      </a>
  </div>
</nav>
</div> <!-- /content -->
<footer class="footer">
  <div class="nav-footer">
    <div class="nav-footer-left">
      &nbsp;
    </div>   
    <div class="nav-footer-center">
      <ul class="footer-items list-unstyled">
    <li class="nav-item">
    <a class="nav-link" href="../LICENSE.html">
<p>Creative Commons Attribution-NonCommercial 4.0 International License</p>
</a>
  </li>  
</ul>
    </div>
    <div class="nav-footer-right">
      &nbsp;
    </div>
  </div>
</footer>
<script>var lightboxQuarto = GLightbox({"selector":".lightbox","openEffect":"zoom","loop":false,"descPosition":"bottom","closeEffect":"zoom"});
(function() {
  let previousOnload = window.onload;
  window.onload = () => {
    if (previousOnload) {
      previousOnload();
    }
    lightboxQuarto.on('slide_before_load', (data) => {
      const { slideIndex, slideNode, slideConfig, player, trigger } = data;
      const href = trigger.getAttribute('href');
      if (href !== null) {
        const imgEl = window.document.querySelector(`a[href="${href}"] img`);
        if (imgEl !== null) {
          const srcAttr = imgEl.getAttribute("src");
          if (srcAttr && srcAttr.startsWith("data:")) {
            slideConfig.href = srcAttr;
          }
        }
      } 
    });
  
    lightboxQuarto.on('slide_after_load', (data) => {
      const { slideIndex, slideNode, slideConfig, player, trigger } = data;
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(slideNode);
      }
    });
  
  };
  
})();
          </script>




</body></html>